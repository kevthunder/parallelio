{"version":3,"file":"../AutomaticDoor.js","sourceRoot":"../../src","sources":["AutomaticDoor.coffee"],"names":[],"mappings":"AAAA,IAAA,aAAA,EAAA,SAAA,EAAA;;AAAA,IAAA,GAAO,OAAA,CAAQ,QAAR;;AACP,SAAA,GAAY,OAAA,CAAQ,aAAR;;AAEZ,MAAM,CAAC,OAAP,GAAuB;EAAN,MAAA,cAAA,QAA4B,KAA5B;IAWf,iBAAkB,CAAC,GAAD,CAAA;AAChB,UAAA,GAAA,EAAA,IAAA,EAAA,IAAA,EAAA;MAAA,IAAG,WAAH;;aACqB,CAAE,SAArB,CAA+B,UAA/B,EAA0C,IAA1C;;;cACsB,CAAE,SAAxB,CAAkC,MAAlC,EAAyC,IAAzC;SAFF;;MAGA,IAAG,IAAC,CAAA,IAAJ;;cACuB,CAAE,cAAvB,CAAsC,UAAtC,EAAiD,IAAjD;;mEACwB,CAAE,cAA1B,CAAyC,MAAzC,EAAgD,IAAhD,WAFF;;IAJgB;;IAQlB,IAAM,CAAA,CAAA;WAAN,CAAA,IACE,CAAA;aACA,IAAC,CAAA;IAFG;;IAIN,kBAAmB,CAAC,UAAD,CAAA;aACjB,IAAC,CAAA,gBAAD,CAAkB,UAAlB,CAA6B,CAAC,IAA9B,CAAmC,CAAC,IAAD,CAAA,GAAA;AACjC,YAAA;QAAA,QAAA,GAAc,UAAH,GAAmB,UAAU,CAAC,IAAX,CAAgB,UAAhB,EAA2B,IAA3B,CAAnB,GAAyD,IAAI,CAAC;eACzE,QAAQ,CAAC,IAAT,CAAc,CAAC,KAAD,CAAA,GAAA;iBACZ,IAAC,CAAA,gBAAD,CAAkB,KAAlB;QADY,CAAd;MAFiC,CAAnC;IADiB;;IAMnB,gBAAiB,CAAC,IAAD,CAAA;aACf,IAAA,YAAgB;IADD;;IAGjB,gBAAkB,CAAC,UAAD,CAAA;AAChB,UAAA,SAAA,EAAA;MAAA,IAAA,GAAU,UAAH,GAAmB,UAAU,CAAC,IAAX,CAAgB,MAAhB,CAAnB,GAAgD,IAAC,CAAA;MACxD,IAAA,CAAO,IAAP;AACE,eAAO,GADT;;MAEA,SAAA,GAAe,UAAH,GAAmB,UAAU,CAAC,IAAX,CAAgB,WAAhB,CAAnB,GAAqD,IAAC,CAAA;MAClE,IAAG,SAAA,KAAa,IAAI,CAAC,UAAU,CAAC,UAAhC;eACE,CACE,IADF,EAEE,IAAI,CAAC,eAAL,CAAqB,CAArB,EAAwB,CAAxB,CAFF,EAGE,IAAI,CAAC,eAAL,CAAqB,CAArB,EAAwB,CAAC,CAAzB,CAHF,CAIC,CAAC,MAJF,CAIS,QAAA,CAAC,CAAD,CAAA;iBAAO;QAAP,CAJT,EADF;OAAA,MAAA;eAOE,CACE,IADF,EAEE,IAAI,CAAC,eAAL,CAAqB,CAArB,EAAwB,CAAxB,CAFF,EAGE,IAAI,CAAC,eAAL,CAAqB,CAAC,CAAtB,EAAyB,CAAzB,CAHF,CAIC,CAAC,MAJF,CAIS,QAAA,CAAC,CAAD,CAAA;iBAAO;QAAP,CAJT,EAPF;;IALgB;;EAhCH;;EACf,aAAC,CAAA,UAAD,CACE;IAAA,IAAA,EACE;MAAA,MAAA,EAAQ,QAAA,CAAC,UAAD,CAAA;eACN,CAAC,UAAU,CAAC,IAAX,CAAgB,QAAhB,CAAD,IAA8B,IAAC,CAAA,kBAAD,CAAoB,UAApB;MADxB;IAAR,CADF;IAGA,MAAA,EACE;MAAA,OAAA,EAAS;IAAT,CAJF;IAKA,QAAA,EACE;MAAA,MAAA,EAAQ,QAAA,CAAC,UAAD,CAAA;eACN,CAAC,UAAU,CAAC,IAAX,CAAgB,QAAhB;MADK;IAAR;EANF,CADF","sourcesContent":["Door = require('./Door')\nCharacter = require('./Character')\n\nmodule.exports = class AutomaticDoor extends Door\n  @properties\n    open:\n      calcul: (invalidate) ->\n        !invalidate.prop('locked') && @isActivatorPresent(invalidate)\n    locked:\n      default: false\n    unlocked:\n      calcul: (invalidate) ->\n        !invalidate.prop('locked')\n\n  updateTileMembers:(old)->\n    if old?\n      old.walkableMembers?.removeRef('unlocked',this)\n      old.transparentMembers?.removeRef('open',this)\n    if @tile\n      @tile.walkableMembers?.addPropertyRef('unlocked',this)\n      @tile.transparentMembers?.addPropertyRef('open',this)\n\n  init: ->\n    super()\n    @open\n\n  isActivatorPresent:(invalidate)->\n    @getReactiveTiles(invalidate).some (tile) =>\n      children = if invalidate then invalidate.prop('children',tile) else tile.children\n      children.some (child) =>\n        @canBeActivatedBy(child)\n\n  canBeActivatedBy:(elem)->\n    elem instanceof Character\n\n  getReactiveTiles: (invalidate)->\n    tile = if invalidate then invalidate.prop('tile') else @tile\n    unless tile\n      return []\n    direction = if invalidate then invalidate.prop('direction') else @direction\n    if direction == Door.directions.horizontal\n      [\n        tile\n        tile.getRelativeTile(0, 1)\n        tile.getRelativeTile(0, -1)\n      ].filter (t) -> t?\n    else\n      [\n        tile\n        tile.getRelativeTile(1, 0)\n        tile.getRelativeTile(-1, 0)\n      ].filter (t) -> t?"]}