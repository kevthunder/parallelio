{"version":3,"file":"../Projectile.js","sourceRoot":"../../src","sources":["Projectile.coffee"],"names":[],"mappings":"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","sourcesContent":["Element = require('spark-starter').Element\nTiming = require('parallelio-timing')\n\nmodule.exports = class Projectile extends Element\n  constructor: (options) ->\n    super()\n    @setProperties(options)\n    @init()\n  init:->\n  @properties\n    origin:\n      default: null\n    target:\n      default: null\n    power:\n      default: 10\n    blastRange:\n      default: 1\n    propagationType:\n      default: null\n    speed:\n      default: 10\n    pathLength: \n      calcul: ->\n        if @originTile? && @targetTile?\n          dist = @originTile.dist(@targetTile)\n          if dist\n            return dist.length\n        100\n    originTile: \n      calcul: (invalidator)->\n        origin = invalidator.prop('origin')\n        if origin?\n          origin.tile || origin\n    targetTile: \n      calcul: (invalidator)->\n        target = invalidator.prop('target')\n        if target?\n          target.tile || target\n    container:\n      calcul: (invalidate)->\n        originTile = invalidate.prop('originTile')\n        targetTile = invalidate.prop('targetTile')\n        if originTile.container == targetTile.container\n          originTile.container\n        else if invalidate.prop('prcPath') > 0.5\n          targetTile.container\n        else\n          originTile.container\n    x:\n      calcul: (invalidate)->\n        startPos = invalidate.prop('startPos')\n        (invalidate.prop('targetPos').x - startPos.x)*invalidate.prop('prcPath') + startPos.x\n    y:\n      calcul: (invalidate)->\n        startPos = invalidate.prop('startPos')\n        (invalidate.prop('targetPos').y - startPos.y)*invalidate.prop('prcPath') + startPos.y\n    startPos:\n      calcul: (invalidate)->\n        originTile = invalidate.prop('originTile')\n        container = invalidate.prop('container')\n        offset = @startOffset;\n        unless originTile.container == container\n          dist = container.dist(originTile.container)\n          offset.x += dist.x\n          offset.y += dist.y\n        {\n          x: originTile.x+offset.x\n          y: originTile.y+offset.y\n        }\n      output:(val)->\n        Object.assign({},val)\n    targetPos:\n      calcul: (invalidate)->\n        targetTile = invalidate.prop('targetTile')\n        container = invalidate.prop('container')\n        offset = @targetOffset;\n        unless targetTile.container == container\n          dist = container.dist(targetTile.container)\n          offset.x += dist.x\n          offset.y += dist.y\n        {\n          x: targetTile.x+offset.x\n          y: targetTile.y+offset.y\n        }\n      output:(val)->\n        Object.assign({},val)\n    startOffset: \n      default: {x:0.5,y:0.5}\n      output:(val)->\n        Object.assign({},val)\n    targetOffset: \n      default: {x:0.5,y:0.5}\n      output:(val)->\n        Object.assign({},val)\n    prcPath:\n      calcul: ->\n        @pathTimeout?.getPrc() || 0\n    timing:\n      calcul: ->\n        new Timing()\n    moving:\n      default:false\n  launch: ->\n    @moving = true\n    @pathTimeout = @timing.setTimeout =>\n      @deliverPayload()\n      @moving = false\n    , @pathLength / @speed * 1000\n  deliverPayload: ->\n    payload = new @propagationType({\n      tile: @target.tile || @target\n      power: @power\n      range: @blastRange\n    })\n    payload.apply()\n    @payloadDelivered()\n    payload\n  payloadDelivered: ->\n    @destroy()\n  destroy: ->\n    @destroyProperties()\n"]}