{"version":3,"file":"../PathWalk.js","sourceRoot":"../../src","sources":["PathWalk.coffee"],"names":[],"mappings":"AAAA,IAAA,OAAA,EAAA,YAAA,EAAA,QAAA,EAAA;;AAAA,OAAA,GAAU,OAAA,CAAQ,eAAR,CAAwB,CAAC;;AACnC,MAAA,GAAS,OAAA,CAAQ,mBAAR;;AACT,YAAA,GAAe,OAAA,CAAQ,eAAR,CAAwB,CAAC;;AAGxC,MAAM,CAAC,OAAP,GAAuB;EAAN,MAAA,SAAA,QAAuB,QAAvB;IAEf,WAAa,OAAA,MAAA,EAAiB,OAAjB,CAAA;;MAAC,IAAC,CAAA;MAAQ,IAAC,CAAA;MAEtB,IAAC,CAAA,aAAD,CAAe,OAAf;IAFW;;IAeb,KAAO,CAAA,CAAA;MACL,IAAG,CAAC,IAAC,CAAA,IAAI,CAAC,QAAV;QACE,IAAC,CAAA,IAAI,CAAC,MAAN,CAAA,EADF;;MAEA,IAAG,IAAC,CAAA,IAAI,CAAC,QAAT;QACE,IAAC,CAAA,WAAD,GAAe,IAAC,CAAA,MAAM,CAAC,UAAR,CAAmB,CAAA,CAAA,GAAA;iBAChC,IAAC,CAAA,MAAD,CAAA;QADgC,CAAnB,EAEb,IAAC,CAAA,SAFY;eAGf,IAAC,CAAA,WAAW,CAAC,OAAO,CAAC,WAArB,CAAiC,IAAC,CAAA,QAAD,CAAU,QAAV,CAAjC,EAJF;;IAHK;;IAQP,IAAM,CAAA,CAAA;aACJ,IAAC,CAAA,WAAW,CAAC,KAAb,CAAA;IADI;;IAEN,MAAQ,CAAA,CAAA;AACN,UAAA;MAAA,GAAA,GAAM,IAAC,CAAA,IAAI,CAAC,WAAN,CAAkB,IAAC,CAAA,WAAW,CAAC,MAAb,CAAA,CAAlB;MACN,IAAC,CAAA,MAAM,CAAC,IAAR,GAAe,GAAG,CAAC;MACnB,IAAC,CAAA,MAAM,CAAC,OAAR,GAAkB,GAAG,CAAC;aACtB,IAAC,CAAA,MAAM,CAAC,OAAR,GAAkB,GAAG,CAAC;IAJhB;;IAKR,MAAQ,CAAA,CAAA;MACN,IAAC,CAAA,MAAD,CAAA;MACA,IAAC,CAAA,OAAD,CAAS,UAAT;aACA,IAAC,CAAA,GAAD,CAAA;IAHM;;IAIR,SAAW,CAAA,CAAA;MACT,IAAC,CAAA,MAAD,CAAA;MACA,IAAC,CAAA,OAAD,CAAS,aAAT;aACA,IAAC,CAAA,GAAD,CAAA;IAHS;;IAIX,GAAK,CAAA,CAAA;MACH,IAAC,CAAA,OAAD,CAAS,KAAT;aACA,IAAC,CAAA,OAAD,CAAA;IAFG;;IAGL,OAAS,CAAA,CAAA;MACP,IAAG,IAAC,CAAA,MAAM,CAAC,IAAR,KAAgB,IAAnB;QACE,IAAC,CAAA,MAAM,CAAC,IAAR,GAAe,KADjB;;MAEA,IAAC,CAAA,WAAW,CAAC,OAAb,CAAA;MACA,IAAC,CAAA,iBAAD,CAAA;aACA,IAAC,CAAA,kBAAD,CAAA;IALO;;EA3CM;;EACf,QAAC,CAAA,OAAD,CAAS,YAAY,CAAC,SAAtB;;EAIA,QAAC,CAAA,UAAD,CACE;IAAA,KAAA,EACE;MAAA,OAAA,EAAS;IAAT,CADF;IAEA,MAAA,EACE;MAAA,MAAA,EAAQ,QAAA,CAAA,CAAA;eACN,IAAI,MAAJ,CAAA;MADM;IAAR,CAHF;IAKA,UAAA,EACE;MAAA,MAAA,EAAQ,QAAA,CAAA,CAAA;eACN,IAAC,CAAA,IAAI,CAAC,QAAQ,CAAC,cAAf,CAAA;MADM;IAAR,CANF;IAQA,SAAA,EACE;MAAA,MAAA,EAAQ,QAAA,CAAA,CAAA;eACN,IAAC,CAAA,UAAD,GAAc,IAAC,CAAA,KAAf,GAAuB;MADjB;IAAR;EATF,CADF","sourcesContent":["Element = require('spark-starter').Element\nTiming = require('parallelio-timing')\nEventEmitter = require('spark-starter').EventEmitter\n\n\nmodule.exports = class PathWalk extends Element\n  @include EventEmitter.prototype\n  constructor: (@walker, @path, options) ->\n    super()\n    @setProperties(options)\n  @properties\n    speed:\n      default: 5\n    timing:\n      calcul: ->\n        new Timing()\n    pathLength:\n      calcul: ->\n        @path.solution.getTotalLength()\n    totalTime:\n      calcul: ->\n        @pathLength / @speed * 1000\n  start: ->\n    if !@path.solution\n      @path.calcul()\n    if @path.solution\n      @pathTimeout = @timing.setTimeout =>\n        @finish()\n      , @totalTime\n      @pathTimeout.updater.addCallback(@callback('update'))\n  stop: ->\n    @pathTimeout.pause()\n  update: ->\n    pos = @path.getPosAtPrc(@pathTimeout.getPrc())\n    @walker.tile = pos.tile\n    @walker.offsetX = pos.offsetX\n    @walker.offsetY = pos.offsetY\n  finish: ->\n    @update()\n    @trigger('finished')\n    @end()\n  interrupt: ->\n    @update()\n    @trigger('interrupted')\n    @end()\n  end: ->\n    @trigger('end')\n    @destroy()\n  destroy: ->\n    if @walker.walk == this\n      @walker.walk = null\n    @pathTimeout.destroy()\n    @destroyProperties()\n    @removeAllListeners()\n\n"]}