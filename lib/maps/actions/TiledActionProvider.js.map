{"version":3,"file":"../../actions/TiledActionProvider.js","sourceRoot":"../../../src","sources":["actions/TiledActionProvider.coffee"],"names":[],"mappings":"AAAA,IAAA,cAAA,EAAA,OAAA,EAAA;;AAAA,cAAA,GAAiB,OAAA,CAAQ,kBAAR;;AACjB,OAAA,GAAU,OAAA,CAAQ,eAAR,CAAwB,CAAC;;AAEnC,MAAM,CAAC,OAAP,GAAuB;EAAN,MAAA,oBAAA,QAAkC,eAAlC;IA6Cf,eAAiB,CAAC,IAAD,CAAA;aACf;IADe;;IAGjB,iBAAmB,CAAC,IAAD,CAAA;MACjB,IAAA,CAAO,IAAI,CAAC,mBAAL,CAAyB,iBAAzB,CAAP;eACE,OAAO,CAAC,SAAS,CAAC,IAAlB,CAAuB,cAAc,CAAC,SAAtC,EAAiD,IAAjD,EADF;;IADiB;;EAhDJ;;EACf,mBAAC,CAAA,UAAD,CACE;IAAA,IAAA,EACE;MAAA,MAAA,EAAQ,QAAA,CAAC,GAAD,EAAK,SAAL,CAAA;QACN,SAAA,CAAU,GAAV;eACA,IAAC,CAAA;MAFK;IAAR,CADF;IAKA,WAAA,EACE;MAAA,UAAA,EAAY,IAAZ;MACA,MAAA,EAAQ,QAAA,CAAC,WAAD,CAAA;AACN,YAAA;QAAA,MAAA,GAAS,WAAW,CAAC,IAAZ,CAAiB,MAAjB;QACT,IAAG,MAAH;iBACE,IAAC,CAAA,gBAAgB,CAAC,GAAlB,CAAsB,CAAC,KAAD,CAAA,GAAA;mBAClB,MAAM,CAAC,eAAP,CAAuB,KAAK,CAAC,CAA7B,EAA+B,KAAK,CAAC,CAArC;UADkB,CAAtB,CAEE,CAAC,MAFH,CAEU,CAAC,IAAD,CAAA,GAAA;mBACN,IAAC,CAAA,eAAD,CAAiB,IAAjB;UADM,CAFV,EADF;SAAA,MAAA;iBAME,GANF;;MAFM;IADR,CANF;IAiBA,gBAAA,EACE;MAAA,UAAA,EACE;QAAA,OAAA,EAAS,QAAA,CAAC,CAAD,EAAG,CAAH,CAAA;iBACP,CAAC,CAAC,MAAF,KAAY,CAAC,CAAC,MAAd,IAAwB,CAAC,CAAC,QAAF,KAAc,CAAC,CAAC;QADjC;MAAT,CADF;MAGA,MAAA,EAAQ,QAAA,CAAC,WAAD,CAAA;AACN,YAAA,WAAA,EAAA;QAAA,WAAA,GAAc,WAAW,CAAC,IAAZ,CAAiB,aAAjB;QACd,OAAA,GAAU,WAAW,CAAC,IAAZ,CAAiB,iBAAjB;eACV,WAAW,CAAC,MAAZ,CAAoB,CAAC,GAAD,EAAK,IAAL,CAAA,GAAA;iBAClB,GAAG,CAAC,MAAJ,CAAW,OAAO,CAAC,GAAR,CAAY,QAAA,CAAC,GAAD,CAAA;mBACrB;cAAC,MAAA,EAAO,GAAR;cAAa,QAAA,EAAS;YAAtB;UADqB,CAAZ,CAAX;QADkB,CAApB,EAGE,EAHF;MAHM,CAHR;MAYA,SAAA,EAAW,QAAA,CAAC,SAAD,CAAA;QACT,IAAC,CAAA,iBAAD,CAAmB,SAAS,CAAC,QAA7B;eACA,SAAS,CAAC,QAAQ,CAAC,eAAe,CAAC,GAAnC,CAAuC,SAAS,CAAC,MAAjD;MAFS,CAZX;MAgBA,WAAA,EAAa,QAAA,CAAC,SAAD,CAAA;eACX,SAAS,CAAC,QAAQ,CAAC,eAAe,CAAC,MAAnC,CAA0C,SAAS,CAAC,MAApD;MADW;IAhBb;EAlBF,CADF;;gCAsCA,gBAAA,GAAmB;IACjB;MAAC,CAAA,EAAE,CAAH;MAAK,CAAA,EAAE,CAAC;IAAR,CADiB;IAEjB;MAAC,CAAA,EAAE,CAAC,CAAJ;MAAM,CAAA,EAAE;IAAR,CAFiB;IAEN;MAAC,CAAA,EAAE,CAAH;MAAK,CAAA,EAAE;IAAP,CAFM;IAEI;MAAC,CAAA,EAAE,CAAC,CAAJ;MAAM,CAAA,EAAE;IAAR,CAFJ;IAGjB;MAAC,CAAA,EAAE,CAAH;MAAK,CAAA,EAAE,CAAC;IAAR,CAHiB","sourcesContent":["ActionProvider = require('./ActionProvider')\nMixable = require('spark-starter').Mixable\n\nmodule.exports = class TiledActionProvider extends ActionProvider\n  @properties\n    tile:\n      change: (old,overrided) ->\n        overrided(old)\n        @forwardedActions\n\n    actionTiles:\n      collection: true\n      calcul: (invalidator)->\n        myTile = invalidator.prop('tile')\n        if myTile\n          @actionTilesCoord.map (coord)=>\n              myTile.getRelativeTile(coord.x,coord.y)\n            .filter (tile)=>\n              @validActionTile(tile)\n        else\n          []\n\n    forwardedActions:\n      collection: \n        compare: (a,b) ->\n          a.action == b.action && a.location == b.location\n      calcul: (invalidator)->\n        actionTiles = invalidator.prop('actionTiles')\n        actions = invalidator.prop('providedActions')\n        actionTiles.reduce( (res,tile)=>\n          res.concat actions.map (act)->\n            {action:act, location:tile}\n        , [])\n\n\n      itemAdded: (forwarded) ->\n        @prepareActionTile(forwarded.location)\n        forwarded.location.providedActions.add(forwarded.action)\n\n      itemRemoved: (forwarded) ->\n        forwarded.location.providedActions.remove(forwarded.action)\n\n  actionTilesCoord : [\n    {x:0,y:-1}\n    {x:-1,y:0},{x:0,y:0},{x:+1,y:0}\n    {x:0,y:+1}\n  ]\n\n  validActionTile: (tile)->\n    tile?\n\n  prepareActionTile: (tile)->\n    unless tile.getPropertyInstance('providedActions')\n      Mixable.Extension.make(ActionProvider.prototype, tile)\n\n\n    \n\n"]}