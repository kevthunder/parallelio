{"version":3,"file":"../Player.js","sourceRoot":"../../src","sources":["Player.coffee"],"names":[],"mappings":"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","sourcesContent":["Element = require('spark-starter').Element\nEventEmitter = require('spark-starter').EventEmitter\n\n\nmodule.exports = class Player extends Element\n  @include EventEmitter.prototype\n  constructor: (options) ->\n    super()\n    @setProperties(options)\n  @properties\n    name:\n      default: 'Player'\n    focused: {}\n    selected: \n      change: (old)->\n        if old?.getProperty('selected')\n          old.selected = false\n        if @selected?.getProperty('selected')\n          @selected.selected = this\n    globalActionProviders:\n      collection: true\n    actionProviders:\n      calcul: (invalidator)->\n        res = invalidator.prop('globalActionProviders').toArray()\n        selected = invalidator.prop('selected')\n        if selected\n          res.push(selected)\n        res\n    availableActions:\n      calcul: (invalidator)->\n        invalidator.prop(\"actionProviders\").reduce((res,provider)=>\n          actions = invalidator.prop(\"availableActions\", provider)\n          if actions\n            res.concat(actions.toArray())\n          else\n            res\n        ,[])\n    selectedAction: {}\n    controller: \n      change: (old)->\n        if @controller\n          @controller.player = this\n    game:\n      change: (old)->\n        if @game \n          @setDefaults()\n\n  setDefaults: ()->\n    first = @game.players.length == 0\n    @game.players.add(this)\n    if first && !@controller && @game.defaultPlayerControllerClass\n      @controller = new @game.defaultPlayerControllerClass()\n\n  canTargetActionOn: (elem)->\n    action = @selectedAction || @selected?.defaultAction\n    action? && typeof action.canTarget == \"function\" && action.canTarget(elem)\n  canSelect: (elem)->\n    typeof elem.isSelectableBy == \"function\" && elem.isSelectableBy(this)\n  canFocusOn: (elem)->\n    if typeof elem.IsFocusableBy == \"function\" \n      elem.IsFocusableBy(this)\n    else if typeof elem.IsSelectableBy == \"function\"\n      elem.IsSelectableBy(this)\n  selectAction: (action)->\n    if action.isReady()\n      action.start()\n    else\n      @selectedAction = action\n  setActionTarget: (elem)->\n    action = @selectedAction || @selected?.defaultAction\n    action = action.withTarget(elem)\n    if action.isReady()\n      action.start()\n      @selectedAction = null\n    else\n      @selectedAction = action"]}