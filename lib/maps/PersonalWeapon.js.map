{"version":3,"file":"../PersonalWeapon.js","sourceRoot":"../../src","sources":["PersonalWeapon.coffee"],"names":[],"mappings":"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","sourcesContent":["Element = require('spark-starter').Element\nLineOfSight = require('./LineOfSight')\nTiming = require('parallelio-timing')\n\nmodule.exports = class PersonalWeapon extends Element\n  constructor: (options) ->\n    super()\n    @setProperties(options)\n  @properties\n    rechargeTime:\n      default: 1000\n    charged:\n      default: true\n    charging:\n      default: true\n    power:\n      default: 10\n    dps:\n      calcul: (invalidator)->\n        invalidator.prop('power') / invalidator.prop('rechargeTime') * 1000\n    range:\n      default: 10\n    user:\n      default: null\n    timing:\n      calcul: ->\n        new Timing()\n\n  canBeUsed: ()->\n    @charged\n\n  canUseOn: (target)->\n    @canUseFrom(@user.tile, target)\n\n\n  canUseFrom: (tile, target)->\n    if @range == 1\n      @inMeleeRange(tile, target)\n    else\n      @inRange(tile, target) and @hasLineOfSight(tile,target)\n\n  inRange: (tile, target)->\n    targetTile = target.tile || target\n    tile.dist(targetTile)?.length <= @range\n\n  inMeleeRange: (tile,target)->\n    targetTile = target.tile || target\n    Math.abs(targetTile.x - tile.x) + Math.abs(targetTile.y - tile.y) == 1\n\n  hasLineOfSight: (tile,target)->\n    targetTile = target.tile || target\n    los = new LineOfSight(targetTile.container, tile.x+0.5, tile.y+0.5, targetTile.x+0.5, targetTile.y+0.5)\n    los.traversableCallback = (tile) ->\n      tile.walkable\n    los.getSuccess()\n\n  useOn: (target)->\n    if @canBeUsed()\n      target.damage(@power)\n      @charged = false\n      @recharge()\n\n  recharge: ->\n    @charging = true\n    @chargeTimeout = @timing.setTimeout =>\n      @charging = false\n      @recharged()\n    , @rechargeTime\n\n  recharged: ->\n    @charged = true\n\n  destroy: ->\n    if @chargeTimeout\n      @chargeTimeout.destroy()\n"]}