!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).Parallelio=t()}}(function(){return function(){return function t(e,r,i){function n(s,o){if(!r[s]){if(!e[s]){var l="function"==typeof require&&require;if(!o&&l)return l(s,!0);if(a)return a(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var p=r[s]={exports:{}};e[s][0].call(p.exports,function(t){return n(e[s][1][t]||t)},p,p.exports,t,e,r,i)}return r[s].exports}for(var a="function"==typeof require&&require,s=0;s<i.length;s++)n(i[s]);return n}}()({1:[function(t,e,r){var i,n;n=t("./Door"),i=t("./Character"),e.exports=function(){class AutomaticDoor extends n{updateTileMembers(t){var e,r,i,n;if(null!=t&&(null!=(e=t.walkableMembers)&&e.removeRef("unlocked",this),null!=(r=t.transparentMembers)&&r.removeRef("open",this)),this.tile)return null!=(i=this.tile.walkableMembers)&&i.addPropertyRef("unlocked",this),null!=(n=this.tile.transparentMembers)?n.addPropertyRef("open",this):void 0}init(){return super.init(),this.open}isActivatorPresent(t){return this.getReactiveTiles(t).some(e=>{return(t?t.prop("children",e):e.children).some(t=>this.canBeActivatedBy(t))})}canBeActivatedBy(t){return t instanceof i}getReactiveTiles(t){var e;return(e=t?t.prop("tile"):this.tile)?(t?t.prop("direction"):this.direction)===n.directions.horizontal?[e,e.getRelativeTile(0,1),e.getRelativeTile(0,-1)].filter(function(t){return null!=t}):[e,e.getRelativeTile(1,0),e.getRelativeTile(-1,0)].filter(function(t){return null!=t}):[]}}return AutomaticDoor.properties({open:{calcul:function(t){return!t.prop("locked")&&this.isActivatorPresent(t)}},locked:{default:!1},unlocked:{calcul:function(t){return!t.prop("locked")}}}),AutomaticDoor}.call(this)},{"./Character":2,"./Door":6}],2:[function(t,e,r){var i,n,a;n=t("parallelio-tiles").Tiled,i=t("./Damageable"),a=t("./actions/WalkAction"),e.exports=function(){class Character extends n{constructor(t){super(),this.name=t}setDefaults(){if(!this.tile&&null!=this.game.mainTileContainer)return this.putOnRandomTile(this.game.mainTileContainer.tiles)}canGoOnTile(t){return!1!==(null!=t?t.walkable:void 0)}walkTo(t){var e;return(e=new a({actor:this,target:t})).execute(),e}isSelectableBy(t){return!0}}return Character.extend(i),Character.properties({game:{change:function(t){if(this.game)return this.setDefaults()}},offsetX:{default:.5},offsetY:{default:.5},defaultAction:{calcul:function(){return new a({actor:this})}},availableActions:{collection:!0,calcul:function(t){var e;return(e=t.prop("tile"))?t.prop("providedActions",e):[]}}}),Character}.call(this)},{"./Damageable":5,"./actions/WalkAction":30,"parallelio-tiles":82}],3:[function(t,e,r){var i,n,a,s,o,l;s=t("parallelio-tiles").TileContainer,o=t("./VisionCalculator"),n=t("./Door"),l=t("./actions/WalkAction"),i=t("./actions/AttackMoveAction"),a=t("spark-starter").PropertyWatcher,e.exports=class CharacterAI{constructor(t){this.character=t,this.nextActionCallback=(()=>this.nextAction()),this.visionMemory=new s,this.tileWatcher=new a({callback:()=>this.updateVisionMemory(),property:this.character.getPropertyInstance("tile")})}start(){return this.tileWatcher.bind(),this.nextAction()}nextAction(){var t,e;return this.updateVisionMemory(),(t=this.getClosestEnemy())?this.attackMoveTo(t).on("end",nextActionCallback):(e=this.getClosestUnexplored())?this.walkTo(e).on("end",nextActionCallback):(this.resetVisionMemory(),this.walkTo(this.getClosestUnexplored()).on("end",nextActionCallback))}updateVisionMemory(){var t;return(t=new o(this.character.tile)).calcul(),this.visionMemory=t.toContainer().merge(this.visionMemory,(t,e)=>(null!=t&&(t=this.analyzeTile(t)),null!=t&&null!=e?(t.visibility=Math.max(t.visibility,e.visibility),t):t||e))}analyzeTile(t){var e;return t.ennemySpotted=null!=(e=t.getFinalTile().children)?e.find(t=>this.isEnnemy(t)):void 0,t.explorable=this.isExplorable(t),t}isEnnemy(t){var e;return null!=(e=this.character.owner)&&"function"==typeof e.isEnemy?e.isEnemy(t):void 0}getClosestEnemy(){return this.visionMemory.closest(this.character.tile,t=>t.ennemySpotted)}getClosestUnexplored(){return this.visionMemory.closest(this.character.tile,t=>t.visibility<1&&t.explorable)}isExplorable(t){var e;return(t=t.getFinalTile()).walkable||(null!=(e=t.children)?e.find(t=>t instanceof n):void 0)}attackMoveTo(t){var e;if(t=t.getFinalTile(),(e=new i({actor:this.character,target:t})).isReady())return e.execute(),e}walkTo(t){var e;if(t=t.getFinalTile(),(e=new l({actor:this.character,target:t})).isReady())return e.execute(),e}}},{"./Door":6,"./VisionCalculator":22,"./actions/AttackMoveAction":26,"./actions/WalkAction":30,"parallelio-tiles":82,"spark-starter":153}],4:[function(t,e,r){var i,n,a,s;a=t("spark-starter").Element,s=t("./LineOfSight"),n=t("parallelio-tiles").Direction,e.exports=i=function(){class DamagePropagation extends a{constructor(t){super(),this.setProperties(t)}getTileContainer(){return this.tile.container}apply(){var t,e,r,i,n;for(n=[],e=0,r=(i=this.getDamaged()).length;e<r;e++)t=i[e],n.push(t.target.damage(t.damage));return n}getInitialTiles(){return this.getTileContainer().inRange(this.tile,this.range)}getInitialDamages(){var t,e,r,i,n,a;for(t=[],r=0,i=(a=this.getInitialTiles()).length;r<i;r++)(n=a[r]).damageable&&(e=this.initialDamage(n,a.length))&&t.push(e);return t}getDamaged(){var t;if(null==this._damaged)for(t=null;t=this.step(t););return this._damaged}step(t){return null==t?this._damaged=this.getInitialDamages():null!=this.extendedDamage?(t=this.extend(t),this._damaged=t.concat(this._damaged),t.length>0&&t):void 0}inDamaged(t,e){var r,i,n;for(i=r=0,n=e.length;r<n;i=++r)if(e[i].target===t)return i;return!1}extend(t){var e,r,i,a,s,o,l,c,p,h,u,d,f,y,v,g;for(r=this.getTileContainer(),e=[],l=0,h=t.length;l<h;l++){if(f=[],null!=(i=t[l]).target.x)for(c=0,u=(y=n.adjacents).length;c<u;c++)a=y[c],null!=(g=r.getTile(i.target.x+a.x,i.target.y+a.y))&&g.damageable&&!1===this.inDamaged(g,this._damaged)&&f.push(g);for(p=0,d=f.length;p<d;p++)v=f[p],(s=this.extendedDamage(v,i,f.length))&&(!1===(o=this.inDamaged(v,e))?e.push(s):e[o]=this.mergeDamage(e[o],s))}return e}mergeDamage(t,e){return{target:t.target,power:t.power+e.power,damage:t.damage+e.damage}}modifyDamage(t,e){return"function"==typeof t.modifyDamage?Math.floor(t.modifyDamage(e,this.type)):Math.floor(e)}}return DamagePropagation.properties({tile:{default:null},power:{default:10},range:{default:1},type:{default:null}}),DamagePropagation}.call(this),i.Normal=class Normal extends i{initialDamage(t,e){var r;if((r=this.modifyDamage(t,this.power))>0)return{target:t,power:this.power,damage:r}}},i.Thermic=class Thermic extends i{extendedDamage(t,e,r){var i,n;if(n=(e.damage-1)/2/r*Math.min(1,e.target.health/e.target.maxHealth*5),(i=this.modifyDamage(t,n))>0)return{target:t,power:n,damage:i}}initialDamage(t,e){var r,i;if(i=this.power/e,(r=this.modifyDamage(t,i))>0)return{target:t,power:i,damage:r}}},i.Kinetic=class Kinetic extends i{extendedDamage(t,e,r){var i,n;if(n=(e.power-e.damage)*Math.min(1,e.target.health/e.target.maxHealth*2)-1,(i=this.modifyDamage(t,n))>0)return{target:t,power:n,damage:i}}initialDamage(t,e){var r;if((r=this.modifyDamage(t,this.power))>0)return{target:t,power:this.power,damage:r}}modifyDamage(t,e){return"function"==typeof t.modifyDamage?Math.floor(t.modifyDamage(e,this.type)):Math.floor(.25*e)}mergeDamage(t,e){return{target:t.target,power:Math.floor((t.power+e.power)/2),damage:Math.floor((t.damage+e.damage)/2)}}},i.Explosive=function(){class Explosive extends i{getDamaged(){var t,e,r,i,n,a,s;for(this._damaged=[],a=Math.pow(this.range+1,2),n=this.power/a,(r=this.tile.health<=this.modifyDamage(this.tile,n))&&(n*=4),e=0,i=a;0<=i?e<=i:e>=i;0<=i?++e:--e)t=this.rng()*Math.PI*2,null!=(s=this.getTileHitByShard(r,t))&&this._damaged.push({target:s,power:n,damage:this.modifyDamage(s,n)});return this._damaged}getTileHitByShard(t,e){var r,i,n,a;return r=this.getTileContainer(),i=this.range*this.rng(),n={x:this.tile.x+.5+i*Math.cos(e),y:this.tile.y+.5+i*Math.sin(e)},t?((a=new s(r,this.tile.x+.5,this.tile.y+.5,n.x,n.y)).traversableCallback=(e=>!t||null!=e&&this.traversableCallback(e)),a.getEndPoint().tile):r.getTile(Math.floor(n.x),Math.floor(n.y))}}return Explosive.properties({rng:{default:Math.random},traversableCallback:{default:function(t){return!("function"==typeof t.getSolid&&t.getSolid())}}}),Explosive}.call(this)},{"./LineOfSight":10,"parallelio-tiles":82,"spark-starter":153}],5:[function(t,e,r){var i;i=t("spark-starter").Element,e.exports=function(){class Damageable extends i{damage(t){return this.health=Math.max(0,this.health-t)}whenNoHealth(){}}return Damageable.properties({damageable:{default:!0},maxHealth:{default:1e3},health:{default:1e3,change:function(){if(this.health<=0)return this.whenNoHealth()}}}),Damageable}.call(this)},{"spark-starter":153}],6:[function(t,e,r){var i;i=t("parallelio-tiles").Tiled,e.exports=function(){class Door extends i{constructor(t=Door.directions.horizontal){super(),this.direction=t}updateTileMembers(t){var e,r,i,n;if(null!=t&&(null!=(e=t.walkableMembers)&&e.removeRef("open",this),null!=(r=t.transparentMembers)&&r.removeRef("open",this)),this.tile)return null!=(i=this.tile.walkableMembers)&&i.addPropertyRef("open",this),null!=(n=this.tile.transparentMembers)?n.addPropertyRef("open",this):void 0}}return Door.properties({tile:{change:function(t){return this.updateTileMembers(t)}},open:{default:!1},direction:{}}),Door.directions={horizontal:"horizontal",vertical:"vertical"},Door}.call(this)},{"parallelio-tiles":82}],7:[function(t,e,r){e.exports=t("spark-starter").Element},{"spark-starter":153}],8:[function(t,e,r){var i;i=t("parallelio-tiles").Tile,e.exports=function(){class Floor extends i{}return Floor.properties({walkable:{composed:!0},transparent:{composed:!0}}),Floor}.call(this)},{"parallelio-tiles":82}],9:[function(t,e,r){var i,n,a,s;i=t("spark-starter").Element,a=t("parallelio-timing"),s=t("./View"),n=t("./Player"),e.exports=function(){class Game extends i{start(){return this.currentPlayer}add(t){return t.game=this,t}}return Game.properties({timing:{calcul:function(){return new a}},mainView:{calcul:function(){return this.views.length>0?this.views.get(0):this.add(new this.defaultViewClass)}},views:{collection:!0},currentPlayer:{calcul:function(){return this.players.length>0?this.players.get(0):this.add(new this.defaultPlayerClass)}},players:{collection:!0}}),Game.prototype.defaultViewClass=s,Game.prototype.defaultPlayerClass=n,Game}.call(this)},{"./Player":15,"./View":21,"parallelio-timing":107,"spark-starter":153}],10:[function(t,e,r){e.exports=class LineOfSight{constructor(t,e=0,r=0,i=0,n=0){this.tiles=t,this.x1=e,this.y1=r,this.x2=i,this.y2=n}setX1(t){return this.x1=t,this.invalidade()}setY1(t){return this.y1=t,this.invalidade()}setX2(t){return this.x2=t,this.invalidade()}setY2(t){return this.y2=t,this.invalidade()}invalidade(){return this.endPoint=null,this.success=null,this.calculated=!1}testTile(t,e,r){return null!=this.traversableCallback?this.traversableCallback(t,e,r):null!=t&&("function"==typeof t.getTransparent?t.getTransparent():void 0===typeof t.transparent||t.transparent)}testTileAt(t,e,r,i){return this.testTile(this.tiles.getTile(Math.floor(t),Math.floor(e)),r,i)}reverseTracing(){var t,e;return t=this.x1,e=this.y1,this.x1=this.x2,this.y1=this.y2,this.x2=t,this.y2=e,this.reversed=!this.reversed}calcul(){var t,e,r,i,n,a,s,o,l,c;for(n=(this.x2-this.x1)/(this.y2-this.y1),o=Math.abs(this.x2-this.x1)+Math.abs(this.y2-this.y1),r=this.x2-this.x1>=0,i=this.y2-this.y1>=0,a=l=this.x1,s=c=this.y1,this.reversed&&(a=r?l:Math.ceil(l)-1,s=i?c:Math.ceil(c)-1);o>Math.abs(l-this.x1)+Math.abs(c-this.y1)&&this.testTileAt(a,s,l,c);)t=r?Math.floor(l)+1:Math.ceil(l)-1,e=i?Math.floor(c)+1:Math.ceil(c)-1,this.x2-this.x1==0?c=e:this.y2-this.y1==0?l=t:Math.abs((t-l)/(this.x2-this.x1))<Math.abs((e-c)/(this.y2-this.y1))?(l=t,c=(t-this.x1)/n+this.y1):(l=(e-this.y1)*n+this.x1,c=e),a=r?l:Math.ceil(l)-1,s=i?c:Math.ceil(c)-1;return o<=Math.abs(l-this.x1)+Math.abs(c-this.y1)?(this.endPoint={x:this.x2,y:this.y2,tile:this.tiles.getTile(Math.floor(this.x2),Math.floor(this.y2))},this.success=!0):(this.endPoint={x:l,y:c,tile:this.tiles.getTile(Math.floor(a),Math.floor(s))},this.success=!1)}forceSuccess(){return this.endPoint={x:this.x2,y:this.y2,tile:this.tiles.getTile(Math.floor(this.x2),Math.floor(this.y2))},this.success=!0,this.calculated=!0}getSuccess(){return this.calculated||this.calcul(),this.success}getEndPoint(){return this.calculated||this.calcul(),this.endPoint}}},{}],11:[function(t,e,r){var i;i=t("spark-starter").Element,e.exports=function(){class Map extends i{}return Map.properties({locations:{collection:{closest:function(t,e){var r,i;return r=null,i=null,this.forEach(function(n){var a;if(a=n.dist(t,e),null==r||i>a)return r=n,i=a}),r},closests:function(t,e){var r;return(r=this.map(function(r){return{dist:r.dist(t,e),location:r}})).sort(function(t,e){return t.dist-e.dist}),this.copy(r.map(function(t){return t.location}))}}}}),Map}.call(this)},{"spark-starter":153}],12:[function(t,e,r){var i;i=t("parallelio-tiles").Tiled,e.exports=function(){class Obstacle extends i{updateWalkables(t){var e,r;if(null!=t&&null!=(e=t.walkableMembers)&&e.removeRef("walkable",this),this.tile)return null!=(r=this.tile.walkableMembers)?r.setValueRef(!1,"walkable",this):void 0}}return Obstacle.properties({tile:{change:function(t,e){return e(t),this.updateWalkables(t)}}}),Obstacle}.call(this)},{"parallelio-tiles":82}],13:[function(t,e,r){var i,n,a;i=t("spark-starter").Element,a=t("parallelio-timing"),n=t("spark-starter").EventEmitter,e.exports=function(){class PathWalk extends i{constructor(t,e,r){super(),this.walker=t,this.path=e,this.setProperties(r)}start(){if(this.path.solution||this.path.calcul(),this.path.solution)return this.pathTimeout=this.timing.setTimeout(()=>this.finish(),this.totalTime),this.pathTimeout.updater.addCallback(this.callback("update"))}stop(){return this.pathTimeout.pause()}update(){var t;return t=this.path.getPosAtPrc(this.pathTimeout.getPrc()),this.walker.tile=t.tile,this.walker.offsetX=t.offsetX,this.walker.offsetY=t.offsetY}finish(){return this.update(),this.trigger("finished"),this.end()}interrupt(){return this.update(),this.trigger("interrupted"),this.end()}end(){return this.trigger("end"),this.destroy()}destroy(){return this.walker.walk===this&&(this.walker.walk=null),this.pathTimeout.destroy(),this.destroyProperties(),this.removeAllListeners()}}return PathWalk.include(n.prototype),PathWalk.properties({speed:{default:5},timing:{calcul:function(){return new a}},pathLength:{calcul:function(){return this.path.solution.getTotalLength()}},totalTime:{calcul:function(){return this.pathLength/this.speed*1e3}}}),PathWalk}.call(this)},{"parallelio-timing":107,"spark-starter":153}],14:[function(t,e,r){var i,n,a;i=t("spark-starter").Element,n=t("./LineOfSight"),a=t("parallelio-timing"),e.exports=function(){class PersonalWeapon extends i{constructor(t){super(),this.setProperties(t)}canBeUsed(){return this.charged}canUseOn(t){return this.canUseFrom(this.user.tile,t)}canUseFrom(t,e){return 1===this.range?this.inMeleeRange(t,e):this.inRange(t,e)&&this.hasLineOfSight(t,e)}inRange(t,e){var r,i;return i=e.tile||e,(null!=(r=t.dist(i))?r.length:void 0)<=this.range}inMeleeRange(t,e){var r;return r=e.tile||e,Math.abs(r.x-t.x)+Math.abs(r.y-t.y)===1}hasLineOfSight(t,e){var r,i;return i=e.tile||e,(r=new n(i.container,t.x+.5,t.y+.5,i.x+.5,i.y+.5)).traversableCallback=function(t){return t.walkable},r.getSuccess()}useOn(t){if(this.canBeUsed())return t.damage(this.power),this.charged=!1,this.recharge()}recharge(){return this.charging=!0,this.chargeTimeout=this.timing.setTimeout(()=>(this.charging=!1,this.recharged()),this.rechargeTime)}recharged(){return this.charged=!0}destroy(){if(this.chargeTimeout)return this.chargeTimeout.destroy()}}return PersonalWeapon.properties({rechargeTime:{default:1e3},charged:{default:!0},charging:{default:!0},power:{default:10},dps:{calcul:function(t){return t.prop("power")/t.prop("rechargeTime")*1e3}},range:{default:10},user:{default:null},timing:{calcul:function(){return new a}}}),PersonalWeapon}.call(this)},{"./LineOfSight":10,"parallelio-timing":107,"spark-starter":153}],15:[function(t,e,r){var i,n;i=t("spark-starter").Element,n=t("spark-starter").EventEmitter,e.exports=function(){class Player extends i{constructor(t){super(),this.setProperties(t)}setDefaults(){var t;if(t=0===this.game.players.length,this.game.players.add(this),t&&!this.controller&&this.game.defaultPlayerControllerClass)return this.controller=new this.game.defaultPlayerControllerClass}canTargetActionOn(t){var e,r;return null!=(e=this.selectedAction||(null!=(r=this.selected)?r.defaultAction:void 0))&&"function"==typeof e.canTarget&&e.canTarget(t)}canSelect(t){return"function"==typeof t.isSelectableBy&&t.isSelectableBy(this)}canFocusOn(t){return"function"==typeof t.IsFocusableBy?t.IsFocusableBy(this):"function"==typeof t.IsSelectableBy?t.IsSelectableBy(this):void 0}setActionTarget(t){var e,r;return(e=(e=this.selectedAction||(null!=(r=this.selected)?r.defaultAction:void 0)).withTarget(t)).isReady()?(e.start(),this.selectedAction=null):this.selectedAction=e}}return Player.include(n.prototype),Player.properties({name:{default:"Player"},focused:{},selected:{change:function(t){var e;if((null!=t?t.getProperty("selected"):void 0)&&(t.selected=!1),null!=(e=this.selected)?e.getProperty("selected"):void 0)return this.selected.selected=this}},selectedAction:{},controller:{change:function(t){if(this.controller)return this.controller.player=this}},game:{change:function(t){if(this.game)return this.setDefaults()}}}),Player}.call(this)},{"spark-starter":153}],16:[function(t,e,r){var i,n;i=t("spark-starter").Element,n=t("parallelio-timing"),e.exports=function(){class Projectile extends i{constructor(t){super(),this.setProperties(t),this.init()}init(){}launch(){return this.moving=!0,this.pathTimeout=this.timing.setTimeout(()=>(this.deliverPayload(),this.moving=!1),this.pathLength/this.speed*1e3)}deliverPayload(){var t;return(t=new this.propagationType({tile:this.target.tile||this.target,power:this.power,range:this.blastRange})).apply(),this.payloadDelivered(),t}payloadDelivered(){return this.destroy()}destroy(){return this.destroyProperties()}}return Projectile.properties({origin:{default:null},target:{default:null},power:{default:10},blastRange:{default:1},propagationType:{default:null},speed:{default:10},pathLength:{calcul:function(){var t;return null!=this.originTile&&null!=this.targetTile&&(t=this.originTile.dist(this.targetTile))?t.length:100}},originTile:{calcul:function(t){var e;if(null!=(e=t.prop("origin")))return e.tile||e}},targetTile:{calcul:function(t){var e;if(null!=(e=t.prop("target")))return e.tile||e}},container:{calcul:function(t){var e,r;return e=t.prop("originTile"),r=t.prop("targetTile"),e.container===r.container?e.container:t.prop("prcPath")>.5?r.container:e.container}},x:{calcul:function(t){var e;return e=t.prop("startPos"),(t.prop("targetPos").x-e.x)*t.prop("prcPath")+e.x}},y:{calcul:function(t){var e;return e=t.prop("startPos"),(t.prop("targetPos").y-e.y)*t.prop("prcPath")+e.y}},startPos:{calcul:function(t){var e,r,i,n;return n=t.prop("originTile"),e=t.prop("container"),i=this.startOffset,n.container!==e&&(r=e.dist(n.container),i.x+=r.x,i.y+=r.y),{x:n.x+i.x,y:n.y+i.y}},output:function(t){return Object.assign({},t)}},targetPos:{calcul:function(t){var e,r,i,n;return n=t.prop("targetTile"),e=t.prop("container"),i=this.targetOffset,n.container!==e&&(r=e.dist(n.container),i.x+=r.x,i.y+=r.y),{x:n.x+i.x,y:n.y+i.y}},output:function(t){return Object.assign({},t)}},startOffset:{default:{x:.5,y:.5},output:function(t){return Object.assign({},t)}},targetOffset:{default:{x:.5,y:.5},output:function(t){return Object.assign({},t)}},prcPath:{calcul:function(){var t;return(null!=(t=this.pathTimeout)?t.getPrc():void 0)||0}},timing:{calcul:function(){return new n}},moving:{default:!1}}),Projectile}.call(this)},{"parallelio-timing":107,"spark-starter":153}],17:[function(t,e,r){var i,n,a,s,o,l,c=[].indexOf;a=t("spark-starter").Element,l=t("parallelio-tiles").TileContainer,o=t("parallelio-tiles").Tile,i=t("parallelio-tiles").Direction,n=t("./Door"),e.exports=s=function(){class RoomGenerator extends a{constructor(t){super(),this.setProperties(t)}initTiles(){return this.finalTiles=null,this.rooms=[],this.free=this.tileContainer.allTiles().filter(t=>{var e,r,n,a;for(r=0,n=(a=i.all).length;r<n;r++)if(e=a[r],null==this.tileContainer.getTile(t.x+e.x,t.y+e.y))return!1;return!0})}calcul(){for(this.initTiles(),0;this.step()||this.newRoom();)0;return this.createDoors(),this.rooms,this.makeFinalTiles()}makeFinalTiles(){return this.finalTiles=this.tileContainer.allTiles().map(t=>{var e;if(null!=t.factory)return e={x:t.x,y:t.y},null!=t.factoryOptions&&(e=Object.assign(e,t.factoryOptions)),t.factory(e)}).filter(t=>null!=t)}getTiles(){return null==this.finalTiles&&this.calcul(),this.finalTiles}newRoom(){if(this.free.length)return this.volume=Math.floor(this.rng()*(this.maxVolume-this.minVolume))+this.minVolume,this.room=new RoomGenerator.Room}randomDirections(){var t,e,r,n;for(e=void 0,n=void 0,t=(r=i.adjacents.slice()).length;t;)e=Math.floor(this.rng()*t),n=r[--t],r[t]=r[e],r[e]=n;return r}step(){var t,e;if(this.room){if(this.free.length&&this.room.tiles.length<this.volume-1){if(this.room.tiles.length){for(e=this.randomDirections(),t=!1;e.length&&!t;)t=this.expand(this.room,e.pop(),this.volume);return t||this.roomDone(),t}return this.allocateTile(this.randomFreeTile(),this.room),!0}return this.roomDone(),!1}}roomDone(){return this.rooms.push(this.room),this.allocateWalls(this.room),this.room=null}expand(t,e,r=0){var i,n,a,s,o,l,c;for(l=!1,i=0,n=(s=t.tiles).length;i<n;i++)c=s[i],(0===r||t.tiles.length<r)&&((a=this.tileOffsetIsFree(c,e))&&(this.allocateTile(a,t),l=!0),(o=this.tileOffsetIsFree(c,e,2))&&!this.tileOffsetIsFree(c,e,3)&&this.allocateTile(o,t));return l}allocateWalls(t){var e,r,n,a,s,o,l,p,h;for(p=[],r=0,n=(l=t.tiles).length;r<n;r++)h=l[r],p.push(function(){var r,n,l,p;for(p=[],r=0,n=(l=i.all).length;r<n;r++)e=l[r],null!=(a=this.tileContainer.getTile(h.x+e.x,h.y+e.y))&&a.room!==t?(c.call(i.corners,e)<0&&(o=this.tileContainer.getTile(h.x+2*e.x,h.y+2*e.y),s=null!=(null!=o?o.room:void 0)?o.room:null,t.addWall(a,s),null!=s&&s.addWall(a,t)),a.factory=this.wallFactory,p.push(this.allocateTile(a))):p.push(void 0);return p}.call(this));return p}createDoors(){var t,e,r,i,a,s,o;for(a=[],e=0,r=(i=this.rooms).length;e<r;e++)s=i[e],a.push(function(){var e,r,i,a;for(a=[],e=0,r=(i=s.wallsByRooms()).length;e<r;e++)null!=(o=i[e]).room&&s.doorsForRoom(o.room)<1?((t=o.tiles[Math.floor(this.rng()*o.tiles.length)]).factory=this.doorFactory,t.factoryOptions={direction:this.tileContainer.getTile(t.x+1,t.y).factory===this.floorFactory?n.directions.vertical:n.directions.horizontal},s.addDoor(t,o.room),a.push(o.room.addDoor(t,s))):a.push(void 0);return a}.call(this));return a}allocateTile(t,e=null){var r;if(null!=e&&(e.addTile(t),t.factory=this.floorFactory),(r=this.free.indexOf(t))>-1)return this.free.splice(r,1)}tileOffsetIsFree(t,e,r=1){return this.tileIsFree(t.x+e.x*r,t.y+e.y*r)}tileIsFree(t,e){var r;return null!=(r=this.tileContainer.getTile(t,e))&&c.call(this.free,r)>=0&&r}randomFreeTile(){return this.free[Math.floor(this.rng()*this.free.length)]}}return RoomGenerator.properties({rng:{default:Math.random},maxVolume:{default:25},minVolume:{default:50},width:{default:30},height:{default:15},tileContainer:{calcul:function(){var t,e,r,i,n,a,s;for(n=new l,a=t=0,r=this.width;0<=r?t<=r:t>=r;a=0<=r?++t:--t)for(s=e=0,i=this.height;0<=i?e<=i:e>=i;s=0<=i?++e:--e)n.addTile(new o(a,s));return n}},floorFactory:{default:function(t){return new o(t.x,t.y)}},wallFactory:{default:null},doorFactory:{calcul:function(){return this.floorFactory}}}),RoomGenerator}.call(this),s.Room=class Room{constructor(){this.tiles=[],this.walls=[],this.doors=[]}addTile(t){return this.tiles.push(t),t.room=this}containsWall(t){var e,r,i,n;for(e=0,r=(i=this.walls).length;e<r;e++)if((n=i[e]).tile===t)return n;return!1}addWall(t,e){var r;return(r=this.containsWall(t))?r.nextRoom=e:this.walls.push({tile:t,nextRoom:e})}wallsByRooms(){var t,e,r,i,n,a,s;for(a=[],n=[],t=0,e=(i=this.walls).length;t<e;t++)s=i[t],-1===(r=a.indexOf(s.nextRoom))&&(r=a.length,a.push(s.nextRoom),n.push({room:s.nextRoom,tiles:[]})),n[r].tiles.push(s.tile);return n}addDoor(t,e){return this.doors.push({tile:t,nextRoom:e})}doorsForRoom(t){var e,r,i,n,a;for(a=[],r=0,i=(n=this.doors).length;r<i;r++)(e=n[r]).nextRoom===t&&a.push(e.tile);return a}}},{"./Door":6,"parallelio-tiles":82,"spark-starter":153}],18:[function(t,e,r){var i,n,a,s;a=t("parallelio-tiles").Tiled,s=t("parallelio-timing"),i=t("./Damageable"),n=t("./Projectile"),e.exports=function(){class ShipWeapon extends a{constructor(t){super(),this.setProperties(t)}fire(){var t;if(this.canFire)return(t=new n({origin:this,target:this.target,power:this.power,blastRange:this.blastRange,propagationType:this.propagationType,speed:this.projectileSpeed,timing:this.timing})).launch(),this.charged=!1,this.recharge(),t}recharge(){return this.charging=!0,this.chargeTimeout=this.timing.setTimeout(()=>(this.charging=!1,this.recharged()),this.rechargeTime)}recharged(){if(this.charged=!0,this.autoFire)return this.fire()}}return ShipWeapon.extend(i),ShipWeapon.properties({rechargeTime:{default:1e3},power:{default:10},blastRange:{default:1},propagationType:{default:null},projectileSpeed:{default:10},target:{default:null,change:function(){if(this.autoFire)return this.fire()}},charged:{default:!0},charging:{default:!0},enabled:{default:!0},autoFire:{default:!0},criticalHealth:{default:.3},canFire:{get:function(){return this.target&&this.enabled&&this.charged&&this.health/this.maxHealth>=this.criticalHealth}},timing:{calcul:function(){return new s}}}),ShipWeapon}.call(this)},{"./Damageable":5,"./Projectile":16,"parallelio-tiles":82,"parallelio-timing":107}],19:[function(t,e,r){var i,n;i=t("spark-starter").Element,e.exports=n=function(){class Star extends i{constructor(t,e){super(),this.x=t,this.y=e,this.init()}init(){}linkTo(t){if(!this.links.findStar(t))return this.addLink(new this.constructor.Link(this,t))}addLink(t){return this.links.add(t),t.otherStar(this).links.add(t),t}dist(t,e){var r,i;return r=this.x-t,i=this.y-e,Math.sqrt(r*r+i*i)}}return Star.properties({x:{},y:{},links:{collection:{findStar:function(t){return this.find(function(e){return e.star2===t||e.star1===t})}}}}),Star.collenctionFn={closest:function(t,e){var r,i;return r=null,i=null,this.forEach(function(n){var a;if(a=n.dist(t,e),null==r||i>a)return r=n,i=a}),r},closests:function(t,e){var r;return(r=this.map(function(r){return{dist:r.dist(t,e),star:r}})).sort(function(t,e){return t.dist-e.dist}),this.copy(r.map(function(t){return t.star}))}},Star}.call(this),n.Link=class Link extends i{constructor(t,e){super(),this.star1=t,this.star2=e}remove(){return this.star1.links.remove(this),this.star2.links.remove(this)}otherStar(t){return t===this.star1?this.star2:this.star1}getLength(){return this.star1.dist(this.star2.x,this.star2.y)}inBoundaryBox(t,e,r=0){var i,n,a,s;return i=Math.min(this.star1.x,this.star2.x)-r,a=Math.min(this.star1.y,this.star2.y)-r,n=Math.max(this.star1.x,this.star2.x)+r,s=Math.max(this.star1.y,this.star2.y)+r,t>=i&&t<=n&&e>=a&&e<=s}closeToPoint(t,e,r){var i,n,a,s,o,l,c,p,h,u;return!!this.inBoundaryBox(t,e,r)&&(i=this.star1,l={x:t,y:e},c=(o=this.star2).x-i.x,h=o.y-i.y,Math.sqrt(c*c+h*h),a=Math.atan(h/c),p=l.x-i.x,u=l.y-i.y,s=Math.sqrt(p*p+u*u),n=a-Math.atan(u/p),Math.abs(Math.sin(n)*s)<=r)}intersectLink(t){var e,r,i,n,a,s,o,l,c,p,h,u;return o=this.star1.x,p=this.star1.y,l=this.star2.x,h=this.star2.y,c=t.star1.x,u=t.star1.y,s=((n=t.star2.x-c)*(p-u)-(a=t.star2.y-u)*(o-c))/(-n*(i=h-p)+(r=l-o)*a),(e=(-i*(o-c)+r*(p-u))/(-n*i+r*a))>0&&e<1&&s>0&&s<1}}},{"spark-starter":153}],20:[function(t,e,r){var i,n,a;i=t("spark-starter").Element,n=t("./Map"),a=t("./Star"),e.exports=function(){class StarMapGenerator extends i{constructor(t){super(),this.opt=Object.assign({},this.defOpt,t)}generate(){return this.map=new this.opt.mapClass,this.stars=this.map.locations.copy(),this.links=[],this.createStars(this.opt.nbStars),this.makeLinks(),this.map}createStars(t){var e,r,i;for(i=[],e=0,r=t;0<=r?e<r:e>r;0<=r?++e:--e)i.push(this.createStar());return i}createStar(){var t,e;for(t=0;e={x:Math.floor(this.opt.rng()*(this.opt.maxX-this.opt.minX)+this.opt.minX),y:Math.floor(this.opt.rng()*(this.opt.maxY-this.opt.minY)+this.opt.minY)},t<10&&this.stars.find(t=>t.dist(e.x,e.y)<=this.opt.minStarDist);)t++;if(!(t>=10))return this.createStarAtPos(e.x,e.y)}createStarAtPos(t,e){var r;return r=new this.opt.starClass(t,e),this.map.locations.push(r),this.stars.push(r),r}makeLinks(){return this.stars.forEach(t=>this.makeLinksFrom(t))}makeLinksFrom(t){var e,r,i,n,a,s;if(s=this.opt.linkTries,(n=this.opt.linksByStars-t.links.count())>0&&(r=this.stars.filter(e=>e!==t&&!t.links.findStar(e)).closests(t.x,t.y)).count()>0){for(a=[];e=r.shift(),i=this.createLink(t,e),this.validateLink(i)?(this.links.push(i),t.addLink(i),n-=1):s-=1,n>0&&s>0&&r.count()>0;)a.push(void 0);return a}}createLink(t,e){return new this.opt.linkClass(t,e)}validateLink(t){return!this.stars.find(e=>e!==t.star1&&e!==t.star2&&t.closeToPoint(e.x,e.y,this.opt.minLinkDist))&&!this.links.find(e=>e.intersectLink(t))}}return StarMapGenerator.prototype.defOpt={nbStars:20,minX:0,maxX:500,minY:0,maxY:500,minStarDist:10,minLinkDist:10,linksByStars:3,linkTries:3,mapClass:n,starClass:a,linkClass:a.Link,rng:Math.random},StarMapGenerator}.call(this)},{"./Map":11,"./Star":19,"spark-starter":153}],21:[function(t,e,r){var i,n;i=t("spark-starter").Element,n=t("parallelio-grids").Grid,e.exports=function(){class View extends i{setDefaults(){var t,e;if(!this.bounds)return this.grid=this.grid||(null!=(t=this.game._mainView)&&null!=(e=t.value)?e.grid:void 0)||new n,this.bounds=this.grid.addCell()}destroy(){return this.game=null}}return View.properties({game:{change:function(t){if(this.game&&(this.game.views.add(this),this.setDefaults()),t)return t.views.remove(this)}},x:{default:0},y:{default:0},grid:{default:null},bounds:{default:null}}),View}.call(this)},{"parallelio-grids":35,"spark-starter":153}],22:[function(t,e,r){var i,n,a,s;n=t("./LineOfSight"),i=t("parallelio-tiles").Direction,a=t("parallelio-tiles").TileContainer,s=t("parallelio-tiles").TileReference,e.exports=class VisionCalculator{constructor(t,e={x:.5,y:.5}){this.originTile=t,this.offset=e,this.pts={},this.visibility={},this.stack=[],this.calculated=!1}calcul(){for(this.init();this.stack.length;)this.step();return this.calculated=!0}init(){var t;return this.pts={},this.visibility={},[{x:0,y:0},{x:1,y:0},{x:0,y:1},{x:1,y:1}].forEach(t=>this.setPt(this.originTile.x+t.x,this.originTile.y+t.y,!0)),t=[{x:-1,y:-1},{x:-1,y:0},{x:-1,y:1},{x:-1,y:2},{x:2,y:-1},{x:2,y:0},{x:2,y:1},{x:2,y:2},{x:0,y:-1},{x:1,y:-1},{x:0,y:2},{x:1,y:2}],this.stack=t.map(t=>({x:this.originTile.x+t.x,y:this.originTile.y+t.y}))}setPt(t,e,r){var i;return this.pts[t+":"+e]=r,(i=[{x:0,y:0},{x:-1,y:0},{x:0,y:-1},{x:-1,y:-1}]).forEach(n=>this.addVisibility(t+n.x,e+n.y,r?1/i.length:0))}getPt(t,e){return this.pts[t+":"+e]}addVisibility(t,e,r){return null==this.visibility[t]&&(this.visibility[t]={}),null!=this.visibility[t][e]?this.visibility[t][e]+=r:this.visibility[t][e]=r}getVisibility(t,e){return null==this.visibility[t]||null==this.visibility[t][e]?0:this.visibility[t][e]}canProcess(t,e){return!this.stack.some(r=>r.x===t&&r.y===e)&&null==this.getPt(t,e)}step(){var t,e;if(e=this.stack.shift(),(t=new n(this.originTile.container,this.originTile.x+this.offset.x,this.originTile.y+this.offset.y,e.x,e.y)).reverseTracing(),t.traversableCallback=((e,r,i)=>{if(null!=e)return 1===this.getVisibility(e.x,e.y)?t.forceSuccess():e.transparent}),this.setPt(e.x,e.y,t.getSuccess()),t.getSuccess())return i.all.forEach(t=>{var r;if(r={x:e.x+t.x,y:e.y+t.y},this.canProcess(r.x,r.y))return this.stack.push(r)})}getBounds(){var t,e,r,i,n;for(i in t={top:null,left:null,bottom:null,right:null},r=this.visibility)for(n in e=r[i])e[n],(null==t.top||n<t.top)&&(t.top=n),(null==t.left||i<t.left)&&(t.left=i),(null==t.bottom||n>t.bottom)&&(t.bottom=n),(null==t.right||i>t.right)&&(t.right=i);return t}toContainer(){var t,e,r,i,n,o,l;for(o in(r=new a).owner=!1,e=this.visibility)for(l in t=e[o])n=t[l],i=this.originTile.container.getTile(o,l),0!==n&&null!=i&&((i=new s(i)).visibility=n,r.addTile(i));return r}toMap(){var t,e,r,i,n,a,s,o,l;for(l=t=r=(s=Object.assign({map:[]},this.getBounds())).top,i=s.bottom-1;r<=i?t<=i:t>=i;l=r<=i?++t:--t)for(s.map[l-s.top]=[],o=e=n=s.left,a=s.right-1;n<=a?e<=a:e>=a;o=n<=a?++e:--e)s.map[l-s.top][o-s.left]=this.getVisibility(o,l);return s}}},{"./LineOfSight":10,"parallelio-tiles":82}],23:[function(t,e,r){var i,n;i=t("spark-starter").Element,n=t("spark-starter").EventEmitter,e.exports=function(){class Action extends i{constructor(t){super(),this.setProperties(t)}withActor(t){return this.actor!==t?this.copyWith({actor:t}):this}copyWith(t){return new this.constructor(Object.assign({base:this},this.getManualDataProperties(),t))}start(){return this.execute()}validActor(){return null!=this.actor}isReady(){return this.validActor()}finish(){return this.trigger("finished"),this.end()}interrupt(){return this.trigger("interrupted"),this.end()}end(){return this.trigger("end"),this.destroy()}destroy(){return this.destroyProperties()}}return Action.include(n.prototype),Action.properties({actor:{}}),Action}.call(this)},{"spark-starter":153}],24:[function(t,e,r){var i;i=t("spark-starter").Element,e.exports=function(){class ActionProvider extends i{}return ActionProvider.properties({providedActions:{collection:!0}}),ActionProvider}.call(this)},{"spark-starter":153}],25:[function(t,e,r){var i,n,a,s;s=t("./WalkAction"),a=t("./TargetAction"),i=t("spark-starter").EventBind,n=t("spark-starter").PropertyWatcher,e.exports=function(){class AttackAction extends a{validTarget(){return this.targetIsAttackable()&&(this.canUseWeapon()||this.canWalkToTarget())}targetIsAttackable(){return this.target.damageable&&this.target.health>=0}canMelee(){return Math.abs(this.target.tile.x-this.actor.tile.x)+Math.abs(this.target.tile.y-this.actor.tile.y)===1}canUseWeapon(){return null!=this.bestUsableWeapon}canUseWeaponAt(t){var e;return(null!=(e=this.actor.weapons)?e.length:void 0)&&this.actor.weapons.find(e=>e.canUseFrom(t,this.target))}canWalkToTarget(){return this.walkAction.isReady()}useWeapon(){return this.bestUsableWeapon.useOn(this.target),this.finish()}execute(){return null!=this.actor.walk&&this.actor.walk.interrupt(),null!=this.bestUsableWeapon?this.bestUsableWeapon.charged?this.useWeapon():this.weaponChargeWatcher.bind():(this.walkAction.on("finished",()=>{if(this.interruptBinder.unbind(),this.isReady())return this.start()}),this.interruptBinder.bindTo(this.walkAction),this.walkAction.execute())}}return AttackAction.properties({walkAction:{calcul:function(){var t;return(t=new s({actor:this.actor,target:this.target,parent:this.parent})).pathFinder.arrivedCallback=(t=>this.canUseWeaponAt(t.tile)),t}},bestUsableWeapon:{calcul:function(t){var e,r;return t.propPath("actor.tile"),(null!=(e=this.actor.weapons)?e.length:void 0)?((r=this.actor.weapons.filter(t=>t.canUseOn(this.target))).sort((t,e)=>e.dps-t.dps),r[0]):null}},interruptBinder:{calcul:function(){return new i("interrupted",null,()=>this.interrupt())},destroy:!0},weaponChargeWatcher:{calcul:function(){return new n({callback:()=>{if(this.bestUsableWeapon.charged)return this.useWeapon()},property:this.bestUsableWeapon.getPropertyInstance("charged")})},destroy:!0}}),AttackAction}.call(this)},{"./TargetAction":28,"./WalkAction":30,"spark-starter":153}],26:[function(t,e,r){var i,n,a,s,o,l,c;c=t("./WalkAction"),i=t("./AttackAction"),l=t("./TargetAction"),s=t("parallelio-pathfinder"),a=t("../LineOfSight"),o=t("spark-starter").PropertyWatcher,n=t("spark-starter").EventBind,e.exports=function(){class AttackMoveAction extends l{isEnemy(t){var e;return null!=(e=this.actor.owner)&&"function"==typeof e.isEnemy?e.isEnemy(t):void 0}validTarget(){return this.walkAction.validTarget()}testEnemySpotted(){if(this.invalidateEnemySpotted(),this.enemySpotted)return this.attackAction=new i({actor:this.actor,target:this.enemySpotted}),this.attackAction.on("finished",()=>{if(this.isReady())return this.start()}),this.interruptBinder.bindTo(this.attackAction),this.walkAction.interrupt(),this.invalidateWalkAction(),this.attackAction.execute()}execute(){if(!this.testEnemySpotted())return this.walkAction.on("finished",()=>this.finished()),this.interruptBinder.bindTo(this.walkAction),this.tileWatcher.bind(),this.walkAction.execute()}}return AttackMoveAction.properties({walkAction:{calcul:function(){return new c({actor:this.actor,target:this.target,parent:this.parent})}},enemySpotted:{calcul:function(){var t;return this.path=new s(this.actor.tile.container,this.actor.tile,!1,{validTile:t=>t.transparent&&new a(this.actor.tile.container,this.actor.tile.x,this.actor.tile.y,t.x,t.y).getSuccess(),arrived:t=>t.enemy=t.tile.children.find(t=>this.isEnemy(t)),efficiency:t=>{}}),this.path.calcul(),null!=(t=this.path.solution)?t.enemy:void 0}},tileWatcher:{calcul:function(){return new o({callback:()=>this.testEnemySpotted(),property:this.actor.getPropertyInstance("tile")})},destroy:!0},interruptBinder:{calcul:function(){return new n("interrupted",null,()=>this.interrupt())},destroy:!0}}),AttackMoveAction}.call(this)},{"../LineOfSight":10,"./AttackAction":25,"./TargetAction":28,"./WalkAction":30,"parallelio-pathfinder":56,"spark-starter":153}],27:[function(t,e,r){var i;i=t("./ActionProvider"),e.exports=function(){class SimpleActionProvider extends i{}return SimpleActionProvider.properties({providedActions:{calcul:function(){var t;return"object"==typeof(t=this.actions||this.constructor.actions)&&(t=Object.keys(t).map(function(e){return t[e]})),t.map(t=>new t({target:this}))}}}),SimpleActionProvider}.call(this)},{"./ActionProvider":24}],28:[function(t,e,r){var i;i=t("./Action"),e.exports=function(){class TargetAction extends i{withTarget(t){return this.target!==t?this.copyWith({target:t}):this}canTarget(t){var e;if((e=this.withTarget(t)).validTarget())return e}validTarget(){return null!=this.target}isReady(){return super.isReady()&&this.validTarget()}}return TargetAction.properties({target:{}}),TargetAction}.call(this)},{"./Action":23}],29:[function(t,e,r){var i,n;i=t("./ActionProvider"),n=t("spark-starter").Mixable,e.exports=function(){class TiledActionProvider extends i{validActionTile(t){return null!=t}prepareActionTile(t){if(!t.getPropertyInstance("providedActions"))return n.Extension.make(i.prototype,t)}}return TiledActionProvider.properties({tile:{change:function(t,e){return e(t),this.forwardedActions}},actionTiles:{collection:!0,calcul:function(t){var e;return(e=t.prop("tile"))?this.actionTilesCoord.map(t=>e.getRelativeTile(t.x,t.y)).filter(t=>this.validActionTile(t)):[]}},forwardedActions:{collection:{compare:function(t,e){return t.action===e.action&&t.location===e.location}},calcul:function(t){var e,r;return e=t.prop("actionTiles"),r=t.prop("providedActions"),e.reduce((t,e)=>t.concat(r.map(function(t){return{action:t,location:e}})),[])},itemAdded:function(t){return this.prepareActionTile(t.location),t.location.providedActions.add(t.action)},itemRemoved:function(t){return t.location.providedActions.remove(t.action)}}}),TiledActionProvider.prototype.actionTilesCoord=[{x:0,y:-1},{x:-1,y:0},{x:0,y:0},{x:1,y:0},{x:0,y:1}],TiledActionProvider}.call(this)},{"./ActionProvider":24,"spark-starter":153}],30:[function(t,e,r){var i,n,a;i=t("parallelio-pathfinder"),n=t("../PathWalk"),a=t("./TargetAction"),e.exports=function(){class WalkAction extends a{execute(){return null!=this.actor.walk&&this.actor.walk.interrupt(),this.walk=this.actor.walk=new n(this.actor,this.pathFinder),this.actor.walk.on("finished",()=>this.finish()),this.actor.walk.on("interrupted",()=>this.interrupt()),this.actor.walk.start()}destroy(){if(super.destroy(),this.walk)return this.walk.destroy()}validTarget(){return this.pathFinder.calcul(),null!=this.pathFinder.solution}}return WalkAction.properties({pathFinder:{calcul:function(){return new i(this.actor.tile.container,this.actor.tile,this.target,{validTile:t=>"function"==typeof this.actor.canGoOnTile?this.actor.canGoOnTile(t):t.walkable})}}}),WalkAction}.call(this)},{"../PathWalk":13,"./TargetAction":28,"parallelio-pathfinder":56}],31:[function(t,e,r){e.exports={AutomaticDoor:t("./AutomaticDoor"),Character:t("./Character"),CharacterAI:t("./CharacterAI"),DamagePropagation:t("./DamagePropagation"),Damageable:t("./Damageable"),Door:t("./Door"),Element:t("./Element"),Floor:t("./Floor"),Game:t("./Game"),LineOfSight:t("./LineOfSight"),Map:t("./Map"),Obstacle:t("./Obstacle"),PathWalk:t("./PathWalk"),PersonalWeapon:t("./PersonalWeapon"),Player:t("./Player"),Projectile:t("./Projectile"),RoomGenerator:t("./RoomGenerator"),ShipWeapon:t("./ShipWeapon"),Star:t("./Star"),StarMapGenerator:t("./StarMapGenerator"),View:t("./View"),VisionCalculator:t("./VisionCalculator"),actions:{Action:t("./actions/Action"),ActionProvider:t("./actions/ActionProvider"),AttackAction:t("./actions/AttackAction"),AttackMoveAction:t("./actions/AttackMoveAction"),SimpleActionProvider:t("./actions/SimpleActionProvider"),TargetAction:t("./actions/TargetAction"),TiledActionProvider:t("./actions/TiledActionProvider"),WalkAction:t("./actions/WalkAction")}}},{"./AutomaticDoor":1,"./Character":2,"./CharacterAI":3,"./DamagePropagation":4,"./Damageable":5,"./Door":6,"./Element":7,"./Floor":8,"./Game":9,"./LineOfSight":10,"./Map":11,"./Obstacle":12,"./PathWalk":13,"./PersonalWeapon":14,"./Player":15,"./Projectile":16,"./RoomGenerator":17,"./ShipWeapon":18,"./Star":19,"./StarMapGenerator":20,"./View":21,"./VisionCalculator":22,"./actions/Action":23,"./actions/ActionProvider":24,"./actions/AttackAction":25,"./actions/AttackMoveAction":26,"./actions/SimpleActionProvider":27,"./actions/TargetAction":28,"./actions/TiledActionProvider":29,"./actions/WalkAction":30}],32:[function(t,e,r){!function(t){var r=t("undefined"!=typeof Parallelio?Parallelio:this.Parallelio);r.definition=t,null!=e?e.exports=r:"undefined"!=typeof Parallelio&&null!==Parallelio?Parallelio.Grid=r:(null==this.Parallelio&&(this.Parallelio={}),this.Parallelio.Grid=r)}(function(e){null==e&&(e={});var r=e.hasOwnProperty("Element")?e.Element:t("spark-starter").Element,i=e.hasOwnProperty("EventEmitter")?e.EventEmitter:t("spark-starter").EventEmitter,n=e.hasOwnProperty("GridCell")?e.GridCell:t("./GridCell"),a=e.hasOwnProperty("GridRow")?e.GridRow:t("./GridRow");return function(){class Grid extends r{addCell(t=null){var e,r;return t||(t=new n),r=this.getFreeSpot(),(e=this.rows.get(r.row))||(e=this.addRow()),e.addCell(t),t}addRow(t=null){return t||(t=new a),this.rows.push(t),t}getFreeSpot(){var t;return t=null,this.rows.some(e=>{if(e.cells.length<this.maxColumns)return t={row:e.rowPosition,column:e.cells.length}}),t||(t=this.maxColumns>this.rows.length?{row:this.rows.length,column:0}:{row:0,column:this.maxColumns+1}),t}}return Grid.extend(i),Grid.properties({rows:{collection:!0,itemAdded:function(t){return t.grid=this},itemRemoved:function(t){if(t.grid===this)return t.grid=null}},maxColumns:{calcul:function(t){return t.prop("rows").reduce(function(e,r){return Math.max(e,t.prop("cells",r).length)},0)}}}),Grid}.call(this)})},{"./GridCell":33,"./GridRow":34,"spark-starter":55}],33:[function(t,e,r){!function(t){var r=t("undefined"!=typeof Parallelio?Parallelio:this.Parallelio);r.definition=t,null!=e?e.exports=r:"undefined"!=typeof Parallelio&&null!==Parallelio?Parallelio.GridCell=r:(null==this.Parallelio&&(this.Parallelio={}),this.Parallelio.GridCell=r)}(function(e){null==e&&(e={});var r=e.hasOwnProperty("Element")?e.Element:t("spark-starter").Element,i=e.hasOwnProperty("EventEmitter")?e.EventEmitter:t("spark-starter").EventEmitter;return function(){class GridCell extends r{}return GridCell.extend(i),GridCell.properties({grid:{calcul:function(t){return t.prop("grid",t.prop("row"))}},row:{},columnPosition:{calcul:function(t){var e;if(e=t.prop("row"))return t.prop("cells",e).indexOf(this)}},width:{calcul:function(t){return 1/t.prop("cells",t.prop("row")).length}},left:{calcul:function(t){return t.prop("width")*t.prop("columnPosition")}},right:{calcul:function(t){return t.prop("width")*(t.prop("columnPosition")+1)}},height:{calcul:function(t){return t.prop("height",t.prop("row"))}},top:{calcul:function(t){return t.prop("top",t.prop("row"))}},bottom:{calcul:function(t){return t.prop("bottom",t.prop("row"))}}}),GridCell}.call(this)})},{"spark-starter":55}],34:[function(t,e,r){!function(t){var r=t("undefined"!=typeof Parallelio?Parallelio:this.Parallelio);r.definition=t,null!=e?e.exports=r:"undefined"!=typeof Parallelio&&null!==Parallelio?Parallelio.GridRow=r:(null==this.Parallelio&&(this.Parallelio={}),this.Parallelio.GridRow=r)}(function(e){null==e&&(e={});var r=e.hasOwnProperty("Element")?e.Element:t("spark-starter").Element,i=e.hasOwnProperty("EventEmitter")?e.EventEmitter:t("spark-starter").EventEmitter,n=e.hasOwnProperty("GridCell")?e.GridCell:t("./GridCell");return function(){class GridRow extends r{addCell(t=null){return t||(t=new n),this.cells.push(t),t}}return GridRow.extend(i),GridRow.properties({grid:{},cells:{collection:!0,itemAdded:function(t){return t.row=this},itemRemoved:function(t){if(t.row===this)return t.row=null}},rowPosition:{calcul:function(t){var e;if(e=t.prop("grid"))return t.prop("rows",e).indexOf(this)}},height:{calcul:function(t){return 1/t.prop("rows",t.prop("grid")).length}},top:{calcul:function(t){return t.prop("height")*t.prop("rowPosition")}},bottom:{calcul:function(t){return t.prop("height")*(t.prop("rowPosition")+1)}}}),GridRow}.call(this)})},{"./GridCell":33,"spark-starter":55}],35:[function(t,e,r){e&&(e.exports={Grid:t("./Grid.js"),GridCell:t("./GridCell.js"),GridRow:t("./GridRow.js")})},{"./Grid.js":32,"./GridCell.js":33,"./GridRow.js":34}],36:[function(t,e,r){!function(t){var r=t("undefined"!=typeof Spark?Spark:this.Spark);r.definition=t,null!=e?e.exports=r:"undefined"!=typeof Spark&&null!==Spark?Spark.Binder=r:(null==this.Spark&&(this.Spark={}),this.Spark.Binder=r)}(function(){return function(){class Binder{bind(){return this.binded||null==this.callback||null==this.target||this.doBind(),this.binded=!0}doBind(){throw new Error("Not implemented")}unbind(){return this.binded&&null!=this.callback&&null!=this.target&&this.doUnbind(),this.binded=!1}doUnbind(){throw new Error("Not implemented")}equals(t){return this.constructor.compareRefered(t,this)}getRef(){}static compareRefered(t,e){return t===e||null!=t&&null!=e&&t.constructor===e.constructor&&this.compareRef(t.ref,e.ref)}static compareRef(t,e){return null!=t&&null!=e&&(t===e||Array.isArray(t)&&Array.isArray(t)&&t.every((r,i)=>this.compareRefered(t[i],e[i]))||"object"==typeof t&&"object"==typeof e&&Object.keys(t).join()===Object.keys(e).join()&&Object.keys(t).every(r=>this.compareRefered(t[r],e[r])))}}return Object.defineProperty(Binder.prototype,"ref",{get:function(){return this.getRef()}}),Binder}.call(this)})},{}],37:[function(t,e,r){!function(t){var r=t("undefined"!=typeof Spark?Spark:this.Spark);r.definition=t,null!=e?e.exports=r:"undefined"!=typeof Spark&&null!==Spark?Spark.Collection=r:(null==this.Spark&&(this.Spark={}),this.Spark.Collection=r)}(function(){var t;return t=function(){class Collection{constructor(t){null!=t?"function"==typeof t.toArray?this._array=t.toArray():Array.isArray(t)?this._array=t:this._array=[t]:this._array=[]}changed(){}checkChanges(t,e=!0,r=null){return null==r&&(r=function(t,e){return t===e}),t=this.copy(t.slice()),this.count()!==t.length||(e?this.some(function(e,i){return!r(t.get(i),e)}):this.some(function(e){return!t.pluck(function(t){return r(e,t)})}))}get(t){return this._array[t]}set(t,e){var r;return this._array[t]!==e&&(r=this.toArray(),this._array[t]=e,this.changed(r)),e}add(t){if(!this._array.includes(t))return this.push(t)}remove(t){var e,r;if(-1!==(e=this._array.indexOf(t)))return r=this.toArray(),this._array.splice(e,1),this.changed(r)}pluck(t){var e,r,i;return(r=this._array.findIndex(t))>-1?(i=this.toArray(),e=this._array[r],this._array.splice(r,1),this.changed(i),e):null}toArray(){return this._array.slice()}count(){return this._array.length}static newSubClass(t,e){var r;return"object"==typeof t?(r=class extends(this){},Object.assign(r.prototype,t),new r(e)):new this(e)}copy(t){return null==t&&(t=this.toArray()),new this.constructor(t)}equals(t){return this.count()===("function"==typeof t.count?t.count():t.length)&&this.every(function(e,r){return t[r]===e})}getAddedFrom(t){return this._array.filter(function(e){return!t.includes(e)})}getRemovedFrom(t){return t.filter(t=>!this.includes(t))}}return Collection.readFunctions=["every","find","findIndex","forEach","includes","indexOf","join","lastIndexOf","map","reduce","reduceRight","some","toString"],Collection.readListFunctions=["concat","filter","slice"],Collection.writefunctions=["pop","push","reverse","shift","sort","splice","unshift"],Collection.readFunctions.forEach(function(t){return Collection.prototype[t]=function(...e){return this._array[t](...e)}}),Collection.readListFunctions.forEach(function(t){return Collection.prototype[t]=function(...e){return this.copy(this._array[t](...e))}}),Collection.writefunctions.forEach(function(t){return Collection.prototype[t]=function(...e){var r,i;return r=this.toArray(),i=this._array[t](...e),this.changed(r),i}}),Collection}.call(this),Object.defineProperty(t.prototype,"length",{get:function(){return this.count()}}),("undefined"!=typeof Symbol&&null!==Symbol?Symbol.iterator:void 0)&&(t.prototype[Symbol.iterator]=function(){return this._array[Symbol.iterator]()}),t})},{}],38:[function(t,e,r){!function(t){var r=t("undefined"!=typeof Spark?Spark:this.Spark);r.definition=t,null!=e?e.exports=r:"undefined"!=typeof Spark&&null!==Spark?Spark.Element=r:(null==this.Spark&&(this.Spark={}),this.Spark.Element=r)}(function(e){null==e&&(e={});var r=e.hasOwnProperty("Property")?e.Property:t("./Property"),i=e.hasOwnProperty("Mixable")?e.Mixable:t("./Mixable");return class Element extends i{tap(t){var e;return e=Array.prototype.slice.call(arguments),"function"==typeof t?t.apply(this,e.slice(1)):this[t].apply(this,e.slice(1)),this}callback(t){return null==this._callbacks&&(this._callbacks={}),null==this._callbacks[t]&&(this._callbacks[t]=((...e)=>(this[t].apply(this,e),null)),this._callbacks[t].owner=this),this._callbacks[t]}getFinalProperties(){return null!=this._properties?["_properties"].concat(this._properties.map(function(t){return t.name})):[]}extended(t){var e,i,n,a,s,o;if(null!=this._properties){for(o=[],e=0,i=(s=this._properties).length;e<i;e++)a=s[e],n=Object.assign({},a.options),o.push(new r(a.name,n).bind(t));return o}}static property(t,e){return new r(t,e).bind(this.prototype)}static properties(t){var e,r,i;for(r in i=[],t)e=t[r],i.push(this.property(r,e));return i}}})},{"./Mixable":42,"./Property":44}],39:[function(t,e,r){!function(t){var r=t("undefined"!=typeof Spark?Spark:this.Spark);r.definition=t,null!=e?e.exports=r:"undefined"!=typeof Spark&&null!==Spark?Spark.EventBind=r:(null==this.Spark&&(this.Spark={}),this.Spark.EventBind=r)}(function(e){null==e&&(e={});var r=e.hasOwnProperty("Binder")?e.Binder:t("./Binder");return class EventBind extends r{constructor(t,e,r){super(),this.event=t,this.target=e,this.callback=r}getRef(){return{event:this.event,target:this.target,callback:this.callback}}doBind(){if("function"==typeof this.target.addEventListener)return this.target.addEventListener(this.event,this.callback);if("function"==typeof this.target.addListener)return this.target.addListener(this.event,this.callback);if("function"==typeof this.target.on)return this.target.on(this.event,this.callback);throw new Error("No function to add event listeners was found")}doUnbind(){if("function"==typeof this.target.removeEventListener)return this.target.removeEventListener(this.event,this.callback);if("function"==typeof this.target.removeListener)return this.target.removeListener(this.event,this.callback);if("function"==typeof this.target.off)return this.target.off(this.event,this.callback);throw new Error("No function to remove event listeners was found")}equals(t){return super.equals(t)&&t.event===this.event}match(t,e){return t===this.event&&e===this.target}static checkEmitter(t,e=!0){if("function"==typeof t.addEventListener||"function"==typeof t.addListener||"function"==typeof t.on)return!0;if(e)throw new Error("No function to add event listeners was found");return!1}}})},{"./Binder":36}],40:[function(t,e,r){!function(t){var r=t("undefined"!=typeof Spark?Spark:this.Spark);r.definition=t,null!=e?e.exports=r:"undefined"!=typeof Spark&&null!==Spark?Spark.EventEmitter=r:(null==this.Spark&&(this.Spark={}),this.Spark.EventEmitter=r)}(function(){return function(){class EventEmitter{getAllEvents(){return this._events||(this._events={})}getListeners(t){var e;return(e=this.getAllEvents())[t]||(e[t]=[])}hasListener(t,e){return this.getListeners(t).includes(e)}addListener(t,e){if(!this.hasListener(t,e))return this.getListeners(t).push(e),this.listenerAdded(t,e)}listenerAdded(t,e){}removeListener(t,e){var r,i;if(-1!==(r=(i=this.getListeners(t)).indexOf(e)))return i.splice(r,1),this.listenerRemoved(t,e)}listenerRemoved(t,e){}emitEvent(t,...e){return this.getListeners(t).slice().forEach(function(t){return t(...e)})}}return EventEmitter.prototype.emit=EventEmitter.prototype.emitEvent,EventEmitter.prototype.trigger=EventEmitter.prototype.emitEvent,EventEmitter.prototype.on=EventEmitter.prototype.addListener,EventEmitter.prototype.off=EventEmitter.prototype.removeListener,EventEmitter}.call(this)})},{}],41:[function(t,e,r){!function(t){var r=t("undefined"!=typeof Spark?Spark:this.Spark);r.definition=t,null!=e?e.exports=r:"undefined"!=typeof Spark&&null!==Spark?Spark.Invalidator=r:(null==this.Spark&&(this.Spark={}),this.Spark.Invalidator=r)}(function(e){null==e&&(e={});var r,i=e.hasOwnProperty("Binder")?e.Binder:t("./Binder"),n=e.hasOwnProperty("EventBind")?e.EventBind:t("./EventBind");return r=function(t,e){var r,i;return(i=t.findIndex(e))>-1?(r=t[i],t.splice(i,1),r):null},function(){class Invalidator extends i{constructor(t,e=null){super(),this.property=t,this.obj=e,this.invalidationEvents=[],this.recycled=[],this.unknowns=[],this.strict=this.constructor.strict,this.invalidated=!1,this.invalidateCallback=(()=>(this.invalidate(),null)),this.invalidateCallback.owner=this}invalidate(){var t;return this.invalidated=!0,"function"==typeof this.property?this.property():"function"==typeof this.callback?this.callback():null!=this.property&&"function"==typeof this.property.invalidate?this.property.invalidate():"string"==typeof this.property?(t="invalidate"+this.property.charAt(0).toUpperCase()+this.property.slice(1),"function"==typeof this.obj[t]?this.obj[t]():this.obj[this.property]=null):void 0}unknown(){return"function"==typeof this.property.unknown?this.property.unknown():this.invalidate()}addEventBind(t,e,r){return this.addBinder(new n(t,e,r))}addBinder(t){if(null==t.callback&&(t.callback=this.invalidateCallback),!this.invalidationEvents.some(function(e){return e.equals(t)}))return this.invalidationEvents.push(r(this.recycled,function(e){return e.equals(t)})||t)}getUnknownCallback(t,e){var r;return(r=(()=>this.addUnknown(function(){return e[t]},t,e))).ref={prop:t,target:e},r}addUnknown(t,e,r){if(!this.findUnknown(e,r))return t.ref={prop:e,target:r},this.unknowns.push(t),this.unknown()}findUnknown(t,e){if(null!=t||null!=e)return this.unknowns.find(function(r){return r.ref.prop===t&&r.ref.target===e})}event(t,e=this.obj){if(this.checkEmitter(e))return this.addEventBind(t,e)}value(t,e,r=this.obj){return this.event(e,r),t}prop(t,e=this.obj){if("string"!=typeof t)throw new Error("Property name must be a string");return this.checkEmitter(e)?(this.addEventBind(t+"Invalidated",e,this.getUnknownCallback(t,e)),this.value(e[t],t+"Updated",e)):e[t]}propInitiated(t,e=this.obj){var r;return!(r=e.getPropertyInstance(t).initiated)&&this.checkEmitter(e)&&this.event(t+"Updated",e),r}funct(t){var e,r;return e=new Invalidator(()=>this.addUnknown(()=>{var i;if(i=t(e),r!==i)return this.invalidate()},e)),r=t(e),this.invalidationEvents.push(e),r}validateUnknowns(t,e=this.obj){var r;return r=this.unknowns,this.unknowns=[],r.forEach(function(t){return t()})}isEmpty(){return 0===this.invalidationEvents.length}bind(){return this.invalidated=!1,this.invalidationEvents.forEach(function(t){return t.bind()})}recycle(t){var e,r;return this.recycled=this.invalidationEvents,this.invalidationEvents=[],e=(()=>(this.recycled.forEach(function(t){return t.unbind()}),this.recycled=[])),"function"==typeof t?t.length>1?t(this,e):(r=t(this),e(),r):e}checkEmitter(t){return n.checkEmitter(t,this.strict)}unbind(){return this.invalidationEvents.forEach(function(t){return t.unbind()})}}return Invalidator.strict=!0,Invalidator}.call(this)})},{"./Binder":36,"./EventBind":39}],42:[function(t,e,r){!function(t){var r=t("undefined"!=typeof Spark?Spark:this.Spark);r.definition=t,null!=e?e.exports=r:"undefined"!=typeof Spark&&null!==Spark?Spark.Mixable=r:(null==this.Spark&&(this.Spark={}),this.Spark.Mixable=r)}(function(){var t=[].indexOf;return function(){class Mixable{static extend(t){if(this.Extension.make(t,this),null!=t.prototype)return this.Extension.make(t.prototype,this.prototype)}static include(t){return this.Extension.make(t,this.prototype)}}return Mixable.Extension={make:function(t,e){var r,i,n,a;for(r=0,i=(a=this.getExtensionProperties(t,e)).length;r<i;r++)n=a[r],Object.defineProperty(e,n.name,n);if(e.extensions=(e.extensions||[]).concat([t]),"function"==typeof t.extended)return t.extended(e)},alwaysFinal:["extended","extensions","__super__","constructor"],getExtensionProperties:function(e,r){var i,n,a;return i=this.alwaysFinal,a=this.getPrototypeChain(r),n=[],this.getPrototypeChain(e).every(function(s){var o;if(!a.includes(s))return o=i,null!=e.getFinalProperties&&(o=o.concat(e.getFinalProperties())),"function"==typeof s&&(o=o.concat(["length","prototype","name"])),n=n.concat(Object.getOwnPropertyNames(s).filter(e=>!r.hasOwnProperty(e)&&"__"!==e.substr(0,2)&&t.call(o,e)<0&&!n.find(function(t){return t.name===e})).map(function(t){var e;return(e=Object.getOwnPropertyDescriptor(s,t)).name=t,e})),!0}),n},getPrototypeChain:function(t){var e,r;for(r=[],e=Object.getPrototypeOf(Object);r.push(t),(t=Object.getPrototypeOf(t))&&t!==Object&&t!==e;);return r}},Mixable}.call(this)})},{}],43:[function(t,e,r){!function(t){var r=t("undefined"!=typeof Spark?Spark:this.Spark);r.definition=t,null!=e?e.exports=r:"undefined"!=typeof Spark&&null!==Spark?Spark.Overrider=r:(null==this.Spark&&(this.Spark={}),this.Spark.Overrider=r)}(function(){return function(){class Overrider{static overrides(t){return this.Override.applyMany(this.prototype,this.name,t)}getFinalProperties(){return null!=this._overrides?["_overrides"].concat(Object.keys(this._overrides)):[]}extended(t){if(null!=this._overrides&&this.constructor.Override.applyMany(t,this.constructor.name,this._overrides),this.constructor===Overrider)return t.extended=this.extended}}return Overrider.Override={makeMany:function(t,e,r){var i,n,a;for(n in a=[],r)i=r[n],a.push(this.make(t,e,n,i));return a},applyMany:function(t,e,r){var i,n,a;for(i in a=[],r)"function"==typeof(n=r[i])&&(n=this.make(t,e,i,n)),a.push(this.apply(t,e,n));return a},make:function(t,e,r,i){var n;return(n={fn:{current:i},name:r}).fn["with"+e]=i,n},emptyFn:function(){},apply:function(t,e,r){var i,n,a,s,o;return i=r.name,n=null!=t._overrides?Object.assign({},t._overrides):{},o=(null!=(a=t._overrides)&&null!=(s=a[i])?s.fn.current:void 0)||t[i],r=Object.assign({},r),null!=n[i]?r.fn=Object.assign({},n[i].fn,r.fn):r.fn=Object.assign({},r.fn),r.fn["without"+e]=o||this.emptyFn,null==o?r.missingWithout="without"+e:r.missingWithout&&(r.fn[r.missingWithout]=o),Object.defineProperty(t,i,{configurable:!0,get:function(){var t,e,n,a;for(n in t=r.fn.current.bind(this),a=r.fn)e=a[n],t[n]=e.bind(this);return this.constructor.prototype!==this&&Object.defineProperty(this,i,{value:t}),t}}),n[i]=r,t._overrides=n}},Overrider}.call(this)})},{}],44:[function(t,e,r){!function(t){var r=t("undefined"!=typeof Spark?Spark:this.Spark);r.definition=t,null!=e?e.exports=r:"undefined"!=typeof Spark&&null!==Spark?Spark.Property=r:(null==this.Spark&&(this.Spark={}),this.Spark.Property=r)}(function(e){null==e&&(e={});var r=e.hasOwnProperty("BasicProperty")?e.BasicProperty:t("./PropertyTypes/BasicProperty"),i=e.hasOwnProperty("CollectionProperty")?e.CollectionProperty:t("./PropertyTypes/CollectionProperty"),n=e.hasOwnProperty("ComposedProperty")?e.ComposedProperty:t("./PropertyTypes/ComposedProperty"),a=e.hasOwnProperty("DynamicProperty")?e.DynamicProperty:t("./PropertyTypes/DynamicProperty"),s=e.hasOwnProperty("CalculatedProperty")?e.CalculatedProperty:t("./PropertyTypes/CalculatedProperty"),o=e.hasOwnProperty("InvalidatedProperty")?e.InvalidatedProperty:t("./PropertyTypes/InvalidatedProperty"),l=e.hasOwnProperty("ActivableProperty")?e.ActivableProperty:t("./PropertyTypes/ActivableProperty"),c=e.hasOwnProperty("UpdatedProperty")?e.UpdatedProperty:t("./PropertyTypes/UpdatedProperty"),p=e.hasOwnProperty("PropertyOwner")?e.PropertyOwner:t("./PropertyOwner"),h=e.hasOwnProperty("Mixable")?e.Mixable:t("./Mixable");return function(){class Property{constructor(t,e={}){this.name=t,this.options=e}bind(t){var e;return this,"function"==typeof t.getProperty&&t.getProperty(this.name)===this||("function"==typeof t.getProperty&&null!=(e=t.getProperty(this.name))&&this.override(e),this.getInstanceType().bind(t,this),t._properties=(t._properties||[]).concat([this]),null!=e&&(t._properties=t._properties.filter(function(t){return t!==e})),this.makeOwner(t)),this}override(t){var e,r,i,n;if(null==this.options.parent){for(e in this.options.parent=t.options,i=[],r=t.options)n=r[e],"function"==typeof this.options[e]&&"function"==typeof n?i.push(this.options[e].overrided=n):void 0===this.options[e]?i.push(this.options[e]=n):i.push(void 0);return i}}makeOwner(t){var e;if(!(null!=(e=t.extensions)?e.includes(p.prototype):void 0))return h.Extension.make(p.prototype,t)}getInstanceVarName(){return this.options.instanceVarName||"_"+this.name}isInstantiated(t){return null!=t[this.getInstanceVarName()]}getInstance(t){var e,r;return r=this.getInstanceVarName(),this.isInstantiated(t)||(e=this.getInstanceType(),t[r]=new e(this,t)),t[r]}getInstanceType(){return this.instanceType||this.composers.forEach(t=>t.compose(this)),this.instanceType}}return Property.prototype.composers=[n,i,a,r,c,s,o,l],Property}.call(this)})},{"./Mixable":42,"./PropertyOwner":45,"./PropertyTypes/ActivableProperty":46,"./PropertyTypes/BasicProperty":47,"./PropertyTypes/CalculatedProperty":48,"./PropertyTypes/CollectionProperty":49,"./PropertyTypes/ComposedProperty":50,"./PropertyTypes/DynamicProperty":51,"./PropertyTypes/InvalidatedProperty":52,"./PropertyTypes/UpdatedProperty":53}],45:[function(t,e,r){!function(t){var r=t("undefined"!=typeof Spark?Spark:this.Spark);r.definition=t,null!=e?e.exports=r:"undefined"!=typeof Spark&&null!==Spark?Spark.PropertyOwner=r:(null==this.Spark&&(this.Spark={}),this.Spark.PropertyOwner=r)}(function(){return class PropertyOwner{getProperty(t){return this._properties&&this._properties.find(function(e){return e.name===t})}getPropertyInstance(t){var e;if(e=this.getProperty(t))return e.getInstance(this)}getProperties(){return this._properties.slice()}getPropertyInstances(){return this._properties.map(t=>t.getInstance(this))}getInstantiatedProperties(){return this._properties.filter(t=>t.isInstantiated(this)).map(t=>t.getInstance(this))}getManualDataProperties(){return this._properties.reduce((t,e)=>{var r;return e.isInstantiated(this)&&(r=e.getInstance(this)).calculated&&r.manual&&(t[e.name]=r.value),t},{})}setProperties(t,e={}){var r,i,n;for(r in t)n=t[r],null!=e.whitelist&&-1===e.whitelist.indexOf(r)||null!=e.blacklist&&-1!==e.blacklist.indexOf(r)||null!=(i=this.getPropertyInstance(r))&&i.set(n);return this}destroyProperties(){return this.getInstantiatedProperties().forEach(t=>t.destroy()),this._properties=[],!0}listenerAdded(t,e){return this._properties.forEach(e=>{if(e.getInstanceType().prototype.changeEventName===t)return e.getInstance(this).get()})}extended(t){return t.listenerAdded=this.listenerAdded}}})},{}],46:[function(t,e,r){!function(t){var r=t("undefined"!=typeof Spark?Spark:this.Spark);r.definition=t,null!=e?e.exports=r:"undefined"!=typeof Spark&&null!==Spark?Spark.ActivableProperty=r:(null==this.Spark&&(this.Spark={}),this.Spark.ActivableProperty=r)}(function(e){null==e&&(e={});var r=e.hasOwnProperty("Invalidator")?e.Invalidator:t("../Invalidator"),i=e.hasOwnProperty("BasicProperty")?e.BasicProperty:t("./BasicProperty"),n=e.hasOwnProperty("Overrider")?e.Overrider:t("../Overrider");return function(){class ActivableProperty extends i{isActive(){return!0}manualActive(){return this.active}callbackActive(){return(this.activeInvalidator||new r(this,this.obj)).recycle((t,e)=>(this.active=this.callOptionFunct(this.activeFunct,t),e(),this.active||t.isEmpty()?(t.unbind(),this.activeInvalidator=null):(this.invalidator=t,this.activeInvalidator=t,t.bind()))),this.active}static compose(t){if(void 0!==t.options.active){if(t.instanceType.extend(ActivableProperty),"boolean"==typeof t.options.active)return t.instanceType.prototype.active=t.options.active,t.instanceType.prototype.isActive=this.prototype.manualActive;if("function"==typeof t.options.active)return t.instanceType.prototype.activeFunct=t.options.active,t.instanceType.prototype.isActive=this.prototype.callbackActive}}}return ActivableProperty.extend(n),ActivableProperty.overrides({get:function(){var t;return this.isActive()?(t=this.get.withoutActivableProperty(),this.pendingChanges&&this.changed(this.pendingOld),t):void(this.initiated=!0)},changed:function(t){return this.isActive()?(this.pendingChanges=!1,this.pendingOld=void 0,this.changed.withoutActivableProperty(t)):(this.pendingChanges=!0,void 0===this.pendingOld&&(this.pendingOld=t)),this}}),ActivableProperty}.call(this)})},{"../Invalidator":41,"../Overrider":43,"./BasicProperty":47}],47:[function(t,e,r){!function(t){var r=t("undefined"!=typeof Spark?Spark:this.Spark);r.definition=t,null!=e?e.exports=r:"undefined"!=typeof Spark&&null!==Spark?Spark.BasicProperty=r:(null==this.Spark&&(this.Spark={}),this.Spark.BasicProperty=r)}(function(e){null==e&&(e={});var r=e.hasOwnProperty("Mixable")?e.Mixable:t("../Mixable");return class BasicProperty extends r{constructor(t,e){super(),this.property=t,this.obj=e,this.init()}init(){return this.value=this.ingest(this.default),this.calculated=!1}get(){return this.calculated=!0,this.output()}set(t){return this.setAndCheckChanges(t)}callbackSet(t){return this.callOptionFunct("set",t),this}setAndCheckChanges(t){var e;return t=this.ingest(t),this.revalidated(),this.checkChanges(t,this.value)&&(e=this.value,this.value=t,this.manual=!0,this.changed(e)),this}checkChanges(t,e){return t!==e}destroy(){}callOptionFunct(t,...e){return"string"==typeof t&&(t=this.property.options[t]),"function"==typeof t.overrided&&e.push((...e)=>this.callOptionFunct(t.overrided,...e)),t.apply(this.obj,e)}revalidated(){return this.calculated=!0,this.initiated=!0}ingest(t){return"function"==typeof this.property.options.ingest?this.callOptionFunct("ingest",t):t}output(){return"function"==typeof this.property.options.output?this.callOptionFunct("output",this.value):this.value}changed(t){return this.callChangedFunctions(t),"function"==typeof this.obj.emitEvent&&(this.obj.emitEvent(this.updateEventName,[t]),this.obj.emitEvent(this.changeEventName,[t])),this}callChangedFunctions(t){if("function"==typeof this.property.options.change)return this.callOptionFunct("change",t)}hasChangedFunctions(){return"function"==typeof this.property.options.change}hasChangedEvents(){return"function"==typeof this.obj.getListeners&&this.obj.getListeners(this.changeEventName).length>0}static compose(t){return null==t.instanceType&&(t.instanceType=class extends BasicProperty{}),"function"==typeof t.options.set?t.instanceType.prototype.set=this.prototype.callbackSet:t.instanceType.prototype.set=this.prototype.setAndCheckChanges,t.instanceType.prototype.default=t.options.default,t.instanceType.prototype.initiated=void 0!==t.options.default,this.setEventNames(t)}static setEventNames(t){return t.instanceType.prototype.changeEventName=t.options.changeEventName||t.name+"Changed",t.instanceType.prototype.updateEventName=t.options.updateEventName||t.name+"Updated",t.instanceType.prototype.invalidateEventName=t.options.invalidateEventName||t.name+"Invalidated"}static bind(t,e){var r,i;return r=e.name.charAt(0).toUpperCase()+e.name.slice(1),i={configurable:!0,get:function(){return e.getInstance(this).get()}},!1!==e.options.set&&(i.set=function(t){return e.getInstance(this).set(t)}),Object.defineProperty(t,e.name,i),t["get"+r]=function(){return e.getInstance(this).get()},!1!==e.options.set&&(t["set"+r]=function(t){return e.getInstance(this).set(t),this}),t["invalidate"+r]=function(){return e.getInstance(this).invalidate(),this}}}})},{"../Mixable":42}],48:[function(t,e,r){!function(t){var r=t("undefined"!=typeof Spark?Spark:this.Spark);r.definition=t,null!=e?e.exports=r:"undefined"!=typeof Spark&&null!==Spark?Spark.CalculatedProperty=r:(null==this.Spark&&(this.Spark={}),this.Spark.CalculatedProperty=r)}(function(e){null==e&&(e={});e.hasOwnProperty("Invalidator")?e.Invalidator:t("../Invalidator");var r=e.hasOwnProperty("DynamicProperty")?e.DynamicProperty:t("./DynamicProperty"),i=e.hasOwnProperty("Overrider")?e.Overrider:t("../Overrider");return function(){class CalculatedProperty extends r{calcul(){return this.value=this.callOptionFunct(this.calculFunct),this.manual=!1,this.revalidated(),this.value}static compose(t){if("function"==typeof t.options.calcul&&(t.instanceType.prototype.calculFunct=t.options.calcul,!(t.options.calcul.length>0)))return t.instanceType.extend(CalculatedProperty)}}return CalculatedProperty.extend(i),CalculatedProperty.overrides({get:function(){var t,e;return this.invalidator&&this.invalidator.validateUnknowns(),this.calculated||(e=this.value,t=this.initiated,this.calcul(),this.checkChanges(this.value,e)&&(t?this.changed(e):"function"==typeof this.obj.emitEvent&&this.obj.emitEvent(this.updateEventName,[e]))),this.output()}}),CalculatedProperty}.call(this)})},{"../Invalidator":41,"../Overrider":43,"./DynamicProperty":51}],49:[function(t,e,r){!function(t){var r=t("undefined"!=typeof Spark?Spark:this.Spark);r.definition=t,null!=e?e.exports=r:"undefined"!=typeof Spark&&null!==Spark?Spark.CollectionProperty=r:(null==this.Spark&&(this.Spark={}),this.Spark.CollectionProperty=r)}(function(e){null==e&&(e={});var r=e.hasOwnProperty("DynamicProperty")?e.DynamicProperty:t("./DynamicProperty"),i=e.hasOwnProperty("Collection")?e.Collection:t("../Collection");return function(){class CollectionProperty extends r{ingest(t){return"function"==typeof this.property.options.ingest&&(t=this.callOptionFunct("ingest",t)),null==t?[]:"function"==typeof t.toArray?t.toArray():Array.isArray(t)?t.slice():[t]}checkChangedItems(t,e){var r;return"function"==typeof this.collectionOptions.compare&&(r=this.collectionOptions.compare),new i(t).checkChanges(e,this.collectionOptions.ordered,r)}output(){var t,e,r;return r=this.value,"function"==typeof this.property.options.output&&(r=this.callOptionFunct("output",this.value)),e=this,(t=i.newSubClass(this.collectionOptions,r)).changed=function(t){return e.changed(t)},t}callChangedFunctions(t){return"function"==typeof this.property.options.itemAdded&&this.value.forEach((e,r)=>{if(!t.includes(e))return this.callOptionFunct("itemAdded",e,r)}),"function"==typeof this.property.options.itemRemoved&&t.forEach((t,e)=>{if(!this.value.includes(t))return this.callOptionFunct("itemRemoved",t,e)}),super.callChangedFunctions(t)}hasChangedFunctions(){return super.hasChangedFunctions()||"function"==typeof this.property.options.itemAdded||"function"==typeof this.property.options.itemRemoved}static compose(t){if(null!=t.options.collection&&(t.instanceType=class extends CollectionProperty{},t.instanceType.prototype.collectionOptions=Object.assign({},this.defaultCollectionOptions,"object"==typeof t.options.collection?t.options.collection:{}),null!=t.options.collection.compare))return t.instanceType.prototype.checkChanges=this.prototype.checkChangedItems}}return CollectionProperty.defaultCollectionOptions={compare:!1,ordered:!0},CollectionProperty}.call(this)})},{"../Collection":37,"./DynamicProperty":51}],50:[function(t,e,r){!function(t){var r=t("undefined"!=typeof Spark?Spark:this.Spark);r.definition=t,null!=e?e.exports=r:"undefined"!=typeof Spark&&null!==Spark?Spark.ComposedProperty=r:(null==this.Spark&&(this.Spark={}),this.Spark.ComposedProperty=r)}(function(e){null==e&&(e={});var r,i=e.hasOwnProperty("CalculatedProperty")?e.CalculatedProperty:t("./CalculatedProperty"),n=e.hasOwnProperty("Invalidator")?e.Invalidator:t("../Invalidator"),a=e.hasOwnProperty("Collection")?e.Collection:t("../Collection");return(r=function(){class ComposedProperty extends i{init(){return super.init(),this.initComposed()}initComposed(){return this.property.options.hasOwnProperty("default")?this.default=this.property.options.default:this.default=this.value=!0,this.members=new ComposedProperty.Members(this.property.options.members),this.members.changed=(t=>this.invalidate()),this.join="function"==typeof this.property.options.composed?this.property.options.composed:!1===this.property.options.default?ComposedProperty.joinFunctions.or:ComposedProperty.joinFunctions.and}calcul(){return this.invalidator||(this.invalidator=new n(this,this.obj)),this.invalidator.recycle((t,e)=>(this.value=this.members.reduce((t,e)=>{var r;return r="function"==typeof e?e(this.invalidator):e,this.join(t,r)},this.default),e(),t.isEmpty()?this.invalidator=null:t.bind())),this.revalidated(),this.value}static compose(t){if(null!=t.options.composed)return t.instanceType=class extends ComposedProperty{}}static bind(t,e){return i.bind(t,e),Object.defineProperty(t,e.name+"Members",{configurable:!0,get:function(){return e.getInstance(this).members}})}}return ComposedProperty.joinFunctions={and:function(t,e){return t&&e},or:function(t,e){return t||e}},ComposedProperty}.call(this)).Members=class Members extends a{addPropertyRef(t,e){var r;if(-1===this.findRefIndex(t,e))return(r=function(r){return r.prop(t,e)}).ref={name:t,obj:e},this.push(r)}addValueRef(t,e,r){var i;if(-1===this.findRefIndex(e,r))return(i=function(e){return t}).ref={name:e,obj:r,val:t},this.push(i)}setValueRef(t,e,r){var i,n;return-1===(n=this.findRefIndex(e,r))?this.addValueRef(t,e,r):this.get(n).ref.val!==t?((i=function(e){return t}).ref={name:e,obj:r,val:t},this.set(n,i)):void 0}getValueRef(t,e){return this.findByRef(t,e).ref.val}addFunctionRef(t,e,r){if(-1===this.findRefIndex(e,r))return t.ref={name:e,obj:r},this.push(t)}findByRef(t,e){return this._array[this.findRefIndex(t,e)]}findRefIndex(t,e){return this._array.findIndex(function(r){return null!=r.ref&&r.ref.obj===e&&r.ref.name===t})}removeRef(t,e){var r,i;if(-1!==(r=this.findRefIndex(t,e)))return i=this.toArray(),this._array.splice(r,1),this.changed(i)}},r})},{"../Collection":37,"../Invalidator":41,"./CalculatedProperty":48}],51:[function(t,e,r){!function(t){var r=t("undefined"!=typeof Spark?Spark:this.Spark);r.definition=t,null!=e?e.exports=r:"undefined"!=typeof Spark&&null!==Spark?Spark.DynamicProperty=r:(null==this.Spark&&(this.Spark={}),this.Spark.DynamicProperty=r)}(function(e){null==e&&(e={});e.hasOwnProperty("Invalidator")?e.Invalidator:t("../Invalidator");var r=e.hasOwnProperty("BasicProperty")?e.BasicProperty:t("./BasicProperty");return class DynamicProperty extends r{callbackGet(){var t;return t=this.callOptionFunct("get"),this.revalidated(),t}invalidate(){return(this.calculated||!1===this.active)&&(this.calculated=!1,this._invalidateNotice()),this}_invalidateNotice(){return this.isImmediate()?(this.get(),!1):("function"==typeof this.obj.emitEvent&&this.obj.emitEvent(this.invalidateEventName),!0)}isImmediate(){return!1!==this.property.options.immediate&&(!0===this.property.options.immediate||("function"==typeof this.property.options.immediate?this.callOptionFunct("immediate"):this.hasChangedEvents()||this.hasChangedFunctions()))}static compose(t){if("function"!=typeof t.options.get&&"function"!=typeof t.options.calcul&&"function"!=typeof t.options.active||null==t.instanceType&&(t.instanceType=class extends DynamicProperty{}),"function"==typeof t.options.get)return t.instanceType.prototype.get=this.prototype.callbackGet}}})},{"../Invalidator":41,"./BasicProperty":47}],52:[function(t,e,r){!function(t){var r=t("undefined"!=typeof Spark?Spark:this.Spark);r.definition=t,null!=e?e.exports=r:"undefined"!=typeof Spark&&null!==Spark?Spark.InvalidatedProperty=r:(null==this.Spark&&(this.Spark={}),this.Spark.InvalidatedProperty=r)}(function(e){null==e&&(e={});var r=e.hasOwnProperty("Invalidator")?e.Invalidator:t("../Invalidator"),i=e.hasOwnProperty("CalculatedProperty")?e.CalculatedProperty:t("./CalculatedProperty");return function(){class InvalidatedProperty extends i{unknown(){return(this.calculated||!1===this.active)&&this._invalidateNotice(),this}static compose(t){if("function"==typeof t.options.calcul&&t.options.calcul.length>0)return t.instanceType.extend(InvalidatedProperty)}}return InvalidatedProperty.overrides({calcul:function(){return this.invalidator||(this.invalidator=new r(this,this.obj)),this.invalidator.recycle((t,e)=>(this.value=this.callOptionFunct(this.calculFunct,t),this.manual=!1,e(),t.isEmpty()?this.invalidator=null:t.bind())),this.revalidated(),this.value},destroy:function(){if(this.destroy.withoutInvalidatedProperty(),null!=this.invalidator)return this.invalidator.unbind()},invalidate:function(){return(this.calculated||!1===this.active)&&(this.calculated=!1,this._invalidateNotice()&&!this.calculated&&null!=this.invalidator&&this.invalidator.unbind()),this}}),InvalidatedProperty}.call(this)})},{"../Invalidator":41,"./CalculatedProperty":48}],53:[function(t,e,r){!function(t){var r=t("undefined"!=typeof Spark?Spark:this.Spark);r.definition=t,null!=e?e.exports=r:"undefined"!=typeof Spark&&null!==Spark?Spark.UpdatedProperty=r:(null==this.Spark&&(this.Spark={}),this.Spark.UpdatedProperty=r)}(function(e){null==e&&(e={});e.hasOwnProperty("Invalidator")?e.Invalidator:t("../Invalidator");var r=e.hasOwnProperty("DynamicProperty")?e.DynamicProperty:t("./DynamicProperty"),i=e.hasOwnProperty("Overrider")?e.Overrider:t("../Overrider");return function(){class UpdatedProperty extends r{initRevalidate(){return this.revalidateCallback=(()=>(this.updating=!0,this.get(),this.getUpdater().unbind(),this.pendingChanges&&this.changed(this.pendingOld),this.updating=!1)),this.revalidateCallback.owner=this}getUpdater(){return void 0===this.updater&&(null!=this.property.options.updater?(this.updater=this.property.options.updater,"function"==typeof this.updater.getBinder&&(this.updater=this.updater.getBinder()),"function"!=typeof this.updater.bind||"function"!=typeof this.updater.unbind?this.updater=null:this.updater.callback=this.revalidateCallback):this.updater=null),this.updater}static compose(t){if(null!=t.options.updater)return t.instanceType.extend(UpdatedProperty)}}return UpdatedProperty.extend(i),UpdatedProperty.overrides({init:function(){return this.init.withoutUpdatedProperty(),this.initRevalidate()},_invalidateNotice:function(){var t;return(t=this._invalidateNotice.withoutUpdatedProperty())&&this.getUpdater().bind(),t},isImmediate:function(){return!1},changed:function(t){return this.updating?(this.pendingChanges=!1,this.pendingOld=void 0,this.changed.withoutUpdatedProperty(t)):(this.pendingChanges=!0,void 0===this.pendingOld&&(this.pendingOld=t),this.getUpdater().bind()),this}}),UpdatedProperty}.call(this)})},{"../Invalidator":41,"../Overrider":43,"./DynamicProperty":51}],54:[function(t,e,r){!function(t){var r=t("undefined"!=typeof Spark?Spark:this.Spark);r.definition=t,null!=e?e.exports=r:"undefined"!=typeof Spark&&null!==Spark?Spark.Updater=r:(null==this.Spark&&(this.Spark={}),this.Spark.Updater=r)}(function(e){null==e&&(e={});var r,i=e.hasOwnProperty("Binder")?e.Binder:t("./Binder");return(r=class Updater{constructor(){this.callbacks=[],this.next=[],this.updating=!1}update(){for(this.updating=!0,this.next=this.callbacks.slice();this.callbacks.length>0;)this.callbacks.shift()();return this.callbacks=this.next,this.updating=!1,this}addCallback(t){if(this.callbacks.includes(t)||this.callbacks.push(t),this.updating&&!this.next.includes(t))return this.next.push(t)}nextTick(t){return this.updating?this.next.includes(t)?void 0:this.next.push(t):this.addCallback(t)}removeCallback(t){var e;if(-1!==(e=this.callbacks.indexOf(t))&&this.callbacks.splice(e,1),-1!==(e=this.next.indexOf(t)))return this.next.splice(e,1)}getBinder(){return new Updater.Binder(this)}destroy(){return this.callbacks=[],this.next=[]}}).Binder=function(t){return class Binder extends t{constructor(t,e){super(),this.target=t,this.callback=e}getRef(){return{target:this.target,callback:this.callback}}doBind(){return this.target.addCallback(this.callback)}doUnbind(){return this.target.removeCallback(this.callback)}}}.call(this,i),r})},{"./Binder":36}],55:[function(t,e,r){e&&(e.exports={Binder:t("./Binder.js"),Collection:t("./Collection.js"),Element:t("./Element.js"),EventBind:t("./EventBind.js"),EventEmitter:t("./EventEmitter.js"),Invalidator:t("./Invalidator.js"),Mixable:t("./Mixable.js"),Overrider:t("./Overrider.js"),Property:t("./Property.js"),PropertyOwner:t("./PropertyOwner.js"),Updater:t("./Updater.js"),ActivableProperty:t("./PropertyTypes/ActivableProperty.js"),BasicProperty:t("./PropertyTypes/BasicProperty.js"),CalculatedProperty:t("./PropertyTypes/CalculatedProperty.js"),CollectionProperty:t("./PropertyTypes/CollectionProperty.js"),ComposedProperty:t("./PropertyTypes/ComposedProperty.js"),DynamicProperty:t("./PropertyTypes/DynamicProperty.js"),InvalidatedProperty:t("./PropertyTypes/InvalidatedProperty.js"),UpdatedProperty:t("./PropertyTypes/UpdatedProperty.js")})},{"./Binder.js":36,"./Collection.js":37,"./Element.js":38,"./EventBind.js":39,"./EventEmitter.js":40,"./Invalidator.js":41,"./Mixable.js":42,"./Overrider.js":43,"./Property.js":44,"./PropertyOwner.js":45,"./PropertyTypes/ActivableProperty.js":46,"./PropertyTypes/BasicProperty.js":47,"./PropertyTypes/CalculatedProperty.js":48,"./PropertyTypes/CollectionProperty.js":49,"./PropertyTypes/ComposedProperty.js":50,"./PropertyTypes/DynamicProperty.js":51,"./PropertyTypes/InvalidatedProperty.js":52,"./PropertyTypes/UpdatedProperty.js":53,"./Updater.js":54}],56:[function(t,e,r){!function(t){var r=t("undefined"!=typeof Parallelio?Parallelio:this.Parallelio);r.definition=t,null!=e?e.exports=r:"undefined"!=typeof Parallelio&&null!==Parallelio?Parallelio.PathFinder=r:(null==this.Parallelio&&(this.Parallelio={}),this.Parallelio.PathFinder=r)}(function(e){null==e&&(e={});var r,i=e.hasOwnProperty("Element")?e.Element:t("spark-starter").Element;return(r=function(){class PathFinder extends i{constructor(t,e,r,i={}){super(),this.tilesContainer=t,this.from=e,this.to=r,this.reset(),null!=i.validTile&&(this.validTileCallback=i.validTile),null!=i.arrived&&(this.arrivedCallback=i.arrived),null!=i.efficiency&&(this.efficiencyCallback=i.efficiency)}reset(){return this.queue=[],this.paths={},this.solution=null,this.started=!1}calcul(){for(;!this.solution&&(!this.started||this.queue.length);)this.step();return this.getPath()}step(){var t;return this.queue.length?(t=this.queue.pop(),this.addNextSteps(t),!0):this.started?void 0:this.start()}start(){if(this.started=!0,!1===this.to||this.tileIsValid(this.to))return this.addNextSteps(),!0}getPath(){var t,e;if(this.solution){for(t=[this.solution],e=this.solution;null!=e.prev;)t.unshift(e.prev),e=e.prev;return t}}getPosAtPrc(t){if(isNaN(t))throw new Error("Invalid number");if(this.solution)return this.getPosAtTime(this.solution.getTotalLength()*t)}getPosAtTime(t){var e,r;if(this.solution){if(t>=this.solution.getTotalLength())return this.solution.posToTileOffset(this.solution.getExit().x,this.solution.getExit().y);for(r=this.solution;r.getStartLength()>t&&null!=r.prev;)r=r.prev;return e=(t-r.getStartLength())/r.getLength(),r.posToTileOffset(r.getEntry().x+(r.getExit().x-r.getEntry().x)*e,r.getEntry().y+(r.getExit().y-r.getEntry().y)*e)}}getSolutionTileList(){var t,e;if(this.solution){for(e=[(t=this.solution).tile];null!=t.prev;)t=t.prev,e.unshift(t.tile);return e}}tileIsValid(t){return null!=this.validTileCallback?this.validTileCallback(t):null!=t&&(!t.emulated||0!==t.tile&&!1!==t.tile)}getTile(t,e){var r;return null!=this.tilesContainer.getTile?this.tilesContainer.getTile(t,e):null!=(null!=(r=this.tilesContainer[e])?r[t]:void 0)?{x:t,y:e,tile:this.tilesContainer[e][t],emulated:!0}:void 0}getConnectedToTile(t){var e,r;return null!=t.getConnected?t.getConnected():(e=[],(r=this.getTile(t.x+1,t.y))&&e.push(r),(r=this.getTile(t.x-1,t.y))&&e.push(r),(r=this.getTile(t.x,t.y+1))&&e.push(r),(r=this.getTile(t.x,t.y-1))&&e.push(r),e)}addNextSteps(t=null){var e,r,i,n,a,s;for(s=null!=t?t.nextTile:this.from,a=[],e=0,r=(n=this.getConnectedToTile(s)).length;e<r;e++)i=n[e],this.tileIsValid(i)?a.push(this.addStep(new PathFinder.Step(this,null!=t?t:null,s,i))):a.push(void 0);return a}tileEqual(t,e){return t===e||(t.emulated||e.emulated)&&t.x===e.x&&t.y===e.y}arrivedAtDestination(t){return null!=this.arrivedCallback?this.arrivedCallback(t):this.tileEqual(t.tile,this.to)}addStep(t){var e;if(null==this.paths[t.getExit().x]&&(this.paths[t.getExit().x]={}),!(null!=this.paths[t.getExit().x][t.getExit().y]&&this.paths[t.getExit().x][t.getExit().y].getTotalLength()<=t.getTotalLength())&&(null!=this.paths[t.getExit().x][t.getExit().y]&&this.removeStep(this.paths[t.getExit().x][t.getExit().y]),this.paths[t.getExit().x][t.getExit().y]=t,this.queue.splice(this.getStepRank(t),0,t),e=new PathFinder.Step(this,t,t.nextTile,null),this.arrivedAtDestination(e)&&!(null!=this.solution&&this.solution.prev.getTotalLength()<=t.getTotalLength())))return this.solution=e}removeStep(t){var e;if((e=this.queue.indexOf(t))>-1)return this.queue.splice(e,1)}best(){return this.queue[this.queue.length-1]}getStepRank(t){return 0===this.queue.length?0:this._getStepRank(t.getEfficiency(),0,this.queue.length-1)}_getStepRank(t,e,r){var i,n;return n=Math.floor((r-e)/2)+e,(i=this.queue[n].getEfficiency())===t?n:i>t?n===e?e:this._getStepRank(t,e,n-1):n===r?r+1:this._getStepRank(t,n+1,r)}}return PathFinder.properties({validTileCallback:{}}),PathFinder}.call(this)).Step=class Step{constructor(t,e,r,i){this.pathFinder=t,this.prev=e,this.tile=r,this.nextTile=i}posToTileOffset(t,e){var r;return{x:t,y:e,tile:r=Math.floor(t)===this.tile.x&&Math.floor(e)===this.tile.y?this.tile:null!=this.nextTile&&Math.floor(t)===this.nextTile.x&&Math.floor(e)===this.nextTile.y?this.nextTile:null!=this.prev&&Math.floor(t)===this.prev.tile.x&&Math.floor(e)===this.prev.tile.y?this.prev.tile:console.log("Math.floor("+t+") == "+this.tile.x,"Math.floor("+e+") == "+this.tile.y,this),offsetX:t-r.x,offsetY:e-r.y}}getExit(){return null==this.exit&&(null!=this.nextTile?this.exit={x:(this.tile.x+this.nextTile.x+1)/2,y:(this.tile.y+this.nextTile.y+1)/2}:this.exit={x:this.tile.x+.5,y:this.tile.y+.5}),this.exit}getEntry(){return null==this.entry&&(null!=this.prev?this.entry={x:(this.tile.x+this.prev.tile.x+1)/2,y:(this.tile.y+this.prev.tile.y+1)/2}:this.entry={x:this.tile.x+.5,y:this.tile.y+.5}),this.entry}getLength(){return null==this.length&&(this.length=null==this.nextTile||null==this.prev?.5:this.prev.tile.x===this.nextTile.x||this.prev.tile.y===this.nextTile.y?1:Math.sqrt(.5)),this.length}getStartLength(){return null==this.startLength&&(this.startLength=null!=this.prev?this.prev.getTotalLength():0),this.startLength}getTotalLength(){return null==this.totalLength&&(this.totalLength=this.getStartLength()+this.getLength()),this.totalLength}getEfficiency(){return null==this.efficiency&&("function"==typeof this.pathFinder.efficiencyCallback?this.efficiency=this.pathFinder.efficiencyCallback(this):this.efficiency=1.1*-this.getRemaining()-this.getTotalLength()),this.efficiency}getRemaining(){var t,e,r,i;return null==this.remaining&&(t=this.getExit(),r=(e={x:this.pathFinder.to.x+.5,y:this.pathFinder.to.y+.5}).x-t.x,i=e.y-t.y,this.remaining=Math.sqrt(r*r+i*i)),this.remaining}},r})},{"spark-starter":76}],57:[function(t,e,r){arguments[4][36][0].apply(r,arguments)},{dup:36}],58:[function(t,e,r){arguments[4][37][0].apply(r,arguments)},{dup:37}],59:[function(t,e,r){arguments[4][38][0].apply(r,arguments)},{"./Mixable":63,"./Property":65,dup:38}],60:[function(t,e,r){arguments[4][39][0].apply(r,arguments)},{"./Binder":57,dup:39}],61:[function(t,e,r){arguments[4][40][0].apply(r,arguments)},{dup:40}],62:[function(t,e,r){arguments[4][41][0].apply(r,arguments)},{"./Binder":57,"./EventBind":60,dup:41}],63:[function(t,e,r){arguments[4][42][0].apply(r,arguments)},{dup:42}],64:[function(t,e,r){arguments[4][43][0].apply(r,arguments)},{dup:43}],65:[function(t,e,r){arguments[4][44][0].apply(r,arguments)},{"./Mixable":63,"./PropertyOwner":66,"./PropertyTypes/ActivableProperty":67,"./PropertyTypes/BasicProperty":68,"./PropertyTypes/CalculatedProperty":69,"./PropertyTypes/CollectionProperty":70,"./PropertyTypes/ComposedProperty":71,"./PropertyTypes/DynamicProperty":72,"./PropertyTypes/InvalidatedProperty":73,"./PropertyTypes/UpdatedProperty":74,dup:44}],66:[function(t,e,r){arguments[4][45][0].apply(r,arguments)},{dup:45}],67:[function(t,e,r){arguments[4][46][0].apply(r,arguments)},{"../Invalidator":62,"../Overrider":64,"./BasicProperty":68,dup:46}],68:[function(t,e,r){arguments[4][47][0].apply(r,arguments)},{"../Mixable":63,dup:47}],69:[function(t,e,r){arguments[4][48][0].apply(r,arguments)},{"../Invalidator":62,"../Overrider":64,"./DynamicProperty":72,dup:48}],70:[function(t,e,r){arguments[4][49][0].apply(r,arguments)},{"../Collection":58,"./DynamicProperty":72,dup:49}],71:[function(t,e,r){arguments[4][50][0].apply(r,arguments)},{"../Collection":58,"../Invalidator":62,"./CalculatedProperty":69,dup:50}],72:[function(t,e,r){arguments[4][51][0].apply(r,arguments)},{"../Invalidator":62,"./BasicProperty":68,dup:51}],73:[function(t,e,r){arguments[4][52][0].apply(r,arguments)},{"../Invalidator":62,"./CalculatedProperty":69,dup:52}],74:[function(t,e,r){arguments[4][53][0].apply(r,arguments)},{"../Invalidator":62,"../Overrider":64,"./DynamicProperty":72,dup:53}],75:[function(t,e,r){arguments[4][54][0].apply(r,arguments)},{"./Binder":57,dup:54}],76:[function(t,e,r){arguments[4][55][0].apply(r,arguments)},{"./Binder.js":57,"./Collection.js":58,"./Element.js":59,"./EventBind.js":60,"./EventEmitter.js":61,"./Invalidator.js":62,"./Mixable.js":63,"./Overrider.js":64,"./Property.js":65,"./PropertyOwner.js":66,"./PropertyTypes/ActivableProperty.js":67,"./PropertyTypes/BasicProperty.js":68,"./PropertyTypes/CalculatedProperty.js":69,"./PropertyTypes/CollectionProperty.js":70,"./PropertyTypes/ComposedProperty.js":71,"./PropertyTypes/DynamicProperty.js":72,"./PropertyTypes/InvalidatedProperty.js":73,"./PropertyTypes/UpdatedProperty.js":74,"./Updater.js":75,dup:55}],77:[function(t,e,r){!function(t){var r=t("undefined"!=typeof Parallelio?Parallelio:this.Parallelio);r.definition=t,null!=e?e.exports=r:"undefined"!=typeof Parallelio&&null!==Parallelio?Parallelio.Direction=r:(null==this.Parallelio&&(this.Parallelio={}),this.Parallelio.Direction=r)}(function(){var t;return(t=class Direction{constructor(t,e,r,i){this.name=t,this.x=e,this.y=r,this.inverseName=i}getInverse(){return this.constructor[this.inverseName]}}).up=new t("up",0,-1,"down"),t.down=new t("down",0,1,"up"),t.left=new t("left",-1,0,"right"),t.right=new t("right",1,0,"left"),t.adjacents=[t.up,t.down,t.left,t.right],t.topLeft=new t("topLeft",-1,-1,"bottomRight"),t.topRight=new t("topRight",1,-1,"bottomLeft"),t.bottomRight=new t("bottomRight",1,1,"topLeft"),t.bottomLeft=new t("bottomLeft",-1,1,"topRight"),t.corners=[t.topLeft,t.topRight,t.bottomRight,t.bottomLeft],t.all=[t.up,t.down,t.left,t.right,t.topLeft,t.topRight,t.bottomRight,t.bottomLeft],t})},{}],78:[function(t,e,r){!function(t){var r=t("undefined"!=typeof Parallelio?Parallelio:this.Parallelio);r.definition=t,null!=e?e.exports=r:"undefined"!=typeof Parallelio&&null!==Parallelio?Parallelio.Tile=r:(null==this.Parallelio&&(this.Parallelio={}),this.Parallelio.Tile=r)}(function(e){null==e&&(e={});var r=e.hasOwnProperty("Element")?e.Element:t("spark-starter").Element,i=e.hasOwnProperty("Direction")?e.Direction:t("./Direction");return function(){class Tile extends r{constructor(t,e){super(),this.x=t,this.y=e,this.init()}init(){return null}getRelativeTile(t,e){if(null!=this.container)return this.container.getTile(this.x+t,this.y+e)}findDirectionOf(t){if(t.tile&&(t=t.tile),null!=t.x&&null!=t.y)return i.all.find(e=>e.x===t.x-this.x&&e.y===t.y-this.y)}addChild(t,e=!0){return-1===this.children.indexOf(t)&&this.children.push(t),e&&(t.tile=this),t}removeChild(t,e=!0){var r;if((r=this.children.indexOf(t))>-1&&this.children.splice(r,1),e&&t.tile===this)return t.tile=null}dist(t){var e,r,i,n;return null!=(null!=t?t.getFinalTile:void 0)&&(t=t.getFinalTile()),null==(null!=t?t.x:void 0)||null==t.y||null==this.x||null==this.y||this.container!==t.container&&!(e=null!=(r=this.container)&&"function"==typeof r.dist?r.dist(t.container):void 0)?null:(i=t.x-this.x,n=t.y-this.y,e&&(i+=e.x,n+=e.y),{x:i,y:n,length:Math.sqrt(i*i+n*n)})}getFinalTile(){return this}}return Tile.properties({children:{collection:!0},container:{change:function(){if(null!=this.container)return this.adjacentTiles.forEach(function(t){return t.invalidateAdjacentTiles()})}},adjacentTiles:{calcul:function(t){if(t.prop("container"))return i.adjacents.map(t=>this.getRelativeTile(t.x,t.y)).filter(t=>null!=t)},collection:!0}}),Tile}.call(this)})},{"./Direction":77,"spark-starter":106}],79:[function(t,e,r){!function(t){var r=t("undefined"!=typeof Parallelio?Parallelio:this.Parallelio);r.definition=t,null!=e?e.exports=r:"undefined"!=typeof Parallelio&&null!==Parallelio?Parallelio.TileContainer=r:(null==this.Parallelio&&(this.Parallelio={}),this.Parallelio.TileContainer=r)}(function(e){null==e&&(e={});var r=e.hasOwnProperty("Element")?e.Element:t("spark-starter").Element,i=e.hasOwnProperty("TileReference")?e.TileReference:t("./TileReference");return function(){class TileContainer extends r{constructor(){super(),this.init()}_addToBondaries(t,e){if((null==e.top||t.y<e.top)&&(e.top=t.y),(null==e.left||t.x<e.left)&&(e.left=t.x),(null==e.bottom||t.y>e.bottom)&&(e.bottom=t.y),null==e.right||t.x>e.right)return e.right=t.x}init(){return this.coords={},this.tiles=[]}addTile(t){var e;return this.tiles.includes(t)||(this.tiles.push(t),null==this.coords[t.x]&&(this.coords[t.x]={}),this.coords[t.x][t.y]=t,this.owner&&(t.container=this),(null!=(e=this._boundaries)?e.calculated:void 0)&&this._addToBondaries(t,this._boundaries.value)),this}removeTile(t){var e,r;if((e=this.tiles.indexOf(t))>-1&&(this.tiles.splice(e,1),delete this.coords[t.x][t.y],this.owner&&(t.container=null),(null!=(r=this._boundaries)?r.calculated:void 0)&&(this.boundaries.top===t.y||this.boundaries.bottom===t.y||this.boundaries.left===t.x||this.boundaries.right===t.x)))return this.invalidateBoundaries()}removeTileAt(t,e){var r;if(r=this.getTile(t,e))return this.removeTile(r)}getTile(t,e){var r;if(null!=(null!=(r=this.coords[t])?r[e]:void 0))return this.coords[t][e]}loadMatrix(t){var e,r,i,n,a;for(a in t)for(n in r=t[a])i=r[n],e={x:parseInt(n),y:parseInt(a)},"function"==typeof i?this.addTile(i(e)):(i.x=e.x,i.y=e.y,this.addTile(i));return this}inRange(t,e){var r,i,n,a,s,o,l,c,p,h;for(c=[],e--,p=i=a=t.x-e,s=t.x+e;a<=s?i<=s:i>=s;p=a<=s?++i:--i)for(h=n=o=t.y-e,l=t.y+e;o<=l?n<=l:n>=l;h=o<=l?++n:--n)Math.sqrt((p-t.x)*(p-t.x)+(h-t.y)*(h-t.y))<=e&&null!=(r=this.getTile(p,h))&&c.push(r);return c}allTiles(){return this.tiles.slice()}clearAll(){var t,e,r;if(this.owner)for(t=0,e=(r=this.tiles).length;t<e;t++)r[t].container=null;return this.coords={},this.tiles=[],this}closest(t,e){var r,n;return n=function(e){return null!=e.score?e.score:e.score=e.getFinalTile().dist(t).length},(r=this.tiles.filter(e).map(t=>new i(t))).sort((t,e)=>n(t)-n(e)),r.length>0?r[0].tile:null}copy(){var t;return(t=new TileContainer).coords=this.coords,t.tiles=this.tiles,t.owner=!1,t}merge(t,e,r=!1){var i,n;return(i=new TileContainer).owner=r,n=t.copy(),this.tiles.forEach(function(t){var r,a;if((a=n.getTile(t.x,t.y))&&n.removeTile(a),r=e(t,a))return i.addTile(r)}),n.tiles.forEach(function(t){var r;if(r=e(null,t))return i.addTile(r)}),i}}return TileContainer.properties({owner:{default:!0},boundaries:{calcul:function(){var t;return t={top:null,left:null,bottom:null,right:null},this.tiles.forEach(e=>this._addToBondaries(e,t)),t},output:function(t){return Object.assign({},t)}}}),TileContainer}.call(this)})},{"./TileReference":80,"spark-starter":106}],80:[function(t,e,r){!function(t){var r=t("undefined"!=typeof Parallelio?Parallelio:this.Parallelio);r.definition=t,null!=e?e.exports=r:"undefined"!=typeof Parallelio&&null!==Parallelio?Parallelio.TileReference=r:(null==this.Parallelio&&(this.Parallelio={}),this.Parallelio.TileReference=r)}(function(){return class TileReference{constructor(t){this.tile=t,Object.defineProperties(this,{x:{get:()=>this.getFinalTile().x},y:{get:()=>this.getFinalTile().y}})}getFinalTile(){return this.tile.getFinalTile()}}})},{}],81:[function(t,e,r){!function(t){var r=t("undefined"!=typeof Parallelio?Parallelio:this.Parallelio);r.definition=t,null!=e?e.exports=r:"undefined"!=typeof Parallelio&&null!==Parallelio?Parallelio.Tiled=r:(null==this.Parallelio&&(this.Parallelio={}),this.Parallelio.Tiled=r)}(function(e){null==e&&(e={});var r=e.hasOwnProperty("Element")?e.Element:t("spark-starter").Element;return function(){class Tiled extends r{putOnRandomTile(t){var e;if(e=this.getRandomValidTile(t))return this.tile=e}getRandomValidTile(t){var e,r,i;for(i=t.slice();i.length>0;)if(r=Math.floor(Math.random()*i.length),e=i.splice(r,1)[0],this.canGoOnTile(e))return e;return null}canGoOnTile(t){return!0}getFinalTile(){return this.tile.getFinalTile()}}return Tiled.properties({tile:{change:function(t){if(null!=t&&t.removeChild(this),this.tile)return this.tile.addChild(this)}},offsetX:{default:0},offsetY:{default:0}}),Tiled}.call(this)})},{"spark-starter":106}],82:[function(t,e,r){e&&(e.exports={Direction:t("./Direction.js"),Tile:t("./Tile.js"),TileContainer:t("./TileContainer.js"),TileReference:t("./TileReference.js"),Tiled:t("./Tiled.js")})},{"./Direction.js":77,"./Tile.js":78,"./TileContainer.js":79,"./TileReference.js":80,"./Tiled.js":81}],83:[function(t,e,r){!function(t){var r=t("undefined"!=typeof Spark?Spark:this.Spark);r.definition=t,null!=e?e.exports=r:"undefined"!=typeof Spark&&null!==Spark?Spark.Binder=r:(null==this.Spark&&(this.Spark={}),this.Spark.Binder=r)}(function(e){null==e&&(e={});var r=e.hasOwnProperty("Referred")?e.Referred:t("./Referred");return class Binder extends r{toggleBind(t=!this.binded){return t?this.bind():this.unbind()}bind(){return!this.binded&&this.canBind()&&this.doBind(),this.binded=!0}canBind(){return null!=this.callback&&null!=this.target}doBind(){throw new Error("Not implemented")}unbind(){return this.binded&&this.canBind()&&this.doUnbind(),this.binded=!1}doUnbind(){throw new Error("Not implemented")}equals(t){return this.compareRefered(t)}destroy(){return this.unbind()}}})},{"./Referred":104}],84:[function(t,e,r){!function(t){var r=t("undefined"!=typeof Spark?Spark:this.Spark);r.definition=t,null!=e?e.exports=r:"undefined"!=typeof Spark&&null!==Spark?Spark.Collection=r:(null==this.Spark&&(this.Spark={}),this.Spark.Collection=r)}(function(){var t;return t=function(){class Collection{constructor(t){null!=t?"function"==typeof t.toArray?this._array=t.toArray():Array.isArray(t)?this._array=t:this._array=[t]:this._array=[]}changed(){}checkChanges(t,e=!0,r=null){return null==r&&(r=function(t,e){return t===e}),t=null!=t?this.copy(t.slice()):[],this.count()!==t.length||(e?this.some(function(e,i){return!r(t.get(i),e)}):this.some(function(e){return!t.pluck(function(t){return r(e,t)})}))}get(t){return this._array[t]}getRandom(){return this._array[Math.floor(Math.random()*this._array.length)]}set(t,e){var r;return this._array[t]!==e&&(r=this.toArray(),this._array[t]=e,this.changed(r)),e}add(t){if(!this._array.includes(t))return this.push(t)}remove(t){var e,r;if(-1!==(e=this._array.indexOf(t)))return r=this.toArray(),this._array.splice(e,1),this.changed(r)}pluck(t){var e,r,i;return(r=this._array.findIndex(t))>-1?(i=this.toArray(),e=this._array[r],this._array.splice(r,1),this.changed(i),e):null}toArray(){return this._array.slice()}count(){return this._array.length}static newSubClass(t,e){var r;return"object"==typeof t?(r=class extends(this){},Object.assign(r.prototype,t),new r(e)):new this(e)}copy(t){return null==t&&(t=this.toArray()),new this.constructor(t)}equals(t){return this.count()===("function"==typeof t.count?t.count():t.length)&&this.every(function(e,r){return t[r]===e})}getAddedFrom(t){return this._array.filter(function(e){return!t.includes(e)})}getRemovedFrom(t){return t.filter(t=>!this.includes(t))}}return Collection.readFunctions=["every","find","findIndex","forEach","includes","indexOf","join","lastIndexOf","map","reduce","reduceRight","some","toString"],Collection.readListFunctions=["concat","filter","slice"],Collection.writefunctions=["pop","push","reverse","shift","sort","splice","unshift"],Collection.readFunctions.forEach(function(t){return Collection.prototype[t]=function(...e){return this._array[t](...e)}}),Collection.readListFunctions.forEach(function(t){return Collection.prototype[t]=function(...e){return this.copy(this._array[t](...e))}}),Collection.writefunctions.forEach(function(t){return Collection.prototype[t]=function(...e){var r,i;return r=this.toArray(),i=this._array[t](...e),this.changed(r),i}}),Collection}.call(this),Object.defineProperty(t.prototype,"length",{get:function(){return this.count()}}),("undefined"!=typeof Symbol&&null!==Symbol?Symbol.iterator:void 0)&&(t.prototype[Symbol.iterator]=function(){return this._array[Symbol.iterator]()}),t})},{}],85:[function(t,e,r){!function(t){var r=t("undefined"!=typeof Spark?Spark:this.Spark);r.definition=t,null!=e?e.exports=r:"undefined"!=typeof Spark&&null!==Spark?Spark.Element=r:(null==this.Spark&&(this.Spark={}),this.Spark.Element=r)}(function(e){null==e&&(e={});var r=e.hasOwnProperty("Property")?e.Property:t("./Property"),i=e.hasOwnProperty("Mixable")?e.Mixable:t("./Mixable");return class Element extends i{constructor(){super(),this.init()}init(){}tap(t){var e;return e=Array.prototype.slice.call(arguments),"function"==typeof t?t.apply(this,e.slice(1)):this[t].apply(this,e.slice(1)),this}callback(t){return null==this._callbacks&&(this._callbacks={}),null==this._callbacks[t]&&(this._callbacks[t]=((...e)=>(this[t].apply(this,e),null)),this._callbacks[t].owner=this),this._callbacks[t]}getFinalProperties(){return null!=this._properties?["_properties"].concat(this._properties.map(function(t){return t.name})):[]}extended(t){var e,i,n,a,s,o;if(null!=this._properties){for(o=[],e=0,i=(s=this._properties).length;e<i;e++)a=s[e],n=Object.assign({},a.options),o.push(new r(a.name,n).bind(t));return o}}static property(t,e){return new r(t,e).bind(this.prototype)}static properties(t){var e,r,i;for(r in i=[],t)e=t[r],i.push(this.property(r,e));return i}}})},{"./Mixable":94,"./Property":96}],86:[function(t,e,r){!function(t){var r=t("undefined"!=typeof Spark?Spark:this.Spark);r.definition=t,null!=e?e.exports=r:"undefined"!=typeof Spark&&null!==Spark?Spark.EventBind=r:(null==this.Spark&&(this.Spark={}),this.Spark.EventBind=r)}(function(e){null==e&&(e={});var r=e.hasOwnProperty("Binder")?e.Binder:t("./Binder");return class EventBind extends r{constructor(t,e,r){super(),this.event=t,this.target=e,this.callback=r}getRef(){return{event:this.event,target:this.target,callback:this.callback}}bindTo(t){return this.unbind(),this.target=t,this.bind()}doBind(){if("function"==typeof this.target.addEventListener)return this.target.addEventListener(this.event,this.callback);if("function"==typeof this.target.addListener)return this.target.addListener(this.event,this.callback);if("function"==typeof this.target.on)return this.target.on(this.event,this.callback);throw new Error("No function to add event listeners was found")}doUnbind(){if("function"==typeof this.target.removeEventListener)return this.target.removeEventListener(this.event,this.callback);if("function"==typeof this.target.removeListener)return this.target.removeListener(this.event,this.callback);if("function"==typeof this.target.off)return this.target.off(this.event,this.callback);throw new Error("No function to remove event listeners was found")}equals(t){return super.equals(t)&&t.event===this.event}match(t,e){return t===this.event&&e===this.target}static checkEmitter(t,e=!0){if("function"==typeof t.addEventListener||"function"==typeof t.addListener||"function"==typeof t.on)return!0;if(e)throw new Error("No function to add event listeners was found");return!1}}})},{"./Binder":83}],87:[function(t,e,r){!function(t){var r=t("undefined"!=typeof Spark?Spark:this.Spark);r.definition=t,null!=e?e.exports=r:"undefined"!=typeof Spark&&null!==Spark?Spark.EventEmitter=r:(null==this.Spark&&(this.Spark={}),this.Spark.EventEmitter=r)}(function(){return function(){class EventEmitter{getAllEvents(){return this._events||(this._events={})}getListeners(t){var e;return(e=this.getAllEvents())[t]||(e[t]=[])}hasListener(t,e){return this.getListeners(t).includes(e)}addListener(t,e){if(!this.hasListener(t,e))return this.getListeners(t).push(e),this.listenerAdded(t,e)}listenerAdded(t,e){}removeListener(t,e){var r,i;if(-1!==(r=(i=this.getListeners(t)).indexOf(e)))return i.splice(r,1),this.listenerRemoved(t,e)}listenerRemoved(t,e){}emitEvent(t,...e){return this.getListeners(t).slice().forEach(function(t){return t(...e)})}removeAllListeners(){return this._events={}}}return EventEmitter.prototype.emit=EventEmitter.prototype.emitEvent,EventEmitter.prototype.trigger=EventEmitter.prototype.emitEvent,EventEmitter.prototype.on=EventEmitter.prototype.addListener,EventEmitter.prototype.off=EventEmitter.prototype.removeListener,EventEmitter}.call(this)})},{}],88:[function(t,e,r){!function(t){var r=t("undefined"!=typeof Spark?Spark:this.Spark);r.definition=t,null!=e?e.exports=r:"undefined"!=typeof Spark&&null!==Spark?Spark.ActivablePropertyWatcher=r:(null==this.Spark&&(this.Spark={}),this.Spark.ActivablePropertyWatcher=r)}(function(e){null==e&&(e={});var r=e.hasOwnProperty("PropertyWatcher")?e.PropertyWatcher:t("./PropertyWatcher"),i=e.hasOwnProperty("Invalidator")?e.Invalidator:t("../Invalidator");return class ActivablePropertyWatcher extends r{loadOptions(t){return super.loadOptions(t),this.active=t.active}shouldBind(){var t;return null==this.active||(null==this.invalidator&&(this.invalidator=new i(this,this.scope),this.invalidator.callback=(()=>this.checkBind())),this.invalidator.recycle(),t=this.active(this.invalidator),this.invalidator.endRecycle(),this.invalidator.bind(),t)}}})},{"../Invalidator":92,"./PropertyWatcher":91}],89:[function(t,e,r){!function(t){var r=t("undefined"!=typeof Spark?Spark:this.Spark);r.definition=t,null!=e?e.exports=r:"undefined"!=typeof Spark&&null!==Spark?Spark.CollectionPropertyWatcher=r:(null==this.Spark&&(this.Spark={}),this.Spark.CollectionPropertyWatcher=r)}(function(e){null==e&&(e={});var r=e.hasOwnProperty("PropertyWatcher")?e.PropertyWatcher:t("./PropertyWatcher");return class CollectionPropertyWatcher extends r{loadOptions(t){return super.loadOptions(t),this.onAdded=t.onAdded,this.onRemoved=t.onRemoved}handleChange(t,e){if(e=t.copy(e||[]),"function"==typeof this.callback&&this.callback.call(this.scope,e),"function"==typeof this.onAdded&&t.forEach((t,r)=>{if(!e.includes(t))return this.onAdded.call(this.scope,t)}),"function"==typeof this.onRemoved)return e.forEach((e,r)=>{if(!t.includes(e))return this.onRemoved.call(this.scope,e)})}}})},{"./PropertyWatcher":91}],90:[function(t,e,r){!function(t){var r=t("undefined"!=typeof Spark?Spark:this.Spark);r.definition=t,null!=e?e.exports=r:"undefined"!=typeof Spark&&null!==Spark?Spark.Invalidated=r:(null==this.Spark&&(this.Spark={}),this.Spark.Invalidated=r)}(function(e){null==e&&(e={});var r=e.hasOwnProperty("Invalidator")?e.Invalidator:t("../Invalidator");return class Invalidated{constructor(t){null!=t&&this.loadOptions(t),null!=t&&t.initByLoader&&null!=t.loader||this.init()}loadOptions(t){return this.scope=t.scope,t.loaderAsScope&&null!=t.loader&&(this.scope=t.loader),this.callback=t.callback}init(){return this.update()}unknown(){return this.invalidator.validateUnknowns()}invalidate(){return this.update()}update(){return null==this.invalidator&&(this.invalidator=new r(this,this.scope)),this.invalidator.recycle(),this.handleUpdate(this.invalidator),this.invalidator.endRecycle(),this.invalidator.bind(),this}handleUpdate(t){return null!=this.scope?this.callback.call(this.scope,t):this.callback(t)}destroy(){if(this.invalidator)return this.invalidator.unbind()}}})},{"../Invalidator":92}],91:[function(t,e,r){!function(t){var r=t("undefined"!=typeof Spark?Spark:this.Spark);r.definition=t,null!=e?e.exports=r:"undefined"!=typeof Spark&&null!==Spark?Spark.PropertyWatcher=r:(null==this.Spark&&(this.Spark={}),this.Spark.PropertyWatcher=r)}(function(e){null==e&&(e={});var r=e.hasOwnProperty("Binder")?e.Binder:t("../Binder");return class PropertyWatcher extends r{constructor(t){var e;super(),this.options=t,this.invalidateCallback=(()=>this.invalidate()),this.updateCallback=(t=>this.update(t)),null!=this.options&&this.loadOptions(this.options),null!=(e=this.options)&&e.initByLoader&&null!=this.options.loader||this.init()}loadOptions(t){return this.scope=t.scope,t.loaderAsScope&&null!=t.loader&&(this.scope=t.loader),this.property=t.property,this.callback=t.callback,this.autoBind=t.autoBind}copyWith(t){return new this.__proto__.constructor(Object.assign({},this.options,t))}init(){if(this.autoBind)return this.checkBind()}getProperty(){return"string"==typeof this.property&&(this.property=this.scope.getPropertyInstance(this.property)),this.property}checkBind(){return this.toggleBind(this.shouldBind())}shouldBind(){return!0}canBind(){return null!=this.getProperty()}doBind(){return this.update(),this.getProperty().on("invalidated",this.invalidateCallback),this.getProperty().on("updated",this.updateCallback)}doUnbind(){return this.getProperty().off("invalidated",this.invalidateCallback),this.getProperty().off("updated",this.updateCallback)}getRef(){return"string"==typeof this.property?{property:this.property,target:this.scope,callback:this.callback}:{property:this.property.property.name,target:this.property.obj,callback:this.callback}}invalidate(){return this.getProperty().get()}update(t){var e;return e=this.getProperty().get(),this.handleChange(e,t)}handleChange(t,e){return this.callback.call(this.scope,e)}}})},{"../Binder":83}],92:[function(t,e,r){!function(t){var r=t("undefined"!=typeof Spark?Spark:this.Spark);r.definition=t,null!=e?e.exports=r:"undefined"!=typeof Spark&&null!==Spark?Spark.Invalidator=r:(null==this.Spark&&(this.Spark={}),this.Spark.Invalidator=r)}(function(e){null==e&&(e={});var r,i=e.hasOwnProperty("Binder")?e.Binder:t("./Binder"),n=e.hasOwnProperty("EventBind")?e.EventBind:t("./EventBind");return r=function(t,e){var r,i;return(i=t.findIndex(e))>-1?(r=t[i],t.splice(i,1),r):null},function(){class Invalidator extends i{constructor(t,e=null){super(),this.invalidated=t,this.scope=e,this.invalidationEvents=[],this.recycled=[],this.unknowns=[],this.strict=this.constructor.strict,this.invalid=!1,this.invalidateCallback=(()=>(this.invalidate(),null)),this.invalidateCallback.owner=this}invalidate(){var t;return this.invalid=!0,"function"==typeof this.invalidated?this.invalidated():"function"==typeof this.callback?this.callback():null!=this.invalidated&&"function"==typeof this.invalidated.invalidate?this.invalidated.invalidate():"string"==typeof this.invalidated?(t="invalidate"+this.invalidated.charAt(0).toUpperCase()+this.invalidated.slice(1),"function"==typeof this.scope[t]?this.scope[t]():this.scope[this.invalidated]=null):void 0}unknown(){var t;return"function"==typeof(null!=(t=this.invalidated)?t.unknown:void 0)?this.invalidated.unknown():this.invalidate()}addEventBind(t,e,r){return this.addBinder(new n(t,e,r))}addBinder(t){if(null==t.callback&&(t.callback=this.invalidateCallback),!this.invalidationEvents.some(function(e){return e.equals(t)}))return this.invalidationEvents.push(r(this.recycled,function(e){return e.equals(t)})||t)}getUnknownCallback(t){var e;return(e=(()=>this.addUnknown(function(){return t.get()},t))).ref={prop:t},e}addUnknown(t,e){if(!this.findUnknown(e))return t.ref={prop:e},this.unknowns.push(t),this.unknown()}findUnknown(t){if(null!=t||"undefined"!=typeof target&&null!==target)return this.unknowns.find(function(e){return e.ref.prop===t})}event(t,e=this.scope){if(this.checkEmitter(e))return this.addEventBind(t,e)}value(t,e,r=this.scope){return this.event(e,r),t}prop(t,e=this.scope){var r;if("string"==typeof t){if(null==e.getPropertyInstance||!(r=e.getPropertyInstance(t)))return e[t];t=r}else if(!this.checkPropInstance(t))throw new Error("Property must be a PropertyInstance or a string");return this.addEventBind("invalidated",t,this.getUnknownCallback(t)),this.value(t.get(),"updated",t)}propPath(t,e=this.scope){var r,i;for(t=t.split("."),i=e;null!=i&&t.length>0;)r=t.shift(),i=this.prop(r,i);return i}propInitiated(t,e=this.scope){var r;if("string"==typeof t&&null!=e.getPropertyInstance)t=e.getPropertyInstance(t);else if(!this.checkPropInstance(t))throw new Error("Property must be a PropertyInstance or a string");return(r=t.initiated)||this.event("updated",t),r}funct(t){var e,r;return e=new Invalidator(()=>this.addUnknown(()=>{var i;if(i=t(e),r!==i)return this.invalidate()},e)),r=t(e),this.invalidationEvents.push(e),r}validateUnknowns(){var t;return t=this.unknowns,this.unknowns=[],t.forEach(function(t){return t()})}isEmpty(){return 0===this.invalidationEvents.length}bind(){return this.invalid=!1,this.invalidationEvents.forEach(function(t){return t.bind()})}recycle(t){var e,r;return this.recycled=this.invalidationEvents,this.invalidationEvents=[],e=this.endRecycle.bind(this),"function"==typeof t?t.length>1?t(this,e):(r=t(this),e(),r):e}endRecycle(){return this.recycled.forEach(function(t){return t.unbind()}),this.recycled=[]}checkEmitter(t){return n.checkEmitter(t,this.strict)}checkPropInstance(t){return"function"==typeof t.get&&this.checkEmitter(t)}unbind(){return this.invalidationEvents.forEach(function(t){return t.unbind()})}}return Invalidator.strict=!0,Invalidator}.call(this)})},{"./Binder":83,"./EventBind":86}],93:[function(t,e,r){!function(t){var r=t("undefined"!=typeof Spark?Spark:this.Spark);r.definition=t,null!=e?e.exports=r:"undefined"!=typeof Spark&&null!==Spark?Spark.Loader=r:(null==this.Spark&&(this.Spark={}),this.Spark.Loader=r)}(function(e){null==e&&(e={});var r=e.hasOwnProperty("Overrider")?e.Overrider:t("./Overrider");return function(){class Loader extends r{constructor(){super(),this.initPreloaded()}initPreloaded(){var t;return t=this.preloaded,this.preloaded=[],this.load(t)}load(t){var e,r;return r=[],e=t.map(t=>{var e;return null==t.instance&&(t=Object.assign({loader:this},t),e=Loader.load(t),(t=Object.assign({instance:e},t)).initByLoader&&null!=e.init&&r.push(e)),t}),this.preloaded=this.preloaded.concat(e),r.forEach(function(t){return t.init()})}preload(t){return Array.isArray(t)||(t=[t]),this.preloaded=(this.preloaded||[]).concat(t)}destroyLoaded(){return this.preloaded.forEach(function(t){var e;return null!=(e=t.instance)&&"function"==typeof e.destroy?e.destroy():void 0})}getFinalProperties(){return super.getFinalProperties().concat(["preloaded"])}extended(t){if(super.extended(t),this.preloaded)return t.preloaded=(t.preloaded||[]).concat(this.preloaded)}static loadMany(t){return t.map(t=>this.load(t))}static load(t){return"function"==typeof t.type.copyWith?t.type.copyWith(t):new t.type(t)}static preload(t){return this.prototype.preload(t)}}return Loader.prototype.preloaded=[],Loader.overrides({init:function(){return this.init.withoutLoader(),this.initPreloaded()},destroy:function(){return this.destroy.withoutLoader(),this.destroyLoaded()}}),Loader}.call(this)})},{"./Overrider":95}],94:[function(t,e,r){!function(t){var r=t("undefined"!=typeof Spark?Spark:this.Spark);r.definition=t,null!=e?e.exports=r:"undefined"!=typeof Spark&&null!==Spark?Spark.Mixable=r:(null==this.Spark&&(this.Spark={}),this.Spark.Mixable=r)}(function(){var t=[].indexOf;return function(){class Mixable{static extend(t){if(this.Extension.make(t,this),null!=t.prototype)return this.Extension.make(t.prototype,this.prototype)}static include(t){return this.Extension.make(t,this.prototype)}}return Mixable.Extension={makeOnce:function(t,e){var r;if(!(null!=(r=e.extensions)?r.includes(t):void 0))return this.make(t,e)},make:function(t,e){var r,i,n,a,s;for(r=0,i=(s=this.getExtensionProperties(t,e)).length;r<i;r++)a=s[r],Object.defineProperty(e,a.name,a);if(t.getFinalProperties&&e.getFinalProperties?(n=e.getFinalProperties,e.getFinalProperties=function(){return t.getFinalProperties().concat(n.call(this))}):e.getFinalProperties=t.getFinalProperties||e.getFinalProperties,e.extensions=(e.extensions||[]).concat([t]),"function"==typeof t.extended)return t.extended(e)},alwaysFinal:["extended","extensions","__super__","constructor","getFinalProperties"],getExtensionProperties:function(e,r){var i,n,a;return i=this.alwaysFinal,a=this.getPrototypeChain(r),n=[],this.getPrototypeChain(e).every(function(s){var o;if(!a.includes(s))return o=i,null!=e.getFinalProperties&&(o=o.concat(e.getFinalProperties())),"function"==typeof s&&(o=o.concat(["length","prototype","name"])),n=n.concat(Object.getOwnPropertyNames(s).filter(e=>!r.hasOwnProperty(e)&&"__"!==e.substr(0,2)&&t.call(o,e)<0&&!n.find(function(t){return t.name===e})).map(function(t){var e;return(e=Object.getOwnPropertyDescriptor(s,t)).name=t,e})),!0}),n},getPrototypeChain:function(t){var e,r;for(r=[],e=Object.getPrototypeOf(Object);r.push(t),(t=Object.getPrototypeOf(t))&&t!==Object&&t!==e;);return r}},Mixable}.call(this)})},{}],95:[function(t,e,r){!function(t){var r=t("undefined"!=typeof Spark?Spark:this.Spark);r.definition=t,null!=e?e.exports=r:"undefined"!=typeof Spark&&null!==Spark?Spark.Overrider=r:(null==this.Spark&&(this.Spark={}),this.Spark.Overrider=r)}(function(){return function(){class Overrider{static overrides(t){return this.Override.applyMany(this.prototype,this.name,t)}getFinalProperties(){return null!=this._overrides?["_overrides"].concat(Object.keys(this._overrides)):[]}extended(t){if(null!=this._overrides&&this.constructor.Override.applyMany(t,this.constructor.name,this._overrides),this.constructor===Overrider)return t.extended=this.extended}}return Overrider.Override={makeMany:function(t,e,r){var i,n,a;for(n in a=[],r)i=r[n],a.push(this.make(t,e,n,i));return a},applyMany:function(t,e,r){var i,n,a;for(i in a=[],r)"function"==typeof(n=r[i])&&(n=this.make(t,e,i,n)),a.push(this.apply(t,e,n));return a},make:function(t,e,r,i){var n;return(n={fn:{current:i},name:r}).fn["with"+e]=i,n},emptyFn:function(){},apply:function(t,e,r){var i,n,a,s,o;return i=r.name,n=null!=t._overrides?Object.assign({},t._overrides):{},o=(null!=(a=t._overrides)&&null!=(s=a[i])?s.fn.current:void 0)||t[i],r=Object.assign({},r),null!=n[i]?r.fn=Object.assign({},n[i].fn,r.fn):r.fn=Object.assign({},r.fn),r.fn["without"+e]=o||this.emptyFn,null==o?r.missingWithout="without"+e:r.missingWithout&&(r.fn[r.missingWithout]=o),Object.defineProperty(t,i,{configurable:!0,get:function(){var t,e,n,a;for(n in t=r.fn.current.bind(this),a=r.fn)e=a[n],t[n]=e.bind(this);return this.constructor.prototype!==this&&Object.defineProperty(this,i,{value:t}),t}}),n[i]=r,t._overrides=n}},Overrider}.call(this)})},{}],96:[function(t,e,r){!function(t){var r=t("undefined"!=typeof Spark?Spark:this.Spark);r.definition=t,null!=e?e.exports=r:"undefined"!=typeof Spark&&null!==Spark?Spark.Property=r:(null==this.Spark&&(this.Spark={}),this.Spark.Property=r)}(function(e){null==e&&(e={});var r=e.hasOwnProperty("BasicProperty")?e.BasicProperty:t("./PropertyTypes/BasicProperty"),i=e.hasOwnProperty("CollectionProperty")?e.CollectionProperty:t("./PropertyTypes/CollectionProperty"),n=e.hasOwnProperty("ComposedProperty")?e.ComposedProperty:t("./PropertyTypes/ComposedProperty"),a=e.hasOwnProperty("DynamicProperty")?e.DynamicProperty:t("./PropertyTypes/DynamicProperty"),s=e.hasOwnProperty("CalculatedProperty")?e.CalculatedProperty:t("./PropertyTypes/CalculatedProperty"),o=e.hasOwnProperty("InvalidatedProperty")?e.InvalidatedProperty:t("./PropertyTypes/InvalidatedProperty"),l=e.hasOwnProperty("PropertyOwner")?e.PropertyOwner:t("./PropertyOwner"),c=e.hasOwnProperty("Mixable")?e.Mixable:t("./Mixable");return function(){class Property{constructor(t,e={}){this.name=t,this.options=e}bind(t){var e;return this,"function"==typeof t.getProperty&&t.getProperty(this.name)===this||("function"==typeof t.getProperty&&null!=(e=t.getProperty(this.name))&&this.override(e),this.getInstanceType().bind(t,this),t._properties=(t._properties||[]).concat([this]),null!=e&&(t._properties=t._properties.filter(function(t){return t!==e})),this.makeOwner(t)),this}override(t){var e,r,i,n;if(null==this.options.parent){for(e in this.options.parent=t.options,i=[],r=t.options)n=r[e],"function"==typeof this.options[e]&&"function"==typeof n?i.push(this.options[e].overrided=n):void 0===this.options[e]?i.push(this.options[e]=n):i.push(void 0);return i}}makeOwner(t){var e;if(!(null!=(e=t.extensions)?e.includes(l.prototype):void 0))return c.Extension.make(l.prototype,t)}getInstanceVarName(){return this.options.instanceVarName||"_"+this.name}isInstantiated(t){return null!=t[this.getInstanceVarName()]}getInstance(t){var e,r;return r=this.getInstanceVarName(),this.isInstantiated(t)||(e=this.getInstanceType(),t[r]=new e(this,t),t[r].init()),t[r]}getInstanceType(){return this.instanceType||this.composers.forEach(t=>t.compose(this)),this.instanceType}}return Property.prototype.composers=[n,i,a,r,s,o],Property}.call(this)})},{"./Mixable":94,"./PropertyOwner":97,"./PropertyTypes/BasicProperty":98,"./PropertyTypes/CalculatedProperty":99,"./PropertyTypes/CollectionProperty":100,"./PropertyTypes/ComposedProperty":101,"./PropertyTypes/DynamicProperty":102,"./PropertyTypes/InvalidatedProperty":103}],97:[function(t,e,r){!function(t){var r=t("undefined"!=typeof Spark?Spark:this.Spark);r.definition=t,null!=e?e.exports=r:"undefined"!=typeof Spark&&null!==Spark?Spark.PropertyOwner=r:(null==this.Spark&&(this.Spark={}),this.Spark.PropertyOwner=r)}(function(){return class PropertyOwner{getProperty(t){return this._properties&&this._properties.find(function(e){return e.name===t})}getPropertyInstance(t){var e;if(e=this.getProperty(t))return e.getInstance(this)}getProperties(){return this._properties.slice()}getPropertyInstances(){return this._properties.map(t=>t.getInstance(this))}getInstantiatedProperties(){return this._properties.filter(t=>t.isInstantiated(this)).map(t=>t.getInstance(this))}getManualDataProperties(){return this._properties.reduce((t,e)=>{var r;return e.isInstantiated(this)&&(r=e.getInstance(this)).calculated&&r.manual&&(t[e.name]=r.value),t},{})}setProperties(t,e={}){var r,i,n;for(r in t)n=t[r],null!=e.whitelist&&-1===e.whitelist.indexOf(r)||null!=e.blacklist&&-1!==e.blacklist.indexOf(r)||null!=(i=this.getPropertyInstance(r))&&i.set(n);return this}destroyProperties(){return this.getInstantiatedProperties().forEach(t=>t.destroy()),this._properties=[],!0}listenerAdded(t,e){return this._properties.forEach(e=>{if(e.getInstanceType().prototype.changeEventName===t)return e.getInstance(this).get()})}extended(t){return t.listenerAdded=this.listenerAdded}}})},{}],98:[function(t,e,r){!function(t){var r=t("undefined"!=typeof Spark?Spark:this.Spark);r.definition=t,null!=e?e.exports=r:"undefined"!=typeof Spark&&null!==Spark?Spark.BasicProperty=r:(null==this.Spark&&(this.Spark={}),this.Spark.BasicProperty=r)}(function(e){null==e&&(e={});var r=e.hasOwnProperty("Mixable")?e.Mixable:t("../Mixable"),i=e.hasOwnProperty("EventEmitter")?e.EventEmitter:t("../EventEmitter"),n=e.hasOwnProperty("Loader")?e.Loader:t("../Loader"),a=e.hasOwnProperty("PropertyWatcher")?e.PropertyWatcher:t("../Invalidated/PropertyWatcher"),s=e.hasOwnProperty("Referred")?e.Referred:t("../Referred");return function(){class BasicProperty extends r{constructor(t,e){super(),this.property=t,this.obj=e}init(){var t;if(this.value=this.ingest(this.default),this.calculated=!1,this.initiated=!1,(t=this.constructor.getPreload(this.obj,this.property,this)).length>0)return n.loadMany(t)}get(){return this.calculated=!0,this.initiated||(this.initiated=!0,this.emitEvent("updated")),this.output()}set(t){return this.setAndCheckChanges(t)}callbackSet(t){return this.callOptionFunct("set",t),this}setAndCheckChanges(t){var e;return t=this.ingest(t),this.revalidated(),this.checkChanges(t,this.value)&&(e=this.value,this.value=t,this.manual=!0,this.changed(e)),this}checkChanges(t,e){return t!==e}destroy(){var t;return!0===this.property.options.destroy&&null!=(null!=(t=this.value)?t.destroy:void 0)&&this.value.destroy(),"function"==typeof this.property.options.destroy&&this.callOptionFunct("destroy",this.value),this.value=null}callOptionFunct(t,...e){return"string"==typeof t&&(t=this.property.options[t]),"function"==typeof t.overrided&&e.push((...e)=>this.callOptionFunct(t.overrided,...e)),t.apply(this.obj,e)}revalidated(){return this.calculated=!0,this.initiated=!0}ingest(t){return"function"==typeof this.property.options.ingest?this.callOptionFunct("ingest",t):t}output(){return"function"==typeof this.property.options.output?this.callOptionFunct("output",this.value):this.value}changed(t){return this.emitEvent("updated",t),this.emitEvent("changed",t),this}static compose(t){return null==t.instanceType&&(t.instanceType=class extends BasicProperty{}),"function"==typeof t.options.set?t.instanceType.prototype.set=this.prototype.callbackSet:t.instanceType.prototype.set=this.prototype.setAndCheckChanges,t.instanceType.prototype.default=t.options.default}static bind(t,e){var i,a,s;if(i=e.name.charAt(0).toUpperCase()+e.name.slice(1),a={configurable:!0,get:function(){return e.getInstance(this).get()}},!1!==e.options.set&&(a.set=function(t){return e.getInstance(this).set(t)}),Object.defineProperty(t,e.name,a),t["get"+i]=function(){return e.getInstance(this).get()},!1!==e.options.set&&(t["set"+i]=function(t){return e.getInstance(this).set(t),this}),t["invalidate"+i]=function(){return e.getInstance(this).invalidate(),this},(s=this.getPreload(t,e)).length>0)return r.Extension.makeOnce(n.prototype,t),t.preload(s)}static getPreload(t,e,r){var i,n,o,l;return i=[],"function"==typeof e.options.change&&(l={type:a,loaderAsScope:!0,property:r||e.name,initByLoader:!0,autoBind:!0,callback:e.options.change,ref:{prop:e.name,callback:e.options.change,context:"change"}}),"function"==typeof(null!=(n=e.options.change)?n.copyWith:void 0)&&(l={type:e.options.change,loaderAsScope:!0,property:r||e.name,initByLoader:!0,autoBind:!0,ref:{prop:e.name,type:e.options.change,context:"change"}}),null==l||(null!=(o=t.preloaded)?o.find(function(t){return s.compareRef(l.ref,t.ref)&&!r||null!=t.instance}):void 0)||i.push(l),i}}return BasicProperty.extend(i),BasicProperty}.call(this)})},{"../EventEmitter":87,"../Invalidated/PropertyWatcher":91,"../Loader":93,"../Mixable":94,"../Referred":104}],99:[function(t,e,r){!function(t){var r=t("undefined"!=typeof Spark?Spark:this.Spark);r.definition=t,null!=e?e.exports=r:"undefined"!=typeof Spark&&null!==Spark?Spark.CalculatedProperty=r:(null==this.Spark&&(this.Spark={}),this.Spark.CalculatedProperty=r)}(function(e){null==e&&(e={});e.hasOwnProperty("Invalidator")?e.Invalidator:t("../Invalidator");var r=e.hasOwnProperty("DynamicProperty")?e.DynamicProperty:t("./DynamicProperty"),i=e.hasOwnProperty("Overrider")?e.Overrider:t("../Overrider");return function(){class CalculatedProperty extends r{calcul(){return this.value=this.callOptionFunct(this.calculFunct),this.manual=!1,this.revalidated(),this.value}static compose(t){if("function"==typeof t.options.calcul&&(t.instanceType.prototype.calculFunct=t.options.calcul,!(t.options.calcul.length>0)))return t.instanceType.extend(CalculatedProperty)}}return CalculatedProperty.extend(i),CalculatedProperty.overrides({get:function(){var t,e;return this.invalidator&&this.invalidator.validateUnknowns(),this.calculated||(e=this.value,t=this.initiated,this.calcul(),this.checkChanges(this.value,e)?t?this.changed(e):this.emitEvent("updated",e):t||this.emitEvent("updated",e)),this.output()}}),CalculatedProperty}.call(this)})},{"../Invalidator":92,"../Overrider":95,"./DynamicProperty":102}],100:[function(t,e,r){!function(t){var r=t("undefined"!=typeof Spark?Spark:this.Spark);r.definition=t,null!=e?e.exports=r:"undefined"!=typeof Spark&&null!==Spark?Spark.CollectionProperty=r:(null==this.Spark&&(this.Spark={}),this.Spark.CollectionProperty=r)}(function(e){null==e&&(e={});var r=e.hasOwnProperty("DynamicProperty")?e.DynamicProperty:t("./DynamicProperty"),i=e.hasOwnProperty("Collection")?e.Collection:t("../Collection"),n=e.hasOwnProperty("Referred")?e.Referred:t("../Referred"),a=e.hasOwnProperty("CollectionPropertyWatcher")?e.CollectionPropertyWatcher:t("../Invalidated/CollectionPropertyWatcher");return function(){class CollectionProperty extends r{ingest(t){return"function"==typeof this.property.options.ingest&&(t=this.callOptionFunct("ingest",t)),null==t?[]:"function"==typeof t.toArray?t.toArray():Array.isArray(t)?t.slice():[t]}checkChangedItems(t,e){var r;return"function"==typeof this.collectionOptions.compare&&(r=this.collectionOptions.compare),new i(t).checkChanges(e,this.collectionOptions.ordered,r)}output(){var t,e,r;return r=this.value,"function"==typeof this.property.options.output&&(r=this.callOptionFunct("output",this.value)),e=this,(t=i.newSubClass(this.collectionOptions,r)).changed=function(t){return e.changed(t)},t}static compose(t){if(null!=t.options.collection&&(t.instanceType=class extends CollectionProperty{},t.instanceType.prototype.collectionOptions=Object.assign({},this.defaultCollectionOptions,"object"==typeof t.options.collection?t.options.collection:{}),null!=t.options.collection.compare))return t.instanceType.prototype.checkChanges=this.prototype.checkChangedItems}static getPreload(t,e,r){var i,s,o;return i=[],"function"!=typeof e.options.change&&"function"!=typeof e.options.itemAdded&&"function"!=typeof e.options.itemRemoved||(s={prop:e.name,context:"change"},(null!=(o=t.preloaded)?o.find(function(t){return n.compareRef(s,t.ref)&&null!=t.instance}):void 0)||i.push({type:a,loaderAsScope:!0,scope:t,property:r||e.name,initByLoader:!0,autoBind:!0,callback:e.options.change,onAdded:e.options.itemAdded,onRemoved:e.options.itemRemoved,ref:s})),i}}return CollectionProperty.defaultCollectionOptions={compare:!1,ordered:!0},CollectionProperty}.call(this)})},{"../Collection":84,"../Invalidated/CollectionPropertyWatcher":89,"../Referred":104,"./DynamicProperty":102}],101:[function(t,e,r){!function(t){var r=t("undefined"!=typeof Spark?Spark:this.Spark);r.definition=t,null!=e?e.exports=r:"undefined"!=typeof Spark&&null!==Spark?Spark.ComposedProperty=r:(null==this.Spark&&(this.Spark={}),this.Spark.ComposedProperty=r)}(function(e){null==e&&(e={});var r,i=e.hasOwnProperty("CalculatedProperty")?e.CalculatedProperty:t("./CalculatedProperty"),n=e.hasOwnProperty("Invalidator")?e.Invalidator:t("../Invalidator"),a=e.hasOwnProperty("Collection")?e.Collection:t("../Collection");return(r=function(){class ComposedProperty extends i{init(){return this.initComposed(),super.init()}initComposed(){return this.property.options.hasOwnProperty("default")?this.default=this.property.options.default:this.default=this.value=!0,this.members=new ComposedProperty.Members(this.property.options.members),this.members.changed=(t=>this.invalidate()),this.join="function"==typeof this.property.options.composed?this.property.options.composed:!1===this.property.options.default?ComposedProperty.joinFunctions.or:ComposedProperty.joinFunctions.and}calcul(){return this.invalidator||(this.invalidator=new n(this,this.obj)),this.invalidator.recycle((t,e)=>(this.value=this.members.reduce((t,e)=>{var r;return r="function"==typeof e?e(this.invalidator):e,this.join(t,r)},this.default),e(),t.isEmpty()?this.invalidator=null:t.bind())),this.revalidated(),this.value}static compose(t){if(null!=t.options.composed)return t.instanceType=class extends ComposedProperty{}}static bind(t,e){return i.bind(t,e),Object.defineProperty(t,e.name+"Members",{configurable:!0,get:function(){return e.getInstance(this).members}})}}return ComposedProperty.joinFunctions={and:function(t,e){return t&&e},or:function(t,e){return t||e}},ComposedProperty}.call(this)).Members=class Members extends a{addPropertyRef(t,e){var r;if(-1===this.findRefIndex(t,e))return(r=function(r){return r.prop(t,e)}).ref={name:t,obj:e},this.push(r)}addValueRef(t,e,r){var i;if(-1===this.findRefIndex(e,r))return(i=function(e){return t}).ref={name:e,obj:r,val:t},this.push(i)}setValueRef(t,e,r){var i,n;return-1===(n=this.findRefIndex(e,r))?this.addValueRef(t,e,r):this.get(n).ref.val!==t?((i=function(e){return t}).ref={name:e,obj:r,val:t},this.set(n,i)):void 0}getValueRef(t,e){return this.findByRef(t,e).ref.val}addFunctionRef(t,e,r){if(-1===this.findRefIndex(e,r))return t.ref={name:e,obj:r},this.push(t)}findByRef(t,e){return this._array[this.findRefIndex(t,e)]}findRefIndex(t,e){return this._array.findIndex(function(r){return null!=r.ref&&r.ref.obj===e&&r.ref.name===t})}removeRef(t,e){var r,i;if(-1!==(r=this.findRefIndex(t,e)))return i=this.toArray(),this._array.splice(r,1),this.changed(i)}},r})},{"../Collection":84,"../Invalidator":92,"./CalculatedProperty":99}],102:[function(t,e,r){!function(t){var r=t("undefined"!=typeof Spark?Spark:this.Spark);r.definition=t,null!=e?e.exports=r:"undefined"!=typeof Spark&&null!==Spark?Spark.DynamicProperty=r:(null==this.Spark&&(this.Spark={}),this.Spark.DynamicProperty=r)}(function(e){null==e&&(e={});e.hasOwnProperty("Invalidator")?e.Invalidator:t("../Invalidator");var r=e.hasOwnProperty("BasicProperty")?e.BasicProperty:t("./BasicProperty");return class DynamicProperty extends r{callbackGet(){var t;return t=this.callOptionFunct("get"),this.revalidated(),t}invalidate(){return this.calculated&&(this.calculated=!1,this._invalidateNotice()),this}_invalidateNotice(){return this.emitEvent("invalidated"),!0}static compose(t){if("function"!=typeof t.options.get&&"function"!=typeof t.options.calcul||null==t.instanceType&&(t.instanceType=class extends DynamicProperty{}),"function"==typeof t.options.get)return t.instanceType.prototype.get=this.prototype.callbackGet}}})},{"../Invalidator":92,"./BasicProperty":98}],103:[function(t,e,r){!function(t){var r=t("undefined"!=typeof Spark?Spark:this.Spark);r.definition=t,null!=e?e.exports=r:"undefined"!=typeof Spark&&null!==Spark?Spark.InvalidatedProperty=r:(null==this.Spark&&(this.Spark={}),this.Spark.InvalidatedProperty=r)}(function(e){null==e&&(e={});var r=e.hasOwnProperty("Invalidator")?e.Invalidator:t("../Invalidator"),i=e.hasOwnProperty("CalculatedProperty")?e.CalculatedProperty:t("./CalculatedProperty");return function(){class InvalidatedProperty extends i{unknown(){return(this.calculated||!1===this.active)&&this._invalidateNotice(),this}static compose(t){if("function"==typeof t.options.calcul&&t.options.calcul.length>0)return t.instanceType.extend(InvalidatedProperty)}}return InvalidatedProperty.overrides({calcul:function(){return this.invalidator||(this.invalidator=new r(this,this.obj)),this.invalidator.recycle((t,e)=>(this.value=this.callOptionFunct(this.calculFunct,t),this.manual=!1,e(),t.isEmpty()?this.invalidator=null:t.bind())),this.revalidated(),this.value},destroy:function(){if(this.destroy.withoutInvalidatedProperty(),null!=this.invalidator)return this.invalidator.unbind()},invalidate:function(){return(this.calculated||!1===this.active)&&(this.calculated=!1,this._invalidateNotice(),this.calculated||null==this.invalidator||this.invalidator.unbind()),this}}),InvalidatedProperty}.call(this)})},{"../Invalidator":92,"./CalculatedProperty":99}],104:[function(t,e,r){!function(t){var r=t("undefined"!=typeof Spark?Spark:this.Spark);r.definition=t,null!=e?e.exports=r:"undefined"!=typeof Spark&&null!==Spark?Spark.Referred=r:(null==this.Spark&&(this.Spark={}),this.Spark.Referred=r)}(function(){return function(){class Referred{compareRefered(t){return this.constructor.compareRefered(t,this)}getRef(){}static compareRefered(t,e){return t===e||null!=t&&null!=e&&t.constructor===e.constructor&&this.compareRef(t.ref,e.ref)}static compareRef(t,e){return null!=t&&null!=e&&(t===e||Array.isArray(t)&&Array.isArray(t)&&t.every((r,i)=>this.compareRefered(t[i],e[i]))||"object"==typeof t&&"object"==typeof e&&Object.keys(t).join()===Object.keys(e).join()&&Object.keys(t).every(r=>this.compareRefered(t[r],e[r])))}}return Object.defineProperty(Referred.prototype,"ref",{get:function(){return this.getRef()}}),Referred}.call(this)})},{}],105:[function(t,e,r){!function(t){var r=t("undefined"!=typeof Spark?Spark:this.Spark);r.definition=t,null!=e?e.exports=r:"undefined"!=typeof Spark&&null!==Spark?Spark.Updater=r:(null==this.Spark&&(this.Spark={}),this.Spark.Updater=r)}(function(e){null==e&&(e={});var r,i=e.hasOwnProperty("Binder")?e.Binder:t("./Binder");return(r=class Updater{constructor(t){var e;this.callbacks=[],this.next=[],this.updating=!1,null!=(null!=t?t.callback:void 0)&&this.addCallback(t.callback),null!=(null!=t&&null!=(e=t.callbacks)?e.forEach:void 0)&&t.callbacks.forEach(t=>this.addCallback(t))}update(){var t;for(this.updating=!0,this.next=this.callbacks.slice();this.callbacks.length>0;)t=this.callbacks.shift(),this.runCallback(t);return this.callbacks=this.next,this.updating=!1,this}runCallback(t){return t()}addCallback(t){if(this.callbacks.includes(t)||this.callbacks.push(t),this.updating&&!this.next.includes(t))return this.next.push(t)}nextTick(t){return this.updating?this.next.includes(t)?void 0:this.next.push(t):this.addCallback(t)}removeCallback(t){var e;if(-1!==(e=this.callbacks.indexOf(t))&&this.callbacks.splice(e,1),-1!==(e=this.next.indexOf(t)))return this.next.splice(e,1)}getBinder(){return new Updater.Binder(this)}destroy(){return this.callbacks=[],this.next=[]}}).Binder=function(t){return class Binder extends t{constructor(t,e){super(),this.target=t,this.callback=e}getRef(){return{target:this.target,callback:this.callback}}doBind(){return this.target.addCallback(this.callback)}doUnbind(){return this.target.removeCallback(this.callback)}}}.call(this,i),r})},{"./Binder":83}],106:[function(t,e,r){e&&(e.exports={Binder:t("./Binder.js"),Collection:t("./Collection.js"),Element:t("./Element.js"),EventBind:t("./EventBind.js"),EventEmitter:t("./EventEmitter.js"),Invalidator:t("./Invalidator.js"),Loader:t("./Loader.js"),Mixable:t("./Mixable.js"),Overrider:t("./Overrider.js"),Property:t("./Property.js"),PropertyOwner:t("./PropertyOwner.js"),Referred:t("./Referred.js"),Updater:t("./Updater.js"),ActivablePropertyWatcher:t("./Invalidated/ActivablePropertyWatcher.js"),CollectionPropertyWatcher:t("./Invalidated/CollectionPropertyWatcher.js"),Invalidated:t("./Invalidated/Invalidated.js"),PropertyWatcher:t("./Invalidated/PropertyWatcher.js"),BasicProperty:t("./PropertyTypes/BasicProperty.js"),CalculatedProperty:t("./PropertyTypes/CalculatedProperty.js"),CollectionProperty:t("./PropertyTypes/CollectionProperty.js"),ComposedProperty:t("./PropertyTypes/ComposedProperty.js"),DynamicProperty:t("./PropertyTypes/DynamicProperty.js"),InvalidatedProperty:t("./PropertyTypes/InvalidatedProperty.js")})},{"./Binder.js":83,"./Collection.js":84,"./Element.js":85,"./EventBind.js":86,"./EventEmitter.js":87,"./Invalidated/ActivablePropertyWatcher.js":88,"./Invalidated/CollectionPropertyWatcher.js":89,"./Invalidated/Invalidated.js":90,"./Invalidated/PropertyWatcher.js":91,"./Invalidator.js":92,"./Loader.js":93,"./Mixable.js":94,"./Overrider.js":95,"./Property.js":96,"./PropertyOwner.js":97,"./PropertyTypes/BasicProperty.js":98,"./PropertyTypes/CalculatedProperty.js":99,"./PropertyTypes/CollectionProperty.js":100,"./PropertyTypes/ComposedProperty.js":101,"./PropertyTypes/DynamicProperty.js":102,"./PropertyTypes/InvalidatedProperty.js":103,"./Referred.js":104,"./Updater.js":105}],107:[function(t,e,r){(function(r){!function(t){var r=t("undefined"!=typeof Parallelio?Parallelio:this.Parallelio);r.definition=t,null!=e?e.exports=r:"undefined"!=typeof Parallelio&&null!==Parallelio?Parallelio.Timing=r:(null==this.Parallelio&&(this.Parallelio={}),this.Parallelio.Timing=r)}(function(e){null==e&&(e={});var i,n=e.hasOwnProperty("BaseUpdater")?e.BaseUpdater:t("spark-starter").Updater;return(i=class Timing{constructor(t=!0){this.running=t,this.children=[]}addChild(t){var e;return e=this.children.indexOf(t),this.updater&&(t.updater.dispatcher=this.updater),-1===e&&this.children.push(t),t.parent=this,this}removeChild(t){var e;return(e=this.children.indexOf(t))>-1&&this.children.splice(e,1),t.parent===this&&(t.parent=null),this}toggle(t){return void 0===t&&(t=!this.running),this.running=t,this.children.forEach(function(e){return e.toggle(t)})}setTimeout(t,e){var r;return r=new this.constructor.Timer(e,t,this.running),this.addChild(r),r}setInterval(t,e){var r;return r=new this.constructor.Timer(e,t,this.running,!0),this.addChild(r),r}pause(){return this.toggle(!1)}unpause(){return this.toggle(!0)}}).Timer=class Timer{constructor(t,e,r=!0,a=!1){this.time=t,this.running=r,this.repeat=a,this.remainingTime=this.time,this.updater=new i.Updater(this),this.dispatcher=new n,e&&this.dispatcher.addCallback(e),this.running&&this._start()}static now(){var t;return null!=("undefined"!=typeof window&&null!==window&&null!=(t=window.performance)?t.now:void 0)?window.performance.now():null!=(null!=r?r.uptime:void 0)?1e3*r.uptime():Date.now()}toggle(t){return void 0===t&&(t=!this.running),t?this._start():this._stop()}pause(){return this.toggle(!1)}unpause(){return this.toggle(!0)}getElapsedTime(){return this.running?this.constructor.now()-this.startTime+this.time-this.remainingTime:this.time-this.remainingTime}setElapsedTime(t){return this._stop(),this.remainingTime=this.time-t,this._start()}getPrc(){return this.getElapsedTime()/this.time}setPrc(t){return this.setElapsedTime(this.time*t)}_start(){return this.running=!0,this.updater.forwardCallbacks(),this.startTime=this.constructor.now(),this.repeat&&!this.interupted?this.id=setInterval(this.tick.bind(this),this.remainingTime):this.id=setTimeout(this.tick.bind(this),this.remainingTime)}_stop(){var t;return t=this.interupted,this.running=!1,this.updater.unforwardCallbacks(),this.remainingTime=this.time-(this.constructor.now()-this.startTime),this.interupted=this.remainingTime!==this.time,this.repeat&&!t?clearInterval(this.id):clearTimeout(this.id)}tick(){var t;return t=this.interupted,this.interupted=!1,this.repeat?this.remainingTime=this.time:this.remainingTime=0,this.dispatcher.update(),this.repeat?t?this._start():this.startTime=this.constructor.now():this.destroy()}destroy(){if(this.repeat?clearInterval(this.id):clearTimeout(this.id),this.updater.destroy(),this.dispatcher.destroy(),this.running=!1,this.parent)return this.parent.removeChild(this)}},i.Updater=class Updater{constructor(t){this.parent=t,this.dispatcher=new n,this.callbacks=[]}addCallback(t){var e;if(this.callbacks.includes(t)||this.callbacks.push(t),(null!=(e=this.parent)?e.running:void 0)&&this.dispatcher)return this.dispatcher.addCallback(t)}removeCallback(t){var e;if(-1!==(e=this.callbacks.indexOf(t))&&this.callbacks.splice(e,1),this.dispatcher)return this.dispatcher.removeCallback(t)}getBinder(){if(this.dispatcher)return new n.Binder(this)}forwardCallbacks(){if(this.dispatcher)return this.callbacks.forEach(t=>this.dispatcher.addCallback(t))}unforwardCallbacks(){if(this.dispatcher)return this.callbacks.forEach(t=>this.dispatcher.removeCallback(t))}destroy(){return this.unforwardCallbacks(),this.callbacks=[],this.parent=null}},i})}).call(this,t("_process"))},{_process:128,"spark-starter":127}],108:[function(t,e,r){arguments[4][36][0].apply(r,arguments)},{dup:36}],109:[function(t,e,r){arguments[4][37][0].apply(r,arguments)},{dup:37}],110:[function(t,e,r){arguments[4][38][0].apply(r,arguments)},{"./Mixable":114,"./Property":116,dup:38}],111:[function(t,e,r){arguments[4][39][0].apply(r,arguments)},{"./Binder":108,dup:39}],112:[function(t,e,r){arguments[4][40][0].apply(r,arguments)},{dup:40}],113:[function(t,e,r){arguments[4][41][0].apply(r,arguments)},{"./Binder":108,"./EventBind":111,dup:41}],114:[function(t,e,r){arguments[4][42][0].apply(r,arguments)},{dup:42}],115:[function(t,e,r){arguments[4][43][0].apply(r,arguments)},{dup:43}],116:[function(t,e,r){arguments[4][44][0].apply(r,arguments)},{"./Mixable":114,"./PropertyOwner":117,"./PropertyTypes/ActivableProperty":118,"./PropertyTypes/BasicProperty":119,"./PropertyTypes/CalculatedProperty":120,"./PropertyTypes/CollectionProperty":121,"./PropertyTypes/ComposedProperty":122,"./PropertyTypes/DynamicProperty":123,"./PropertyTypes/InvalidatedProperty":124,"./PropertyTypes/UpdatedProperty":125,dup:44}],117:[function(t,e,r){arguments[4][45][0].apply(r,arguments)},{dup:45}],118:[function(t,e,r){arguments[4][46][0].apply(r,arguments)},{"../Invalidator":113,"../Overrider":115,"./BasicProperty":119,dup:46}],119:[function(t,e,r){arguments[4][47][0].apply(r,arguments)},{"../Mixable":114,dup:47}],120:[function(t,e,r){arguments[4][48][0].apply(r,arguments)},{"../Invalidator":113,"../Overrider":115,"./DynamicProperty":123,dup:48}],121:[function(t,e,r){arguments[4][49][0].apply(r,arguments)},{"../Collection":109,"./DynamicProperty":123,dup:49}],122:[function(t,e,r){arguments[4][50][0].apply(r,arguments)},{"../Collection":109,"../Invalidator":113,"./CalculatedProperty":120,dup:50}],123:[function(t,e,r){arguments[4][51][0].apply(r,arguments)},{"../Invalidator":113,"./BasicProperty":119,dup:51}],124:[function(t,e,r){arguments[4][52][0].apply(r,arguments)},{"../Invalidator":113,"./CalculatedProperty":120,dup:52}],125:[function(t,e,r){arguments[4][53][0].apply(r,arguments)},{"../Invalidator":113,"../Overrider":115,"./DynamicProperty":123,dup:53}],126:[function(t,e,r){arguments[4][54][0].apply(r,arguments)},{"./Binder":108,dup:54}],127:[function(t,e,r){arguments[4][55][0].apply(r,arguments)},{"./Binder.js":108,"./Collection.js":109,"./Element.js":110,"./EventBind.js":111,"./EventEmitter.js":112,"./Invalidator.js":113,"./Mixable.js":114,"./Overrider.js":115,"./Property.js":116,"./PropertyOwner.js":117,"./PropertyTypes/ActivableProperty.js":118,"./PropertyTypes/BasicProperty.js":119,"./PropertyTypes/CalculatedProperty.js":120,"./PropertyTypes/CollectionProperty.js":121,"./PropertyTypes/ComposedProperty.js":122,"./PropertyTypes/DynamicProperty.js":123,"./PropertyTypes/InvalidatedProperty.js":124,"./PropertyTypes/UpdatedProperty.js":125,"./Updater.js":126,dup:55}],128:[function(t,e,r){var i,n,a=e.exports={};function s(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function l(t){if(i===setTimeout)return setTimeout(t,0);if((i===s||!i)&&setTimeout)return i=setTimeout,setTimeout(t,0);try{return i(t,0)}catch(e){try{return i.call(null,t,0)}catch(e){return i.call(this,t,0)}}}!function(){try{i="function"==typeof setTimeout?setTimeout:s}catch(t){i=s}try{n="function"==typeof clearTimeout?clearTimeout:o}catch(t){n=o}}();var c,p=[],h=!1,u=-1;function d(){h&&c&&(h=!1,c.length?p=c.concat(p):u=-1,p.length&&f())}function f(){if(!h){var t=l(d);h=!0;for(var e=p.length;e;){for(c=p,p=[];++u<e;)c&&c[u].run();u=-1,e=p.length}c=null,h=!1,function(t){if(n===clearTimeout)return clearTimeout(t);if((n===o||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(t);try{n(t)}catch(e){try{return n.call(null,t)}catch(e){return n.call(this,t)}}}(t)}}function y(t,e){this.fun=t,this.array=e}function v(){}a.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)e[r-1]=arguments[r];p.push(new y(t,e)),1!==p.length||h||l(f)},y.prototype.run=function(){this.fun.apply(null,this.array)},a.title="browser",a.browser=!0,a.env={},a.argv=[],a.version="",a.versions={},a.on=v,a.addListener=v,a.once=v,a.off=v,a.removeListener=v,a.removeAllListeners=v,a.emit=v,a.prependListener=v,a.prependOnceListener=v,a.listeners=function(t){return[]},a.binding=function(t){throw new Error("process.binding is not supported")},a.cwd=function(){return"/"},a.chdir=function(t){throw new Error("process.chdir is not supported")},a.umask=function(){return 0}},{}],129:[function(t,e,r){Parallelio.strings={greekAlphabet:["alpha","beta","gamma","delta","epsilon","zeta","eta","theta","iota","kappa","lambda","mu","nu","xi","omicron","pi","rho","sigma","tau","upsilon","phi","chi","psi","omega"],starNames:["Achernar","Maia","Atlas","Salm","Alnilam","Nekkar","Elnath","Thuban","Achird","Marfik","Auva","Sargas","Alnitak","Nihal","Enif","Torcularis","Acrux","Markab","Avior","Sarin","Alphard","Nunki","Etamin","Turais","Acubens","Matar","Azelfafage","Sceptrum","Alphekka","Nusakan","Fomalhaut","Tyl","Adara","Mebsuta","Azha","Scheat","Alpheratz","Peacock","Fornacis","Unukalhai","Adhafera","Megrez","Azmidiske","Segin","Alrai","Phad","Furud","Vega","Adhil","Meissa","Baham","Seginus","Alrisha","Phaet","Gacrux","Vindemiatrix","Agena","Mekbuda","Becrux","Sham","Alsafi","Pherkad","Gianfar","Wasat","Aladfar","Menkalinan","Beid","Sharatan","Alsciaukat","Pleione","Gomeisa","Wezen","Alathfar","Menkar","Bellatrix","Shaula","Alshain","Polaris","Graffias","Wezn","Albaldah","Menkent","Betelgeuse","Shedir","Alshat","Pollux","Grafias","Yed","Albali","Menkib","Botein","Sheliak","Alsuhail","Porrima","Grumium","Yildun","Albireo","Merak","Brachium","Sirius","Altair","Praecipua","Hadar","Zaniah","Alchiba","Merga","Canopus","Situla","Altarf","Procyon","Haedi","Zaurak","Alcor","Merope","Capella","Skat","Alterf","Propus","Hamal","Zavijah","Alcyone","Mesarthim","Caph","Spica","Aludra","Rana","Hassaleh","Zibal","Alderamin","Metallah","Castor","Sterope","Alula","Ras","Heze","Zosma","Aldhibah","Miaplacidus","Cebalrai","Sualocin","Alya","Rasalgethi","Hoedus","Aquarius","Alfirk","Minkar","Celaeno","Subra","Alzirr","Rasalhague","Homam","Aries","Algenib","Mintaka","Chara","Suhail","Ancha","Rastaban","Hyadum","Cepheus","Algieba","Mira","Chort","Sulafat","Angetenar","Regulus","Izar","Cetus","Algol","Mirach","Cursa","Syrma","Ankaa","Rigel","Jabbah","Columba","Algorab","Miram","Dabih","Tabit","Anser","Rotanev","Kajam","Coma","Alhena","Mirphak","Deneb","Talitha","Antares","Ruchba","Kaus","Corona","Alioth","Mizar","Denebola","Tania","Arcturus","Ruchbah","Keid","Crux","Alkaid","Mufrid","Dheneb","Tarazed","Arkab","Rukbat","Kitalpha","Draco","Alkalurops","Muliphen","Diadem","Taygeta","Arneb","Sabik","Kocab","Grus","Alkes","Murzim","Diphda","Tegmen","Arrakis","Sadalachbia","Kornephoros","Hydra","Alkurhah","Muscida","Dschubba","Tejat","Ascella","Sadalmelik","Kraz","Lacerta","Almaak","Naos","Dsiban","Terebellum","Asellus","Sadalsuud","Kuma","Mensa","Alnair","Nash","Dubhe","Thabit","Asterope","Sadr","Lesath","Maasym","Alnath","Nashira","Electra","Theemim","Atik","Saiph","Phoenix","Norma"]}},{}],130:[function(t,e,r){var i;i=t("./Referred"),e.exports=class Binder extends i{toggleBind(t=!this.binded){return t?this.bind():this.unbind()}bind(){return!this.binded&&this.canBind()&&this.doBind(),this.binded=!0}canBind(){return null!=this.callback&&null!=this.target}doBind(){throw new Error("Not implemented")}unbind(){return this.binded&&this.canBind()&&this.doUnbind(),this.binded=!1}doUnbind(){throw new Error("Not implemented")}equals(t){return this.compareRefered(t)}destroy(){return this.unbind()}}},{"./Referred":151}],131:[function(t,e,r){var i;e.exports=i=function(){class Collection{constructor(t){null!=t?"function"==typeof t.toArray?this._array=t.toArray():Array.isArray(t)?this._array=t:this._array=[t]:this._array=[]}changed(){}checkChanges(t,e=!0,r=null){return null==r&&(r=function(t,e){return t===e}),t=null!=t?this.copy(t.slice()):[],this.count()!==t.length||(e?this.some(function(e,i){return!r(t.get(i),e)}):this.some(function(e){return!t.pluck(function(t){return r(e,t)})}))}get(t){return this._array[t]}getRandom(){return this._array[Math.floor(Math.random()*this._array.length)]}set(t,e){var r;return this._array[t]!==e&&(r=this.toArray(),this._array[t]=e,this.changed(r)),e}add(t){if(!this._array.includes(t))return this.push(t)}remove(t){var e,r;if(-1!==(e=this._array.indexOf(t)))return r=this.toArray(),this._array.splice(e,1),this.changed(r)}pluck(t){var e,r,i;return(r=this._array.findIndex(t))>-1?(i=this.toArray(),e=this._array[r],this._array.splice(r,1),this.changed(i),e):null}toArray(){return this._array.slice()}count(){return this._array.length}static newSubClass(t,e){var r;return"object"==typeof t?(r=class extends(this){},Object.assign(r.prototype,t),new r(e)):new this(e)}copy(t){return null==t&&(t=this.toArray()),new this.constructor(t)}equals(t){return this.count()===("function"==typeof t.count?t.count():t.length)&&this.every(function(e,r){return t[r]===e})}getAddedFrom(t){return this._array.filter(function(e){return!t.includes(e)})}getRemovedFrom(t){return t.filter(t=>!this.includes(t))}}return Collection.readFunctions=["every","find","findIndex","forEach","includes","indexOf","join","lastIndexOf","map","reduce","reduceRight","some","toString"],Collection.readListFunctions=["concat","filter","slice"],Collection.writefunctions=["pop","push","reverse","shift","sort","splice","unshift"],Collection.readFunctions.forEach(function(t){return Collection.prototype[t]=function(...e){return this._array[t](...e)}}),Collection.readListFunctions.forEach(function(t){return Collection.prototype[t]=function(...e){return this.copy(this._array[t](...e))}}),Collection.writefunctions.forEach(function(t){return Collection.prototype[t]=function(...e){var r,i;return r=this.toArray(),i=this._array[t](...e),this.changed(r),i}}),Collection}.call(this),Object.defineProperty(i.prototype,"length",{get:function(){return this.count()}}),("undefined"!=typeof Symbol&&null!==Symbol?Symbol.iterator:void 0)&&(i.prototype[Symbol.iterator]=function(){return this._array[Symbol.iterator]()})},{}],132:[function(t,e,r){var i,n;n=t("./Property"),i=t("./Mixable"),e.exports=class Element extends i{constructor(){super(),this.init()}init(){}tap(t){var e;return e=Array.prototype.slice.call(arguments),"function"==typeof t?t.apply(this,e.slice(1)):this[t].apply(this,e.slice(1)),this}callback(t){return null==this._callbacks&&(this._callbacks={}),null==this._callbacks[t]&&(this._callbacks[t]=((...e)=>(this[t].apply(this,e),null)),this._callbacks[t].owner=this),this._callbacks[t]}getFinalProperties(){return null!=this._properties?["_properties"].concat(this._properties.map(function(t){return t.name})):[]}extended(t){var e,r,i,a,s,o;if(null!=this._properties){for(o=[],e=0,r=(s=this._properties).length;e<r;e++)a=s[e],i=Object.assign({},a.options),o.push(new n(a.name,i).bind(t));return o}}static property(t,e){return new n(t,e).bind(this.prototype)}static properties(t){var e,r,i;for(r in i=[],t)e=t[r],i.push(this.property(r,e));return i}}},{"./Mixable":141,"./Property":143}],133:[function(t,e,r){var i;i=t("./Binder"),e.exports=class EventBind extends i{constructor(t,e,r){super(),this.event=t,this.target=e,this.callback=r}getRef(){return{event:this.event,target:this.target,callback:this.callback}}bindTo(t){return this.unbind(),this.target=t,this.bind()}doBind(){if("function"==typeof this.target.addEventListener)return this.target.addEventListener(this.event,this.callback);if("function"==typeof this.target.addListener)return this.target.addListener(this.event,this.callback);if("function"==typeof this.target.on)return this.target.on(this.event,this.callback);throw new Error("No function to add event listeners was found")}doUnbind(){if("function"==typeof this.target.removeEventListener)return this.target.removeEventListener(this.event,this.callback);if("function"==typeof this.target.removeListener)return this.target.removeListener(this.event,this.callback);if("function"==typeof this.target.off)return this.target.off(this.event,this.callback);throw new Error("No function to remove event listeners was found")}equals(t){return super.equals(t)&&t.event===this.event}match(t,e){return t===this.event&&e===this.target}static checkEmitter(t,e=!0){if("function"==typeof t.addEventListener||"function"==typeof t.addListener||"function"==typeof t.on)return!0;if(e)throw new Error("No function to add event listeners was found");return!1}}},{"./Binder":130}],134:[function(t,e,r){e.exports=function(){class EventEmitter{getAllEvents(){return this._events||(this._events={})}getListeners(t){var e;return(e=this.getAllEvents())[t]||(e[t]=[])}hasListener(t,e){return this.getListeners(t).includes(e)}addListener(t,e){if(!this.hasListener(t,e))return this.getListeners(t).push(e),this.listenerAdded(t,e)}listenerAdded(t,e){}removeListener(t,e){var r,i;if(-1!==(r=(i=this.getListeners(t)).indexOf(e)))return i.splice(r,1),this.listenerRemoved(t,e)}listenerRemoved(t,e){}emitEvent(t,...e){return this.getListeners(t).slice().forEach(function(t){return t(...e)})}removeAllListeners(){return this._events={}}}return EventEmitter.prototype.emit=EventEmitter.prototype.emitEvent,EventEmitter.prototype.trigger=EventEmitter.prototype.emitEvent,EventEmitter.prototype.on=EventEmitter.prototype.addListener,EventEmitter.prototype.off=EventEmitter.prototype.removeListener,EventEmitter}.call(this)},{}],135:[function(t,e,r){var i,n;n=t("./PropertyWatcher"),i=t("../Invalidator"),e.exports=class ActivablePropertyWatcher extends n{loadOptions(t){return super.loadOptions(t),this.active=t.active}shouldBind(){var t;return null==this.active||(null==this.invalidator&&(this.invalidator=new i(this,this.scope),this.invalidator.callback=(()=>this.checkBind())),this.invalidator.recycle(),t=this.active(this.invalidator),this.invalidator.endRecycle(),this.invalidator.bind(),t)}}},{"../Invalidator":139,"./PropertyWatcher":138}],136:[function(t,e,r){var i;i=t("./PropertyWatcher"),e.exports=class CollectionPropertyWatcher extends i{loadOptions(t){return super.loadOptions(t),this.onAdded=t.onAdded,this.onRemoved=t.onRemoved}handleChange(t,e){if(e=t.copy(e||[]),"function"==typeof this.callback&&this.callback.call(this.scope,e),"function"==typeof this.onAdded&&t.forEach((t,r)=>{if(!e.includes(t))return this.onAdded.call(this.scope,t)}),"function"==typeof this.onRemoved)return e.forEach((e,r)=>{if(!t.includes(e))return this.onRemoved.call(this.scope,e)})}}},{"./PropertyWatcher":138}],137:[function(t,e,r){var i;i=t("../Invalidator"),e.exports=class Invalidated{constructor(t){null!=t&&this.loadOptions(t),null!=t&&t.initByLoader&&null!=t.loader||this.init()}loadOptions(t){return this.scope=t.scope,t.loaderAsScope&&null!=t.loader&&(this.scope=t.loader),this.callback=t.callback}init(){return this.update()}unknown(){return this.invalidator.validateUnknowns()}invalidate(){return this.update()}update(){return null==this.invalidator&&(this.invalidator=new i(this,this.scope)),this.invalidator.recycle(),this.handleUpdate(this.invalidator),this.invalidator.endRecycle(),this.invalidator.bind(),this}handleUpdate(t){return null!=this.scope?this.callback.call(this.scope,t):this.callback(t)}destroy(){if(this.invalidator)return this.invalidator.unbind()}}},{"../Invalidator":139}],138:[function(t,e,r){var i;i=t("../Binder"),e.exports=class PropertyWatcher extends i{constructor(t){var e;super(),this.options=t,this.invalidateCallback=(()=>this.invalidate()),this.updateCallback=(t=>this.update(t)),null!=this.options&&this.loadOptions(this.options),null!=(e=this.options)&&e.initByLoader&&null!=this.options.loader||this.init()}loadOptions(t){return this.scope=t.scope,t.loaderAsScope&&null!=t.loader&&(this.scope=t.loader),this.property=t.property,this.callback=t.callback,this.autoBind=t.autoBind}copyWith(t){return new this.__proto__.constructor(Object.assign({},this.options,t))}init(){if(this.autoBind)return this.checkBind()}getProperty(){return"string"==typeof this.property&&(this.property=this.scope.getPropertyInstance(this.property)),this.property}checkBind(){return this.toggleBind(this.shouldBind())}shouldBind(){return!0}canBind(){return null!=this.getProperty()}doBind(){return this.update(),this.getProperty().on("invalidated",this.invalidateCallback),this.getProperty().on("updated",this.updateCallback)}doUnbind(){return this.getProperty().off("invalidated",this.invalidateCallback),this.getProperty().off("updated",this.updateCallback)}getRef(){return"string"==typeof this.property?{property:this.property,target:this.scope,callback:this.callback}:{property:this.property.property.name,target:this.property.obj,callback:this.callback}}invalidate(){return this.getProperty().get()}update(t){var e;return e=this.getProperty().get(),this.handleChange(e,t)}handleChange(t,e){return this.callback.call(this.scope,e)}}},{"../Binder":130}],139:[function(t,e,r){var i,n,a;i=t("./Binder"),n=t("./EventBind"),a=function(t,e){var r,i;return(i=t.findIndex(e))>-1?(r=t[i],t.splice(i,1),r):null},e.exports=function(){class Invalidator extends i{constructor(t,e=null){super(),this.invalidated=t,this.scope=e,this.invalidationEvents=[],this.recycled=[],this.unknowns=[],this.strict=this.constructor.strict,this.invalid=!1,this.invalidateCallback=(()=>(this.invalidate(),null)),this.invalidateCallback.owner=this}invalidate(){var t;return this.invalid=!0,"function"==typeof this.invalidated?this.invalidated():"function"==typeof this.callback?this.callback():null!=this.invalidated&&"function"==typeof this.invalidated.invalidate?this.invalidated.invalidate():"string"==typeof this.invalidated?(t="invalidate"+this.invalidated.charAt(0).toUpperCase()+this.invalidated.slice(1),"function"==typeof this.scope[t]?this.scope[t]():this.scope[this.invalidated]=null):void 0}unknown(){var t;return"function"==typeof(null!=(t=this.invalidated)?t.unknown:void 0)?this.invalidated.unknown():this.invalidate()}addEventBind(t,e,r){return this.addBinder(new n(t,e,r))}addBinder(t){if(null==t.callback&&(t.callback=this.invalidateCallback),!this.invalidationEvents.some(function(e){return e.equals(t)}))return this.invalidationEvents.push(a(this.recycled,function(e){return e.equals(t)})||t)}getUnknownCallback(t){var e;return(e=(()=>this.addUnknown(function(){return t.get()},t))).ref={prop:t},e}addUnknown(t,e){if(!this.findUnknown(e))return t.ref={prop:e},this.unknowns.push(t),this.unknown()}findUnknown(t){if(null!=t||"undefined"!=typeof target&&null!==target)return this.unknowns.find(function(e){return e.ref.prop===t})}event(t,e=this.scope){if(this.checkEmitter(e))return this.addEventBind(t,e)}value(t,e,r=this.scope){return this.event(e,r),t}prop(t,e=this.scope){var r;if("string"==typeof t){if(null==e.getPropertyInstance||!(r=e.getPropertyInstance(t)))return e[t];t=r}else if(!this.checkPropInstance(t))throw new Error("Property must be a PropertyInstance or a string");return this.addEventBind("invalidated",t,this.getUnknownCallback(t)),this.value(t.get(),"updated",t)}propPath(t,e=this.scope){var r,i;for(t=t.split("."),i=e;null!=i&&t.length>0;)r=t.shift(),i=this.prop(r,i);return i}propInitiated(t,e=this.scope){var r;if("string"==typeof t&&null!=e.getPropertyInstance)t=e.getPropertyInstance(t);else if(!this.checkPropInstance(t))throw new Error("Property must be a PropertyInstance or a string");return(r=t.initiated)||this.event("updated",t),r}funct(t){var e,r;return e=new Invalidator(()=>this.addUnknown(()=>{var i;if(i=t(e),r!==i)return this.invalidate()},e)),r=t(e),this.invalidationEvents.push(e),r}validateUnknowns(){var t;return t=this.unknowns,this.unknowns=[],t.forEach(function(t){return t()})}isEmpty(){return 0===this.invalidationEvents.length}bind(){return this.invalid=!1,this.invalidationEvents.forEach(function(t){return t.bind()})}recycle(t){var e,r;return this.recycled=this.invalidationEvents,this.invalidationEvents=[],e=this.endRecycle.bind(this),"function"==typeof t?t.length>1?t(this,e):(r=t(this),e(),r):e}endRecycle(){return this.recycled.forEach(function(t){return t.unbind()}),this.recycled=[]}checkEmitter(t){return n.checkEmitter(t,this.strict)}checkPropInstance(t){return"function"==typeof t.get&&this.checkEmitter(t)}unbind(){return this.invalidationEvents.forEach(function(t){return t.unbind()})}}return Invalidator.strict=!0,Invalidator}.call(this)},{"./Binder":130,"./EventBind":133}],140:[function(t,e,r){var i;i=t("./Overrider"),e.exports=function(){class Loader extends i{constructor(){super(),this.initPreloaded()}initPreloaded(){var t;return t=this.preloaded,this.preloaded=[],this.load(t)}load(t){var e,r;return r=[],e=t.map(t=>{var e;return null==t.instance&&(t=Object.assign({loader:this},t),e=Loader.load(t),(t=Object.assign({instance:e},t)).initByLoader&&null!=e.init&&r.push(e)),t}),this.preloaded=this.preloaded.concat(e),r.forEach(function(t){return t.init()})}preload(t){return Array.isArray(t)||(t=[t]),this.preloaded=(this.preloaded||[]).concat(t)}destroyLoaded(){return this.preloaded.forEach(function(t){var e;return null!=(e=t.instance)&&"function"==typeof e.destroy?e.destroy():void 0})}getFinalProperties(){return super.getFinalProperties().concat(["preloaded"])}extended(t){if(super.extended(t),this.preloaded)return t.preloaded=(t.preloaded||[]).concat(this.preloaded)}static loadMany(t){return t.map(t=>this.load(t))}static load(t){return"function"==typeof t.type.copyWith?t.type.copyWith(t):new t.type(t)}static preload(t){return this.prototype.preload(t)}}return Loader.prototype.preloaded=[],Loader.overrides({init:function(){return this.init.withoutLoader(),this.initPreloaded()},destroy:function(){return this.destroy.withoutLoader(),this.destroyLoaded()}}),Loader}.call(this)},{"./Overrider":142}],141:[function(t,e,r){var i=[].indexOf;e.exports=function(){class Mixable{static extend(t){if(this.Extension.make(t,this),null!=t.prototype)return this.Extension.make(t.prototype,this.prototype)}static include(t){return this.Extension.make(t,this.prototype)}}return Mixable.Extension={makeOnce:function(t,e){var r;if(!(null!=(r=e.extensions)?r.includes(t):void 0))return this.make(t,e)},make:function(t,e){var r,i,n,a,s;for(r=0,i=(s=this.getExtensionProperties(t,e)).length;r<i;r++)a=s[r],Object.defineProperty(e,a.name,a);if(t.getFinalProperties&&e.getFinalProperties?(n=e.getFinalProperties,e.getFinalProperties=function(){return t.getFinalProperties().concat(n.call(this))}):e.getFinalProperties=t.getFinalProperties||e.getFinalProperties,e.extensions=(e.extensions||[]).concat([t]),"function"==typeof t.extended)return t.extended(e)},alwaysFinal:["extended","extensions","__super__","constructor","getFinalProperties"],getExtensionProperties:function(t,e){var r,n,a;return r=this.alwaysFinal,a=this.getPrototypeChain(e),n=[],this.getPrototypeChain(t).every(function(s){var o;if(!a.includes(s))return o=r,null!=t.getFinalProperties&&(o=o.concat(t.getFinalProperties())),"function"==typeof s&&(o=o.concat(["length","prototype","name"])),n=n.concat(Object.getOwnPropertyNames(s).filter(t=>!e.hasOwnProperty(t)&&"__"!==t.substr(0,2)&&i.call(o,t)<0&&!n.find(function(e){return e.name===t})).map(function(t){var e;return(e=Object.getOwnPropertyDescriptor(s,t)).name=t,e})),!0}),n},getPrototypeChain:function(t){var e,r;for(r=[],e=Object.getPrototypeOf(Object);r.push(t),(t=Object.getPrototypeOf(t))&&t!==Object&&t!==e;);return r}},Mixable}.call(this)},{}],142:[function(t,e,r){e.exports=function(){class Overrider{static overrides(t){return this.Override.applyMany(this.prototype,this.name,t)}getFinalProperties(){return null!=this._overrides?["_overrides"].concat(Object.keys(this._overrides)):[]}extended(t){if(null!=this._overrides&&this.constructor.Override.applyMany(t,this.constructor.name,this._overrides),this.constructor===Overrider)return t.extended=this.extended}}return Overrider.Override={makeMany:function(t,e,r){var i,n,a;for(n in a=[],r)i=r[n],a.push(this.make(t,e,n,i));return a},applyMany:function(t,e,r){var i,n,a;for(i in a=[],r)"function"==typeof(n=r[i])&&(n=this.make(t,e,i,n)),a.push(this.apply(t,e,n));return a},make:function(t,e,r,i){var n;return(n={fn:{current:i},name:r}).fn["with"+e]=i,n},emptyFn:function(){},apply:function(t,e,r){var i,n,a,s,o;return i=r.name,n=null!=t._overrides?Object.assign({},t._overrides):{},o=(null!=(a=t._overrides)&&null!=(s=a[i])?s.fn.current:void 0)||t[i],r=Object.assign({},r),null!=n[i]?r.fn=Object.assign({},n[i].fn,r.fn):r.fn=Object.assign({},r.fn),r.fn["without"+e]=o||this.emptyFn,null==o?r.missingWithout="without"+e:r.missingWithout&&(r.fn[r.missingWithout]=o),Object.defineProperty(t,i,{configurable:!0,get:function(){var t,e,n,a;for(n in t=r.fn.current.bind(this),a=r.fn)e=a[n],t[n]=e.bind(this);return this.constructor.prototype!==this&&Object.defineProperty(this,i,{value:t}),t}}),n[i]=r,t._overrides=n}},Overrider}.call(this)},{}],143:[function(t,e,r){var i,n,a,s,o,l,c,p;i=t("./PropertyTypes/BasicProperty"),a=t("./PropertyTypes/CollectionProperty"),s=t("./PropertyTypes/ComposedProperty"),o=t("./PropertyTypes/DynamicProperty"),n=t("./PropertyTypes/CalculatedProperty"),l=t("./PropertyTypes/InvalidatedProperty"),p=t("./PropertyOwner"),c=t("./Mixable"),e.exports=function(){class Property{constructor(t,e={}){this.name=t,this.options=e}bind(t){var e;return this,"function"==typeof t.getProperty&&t.getProperty(this.name)===this||("function"==typeof t.getProperty&&null!=(e=t.getProperty(this.name))&&this.override(e),this.getInstanceType().bind(t,this),t._properties=(t._properties||[]).concat([this]),null!=e&&(t._properties=t._properties.filter(function(t){return t!==e})),this.makeOwner(t)),this}override(t){var e,r,i,n;if(null==this.options.parent){for(e in this.options.parent=t.options,i=[],r=t.options)n=r[e],"function"==typeof this.options[e]&&"function"==typeof n?i.push(this.options[e].overrided=n):void 0===this.options[e]?i.push(this.options[e]=n):i.push(void 0);return i}}makeOwner(t){var e;if(!(null!=(e=t.extensions)?e.includes(p.prototype):void 0))return c.Extension.make(p.prototype,t)}getInstanceVarName(){return this.options.instanceVarName||"_"+this.name}isInstantiated(t){return null!=t[this.getInstanceVarName()]}getInstance(t){var e,r;return r=this.getInstanceVarName(),this.isInstantiated(t)||(e=this.getInstanceType(),t[r]=new e(this,t),t[r].init()),t[r]}getInstanceType(){return this.instanceType||this.composers.forEach(t=>t.compose(this)),this.instanceType}}return Property.prototype.composers=[s,a,o,i,n,l],Property}.call(this)},{"./Mixable":141,"./PropertyOwner":144,"./PropertyTypes/BasicProperty":145,"./PropertyTypes/CalculatedProperty":146,"./PropertyTypes/CollectionProperty":147,"./PropertyTypes/ComposedProperty":148,"./PropertyTypes/DynamicProperty":149,"./PropertyTypes/InvalidatedProperty":150}],144:[function(t,e,r){e.exports=class PropertyOwner{getProperty(t){return this._properties&&this._properties.find(function(e){return e.name===t})}getPropertyInstance(t){var e;if(e=this.getProperty(t))return e.getInstance(this)}getProperties(){return this._properties.slice()}getPropertyInstances(){return this._properties.map(t=>t.getInstance(this))}getInstantiatedProperties(){return this._properties.filter(t=>t.isInstantiated(this)).map(t=>t.getInstance(this))}getManualDataProperties(){return this._properties.reduce((t,e)=>{var r;return e.isInstantiated(this)&&(r=e.getInstance(this)).calculated&&r.manual&&(t[e.name]=r.value),t},{})}setProperties(t,e={}){var r,i,n;for(r in t)n=t[r],null!=e.whitelist&&-1===e.whitelist.indexOf(r)||null!=e.blacklist&&-1!==e.blacklist.indexOf(r)||null!=(i=this.getPropertyInstance(r))&&i.set(n);return this}destroyProperties(){return this.getInstantiatedProperties().forEach(t=>t.destroy()),this._properties=[],!0}listenerAdded(t,e){return this._properties.forEach(e=>{if(e.getInstanceType().prototype.changeEventName===t)return e.getInstance(this).get()})}extended(t){return t.listenerAdded=this.listenerAdded}}},{}],145:[function(t,e,r){var i,n,a,s,o;a=t("../Mixable"),i=t("../EventEmitter"),n=t("../Loader"),s=t("../Invalidated/PropertyWatcher"),o=t("../Referred"),e.exports=function(){class BasicProperty extends a{constructor(t,e){super(),this.property=t,this.obj=e}init(){var t;if(this.value=this.ingest(this.default),this.calculated=!1,this.initiated=!1,(t=this.constructor.getPreload(this.obj,this.property,this)).length>0)return n.loadMany(t)}get(){return this.calculated=!0,this.initiated||(this.initiated=!0,this.emitEvent("updated")),this.output()}set(t){return this.setAndCheckChanges(t)}callbackSet(t){return this.callOptionFunct("set",t),this}setAndCheckChanges(t){var e;return t=this.ingest(t),this.revalidated(),this.checkChanges(t,this.value)&&(e=this.value,this.value=t,this.manual=!0,this.changed(e)),this}checkChanges(t,e){return t!==e}destroy(){var t;return!0===this.property.options.destroy&&null!=(null!=(t=this.value)?t.destroy:void 0)&&this.value.destroy(),"function"==typeof this.property.options.destroy&&this.callOptionFunct("destroy",this.value),this.value=null}callOptionFunct(t,...e){return"string"==typeof t&&(t=this.property.options[t]),"function"==typeof t.overrided&&e.push((...e)=>this.callOptionFunct(t.overrided,...e)),t.apply(this.obj,e)}revalidated(){return this.calculated=!0,this.initiated=!0}ingest(t){return"function"==typeof this.property.options.ingest?this.callOptionFunct("ingest",t):t}output(){return"function"==typeof this.property.options.output?this.callOptionFunct("output",this.value):this.value}changed(t){return this.emitEvent("updated",t),this.emitEvent("changed",t),this}static compose(t){return null==t.instanceType&&(t.instanceType=class extends BasicProperty{}),"function"==typeof t.options.set?t.instanceType.prototype.set=this.prototype.callbackSet:t.instanceType.prototype.set=this.prototype.setAndCheckChanges,t.instanceType.prototype.default=t.options.default}static bind(t,e){var r,i,s;if(r=e.name.charAt(0).toUpperCase()+e.name.slice(1),i={configurable:!0,get:function(){return e.getInstance(this).get()}},!1!==e.options.set&&(i.set=function(t){return e.getInstance(this).set(t)}),Object.defineProperty(t,e.name,i),t["get"+r]=function(){return e.getInstance(this).get()},!1!==e.options.set&&(t["set"+r]=function(t){return e.getInstance(this).set(t),this}),t["invalidate"+r]=function(){return e.getInstance(this).invalidate(),this},(s=this.getPreload(t,e)).length>0)return a.Extension.makeOnce(n.prototype,t),t.preload(s)}static getPreload(t,e,r){var i,n,a,l;return i=[],"function"==typeof e.options.change&&(l={type:s,loaderAsScope:!0,property:r||e.name,initByLoader:!0,autoBind:!0,callback:e.options.change,ref:{prop:e.name,callback:e.options.change,context:"change"}}),"function"==typeof(null!=(n=e.options.change)?n.copyWith:void 0)&&(l={type:e.options.change,loaderAsScope:!0,property:r||e.name,initByLoader:!0,autoBind:!0,ref:{prop:e.name,type:e.options.change,context:"change"}}),null==l||(null!=(a=t.preloaded)?a.find(function(t){return o.compareRef(l.ref,t.ref)&&!r||null!=t.instance}):void 0)||i.push(l),i}}return BasicProperty.extend(i),BasicProperty}.call(this)},{"../EventEmitter":134,"../Invalidated/PropertyWatcher":138,"../Loader":140,"../Mixable":141,"../Referred":151}],146:[function(t,e,r){var i,n;t("../Invalidator"),i=t("./DynamicProperty"),n=t("../Overrider"),e.exports=function(){class CalculatedProperty extends i{calcul(){return this.value=this.callOptionFunct(this.calculFunct),this.manual=!1,this.revalidated(),this.value}static compose(t){if("function"==typeof t.options.calcul&&(t.instanceType.prototype.calculFunct=t.options.calcul,!(t.options.calcul.length>0)))return t.instanceType.extend(CalculatedProperty)}}return CalculatedProperty.extend(n),CalculatedProperty.overrides({get:function(){var t,e;return this.invalidator&&this.invalidator.validateUnknowns(),this.calculated||(e=this.value,t=this.initiated,this.calcul(),this.checkChanges(this.value,e)?t?this.changed(e):this.emitEvent("updated",e):t||this.emitEvent("updated",e)),this.output()}}),CalculatedProperty}.call(this)},{"../Invalidator":139,"../Overrider":142,"./DynamicProperty":149}],147:[function(t,e,r){var i,n,a,s;a=t("./DynamicProperty"),i=t("../Collection"),s=t("../Referred"),n=t("../Invalidated/CollectionPropertyWatcher"),e.exports=function(){class CollectionProperty extends a{ingest(t){return"function"==typeof this.property.options.ingest&&(t=this.callOptionFunct("ingest",t)),null==t?[]:"function"==typeof t.toArray?t.toArray():Array.isArray(t)?t.slice():[t]}checkChangedItems(t,e){var r;return"function"==typeof this.collectionOptions.compare&&(r=this.collectionOptions.compare),new i(t).checkChanges(e,this.collectionOptions.ordered,r)}output(){var t,e,r;return r=this.value,"function"==typeof this.property.options.output&&(r=this.callOptionFunct("output",this.value)),e=this,(t=i.newSubClass(this.collectionOptions,r)).changed=function(t){return e.changed(t)},t}static compose(t){if(null!=t.options.collection&&(t.instanceType=class extends CollectionProperty{},t.instanceType.prototype.collectionOptions=Object.assign({},this.defaultCollectionOptions,"object"==typeof t.options.collection?t.options.collection:{}),null!=t.options.collection.compare))return t.instanceType.prototype.checkChanges=this.prototype.checkChangedItems}static getPreload(t,e,r){var i,a,o;return i=[],"function"!=typeof e.options.change&&"function"!=typeof e.options.itemAdded&&"function"!=typeof e.options.itemRemoved||(a={prop:e.name,context:"change"},(null!=(o=t.preloaded)?o.find(function(t){return s.compareRef(a,t.ref)&&null!=t.instance}):void 0)||i.push({type:n,loaderAsScope:!0,scope:t,property:r||e.name,initByLoader:!0,autoBind:!0,callback:e.options.change,onAdded:e.options.itemAdded,onRemoved:e.options.itemRemoved,ref:a})),i}}return CollectionProperty.defaultCollectionOptions={compare:!1,ordered:!0},CollectionProperty}.call(this)},{"../Collection":131,"../Invalidated/CollectionPropertyWatcher":136,"../Referred":151,"./DynamicProperty":149}],148:[function(t,e,r){var i,n,a,s;i=t("./CalculatedProperty"),s=t("../Invalidator"),n=t("../Collection"),e.exports=a=function(){class ComposedProperty extends i{init(){return this.initComposed(),super.init()}initComposed(){return this.property.options.hasOwnProperty("default")?this.default=this.property.options.default:this.default=this.value=!0,this.members=new ComposedProperty.Members(this.property.options.members),this.members.changed=(t=>this.invalidate()),this.join="function"==typeof this.property.options.composed?this.property.options.composed:!1===this.property.options.default?ComposedProperty.joinFunctions.or:ComposedProperty.joinFunctions.and}calcul(){return this.invalidator||(this.invalidator=new s(this,this.obj)),this.invalidator.recycle((t,e)=>(this.value=this.members.reduce((t,e)=>{var r;return r="function"==typeof e?e(this.invalidator):e,this.join(t,r)},this.default),e(),t.isEmpty()?this.invalidator=null:t.bind())),this.revalidated(),this.value}static compose(t){if(null!=t.options.composed)return t.instanceType=class extends ComposedProperty{}}static bind(t,e){return i.bind(t,e),Object.defineProperty(t,e.name+"Members",{configurable:!0,get:function(){return e.getInstance(this).members}})}}return ComposedProperty.joinFunctions={and:function(t,e){return t&&e},or:function(t,e){return t||e}},ComposedProperty}.call(this),a.Members=class Members extends n{addPropertyRef(t,e){var r;if(-1===this.findRefIndex(t,e))return(r=function(r){return r.prop(t,e)}).ref={name:t,obj:e},this.push(r)}addValueRef(t,e,r){var i;if(-1===this.findRefIndex(e,r))return(i=function(e){return t}).ref={name:e,obj:r,val:t},this.push(i)}setValueRef(t,e,r){var i,n;return-1===(n=this.findRefIndex(e,r))?this.addValueRef(t,e,r):this.get(n).ref.val!==t?((i=function(e){return t}).ref={name:e,obj:r,val:t},this.set(n,i)):void 0}getValueRef(t,e){return this.findByRef(t,e).ref.val}addFunctionRef(t,e,r){if(-1===this.findRefIndex(e,r))return t.ref={name:e,obj:r},this.push(t)}findByRef(t,e){return this._array[this.findRefIndex(t,e)]}findRefIndex(t,e){return this._array.findIndex(function(r){return null!=r.ref&&r.ref.obj===e&&r.ref.name===t})}removeRef(t,e){var r,i;if(-1!==(r=this.findRefIndex(t,e)))return i=this.toArray(),this._array.splice(r,1),this.changed(i)}}},{"../Collection":131,"../Invalidator":139,"./CalculatedProperty":146}],149:[function(t,e,r){var i;t("../Invalidator"),i=t("./BasicProperty"),e.exports=class DynamicProperty extends i{callbackGet(){var t;return t=this.callOptionFunct("get"),this.revalidated(),t}invalidate(){return this.calculated&&(this.calculated=!1,this._invalidateNotice()),this}_invalidateNotice(){return this.emitEvent("invalidated"),!0}static compose(t){if("function"!=typeof t.options.get&&"function"!=typeof t.options.calcul||null==t.instanceType&&(t.instanceType=class extends DynamicProperty{}),"function"==typeof t.options.get)return t.instanceType.prototype.get=this.prototype.callbackGet}}},{"../Invalidator":139,"./BasicProperty":145}],150:[function(t,e,r){var i,n;n=t("../Invalidator"),i=t("./CalculatedProperty"),e.exports=function(){class InvalidatedProperty extends i{unknown(){return(this.calculated||!1===this.active)&&this._invalidateNotice(),this}static compose(t){if("function"==typeof t.options.calcul&&t.options.calcul.length>0)return t.instanceType.extend(InvalidatedProperty)}}return InvalidatedProperty.overrides({calcul:function(){return this.invalidator||(this.invalidator=new n(this,this.obj)),this.invalidator.recycle((t,e)=>(this.value=this.callOptionFunct(this.calculFunct,t),this.manual=!1,e(),t.isEmpty()?this.invalidator=null:t.bind())),this.revalidated(),this.value},destroy:function(){if(this.destroy.withoutInvalidatedProperty(),null!=this.invalidator)return this.invalidator.unbind()},invalidate:function(){return(this.calculated||!1===this.active)&&(this.calculated=!1,this._invalidateNotice(),this.calculated||null==this.invalidator||this.invalidator.unbind()),this}}),InvalidatedProperty}.call(this)},{"../Invalidator":139,"./CalculatedProperty":146}],151:[function(t,e,r){e.exports=function(){class Referred{compareRefered(t){return this.constructor.compareRefered(t,this)}getRef(){}static compareRefered(t,e){return t===e||null!=t&&null!=e&&t.constructor===e.constructor&&this.compareRef(t.ref,e.ref)}static compareRef(t,e){return null!=t&&null!=e&&(t===e||Array.isArray(t)&&Array.isArray(t)&&t.every((r,i)=>this.compareRefered(t[i],e[i]))||"object"==typeof t&&"object"==typeof e&&Object.keys(t).join()===Object.keys(e).join()&&Object.keys(t).every(r=>this.compareRefered(t[r],e[r])))}}return Object.defineProperty(Referred.prototype,"ref",{get:function(){return this.getRef()}}),Referred}.call(this)},{}],152:[function(t,e,r){var i,n;i=t("./Binder"),e.exports=n=class Updater{constructor(t){var e;this.callbacks=[],this.next=[],this.updating=!1,null!=(null!=t?t.callback:void 0)&&this.addCallback(t.callback),null!=(null!=t&&null!=(e=t.callbacks)?e.forEach:void 0)&&t.callbacks.forEach(t=>this.addCallback(t))}update(){var t;for(this.updating=!0,this.next=this.callbacks.slice();this.callbacks.length>0;)t=this.callbacks.shift(),this.runCallback(t);return this.callbacks=this.next,this.updating=!1,this}runCallback(t){return t()}addCallback(t){if(this.callbacks.includes(t)||this.callbacks.push(t),this.updating&&!this.next.includes(t))return this.next.push(t)}nextTick(t){return this.updating?this.next.includes(t)?void 0:this.next.push(t):this.addCallback(t)}removeCallback(t){var e;if(-1!==(e=this.callbacks.indexOf(t))&&this.callbacks.splice(e,1),-1!==(e=this.next.indexOf(t)))return this.next.splice(e,1)}getBinder(){return new Updater.Binder(this)}destroy(){return this.callbacks=[],this.next=[]}},n.Binder=function(t){return class Binder extends t{constructor(t,e){super(),this.target=t,this.callback=e}getRef(){return{target:this.target,callback:this.callback}}doBind(){return this.target.addCallback(this.callback)}doUnbind(){return this.target.removeCallback(this.callback)}}}.call(this,i)},{"./Binder":130}],153:[function(t,e,r){e.exports={Binder:t("./Binder"),Collection:t("./Collection"),Element:t("./Element"),EventBind:t("./EventBind"),EventEmitter:t("./EventEmitter"),Invalidator:t("./Invalidator"),Loader:t("./Loader"),Mixable:t("./Mixable"),Overrider:t("./Overrider"),Property:t("./Property"),PropertyOwner:t("./PropertyOwner"),Referred:t("./Referred"),Updater:t("./Updater"),Invalidated:{ActivablePropertyWatcher:t("./Invalidated/ActivablePropertyWatcher"),CollectionPropertyWatcher:t("./Invalidated/CollectionPropertyWatcher"),Invalidated:t("./Invalidated/Invalidated"),PropertyWatcher:t("./Invalidated/PropertyWatcher")},PropertyTypes:{BasicProperty:t("./PropertyTypes/BasicProperty"),CalculatedProperty:t("./PropertyTypes/CalculatedProperty"),CollectionProperty:t("./PropertyTypes/CollectionProperty"),ComposedProperty:t("./PropertyTypes/ComposedProperty"),DynamicProperty:t("./PropertyTypes/DynamicProperty"),InvalidatedProperty:t("./PropertyTypes/InvalidatedProperty")}}},{"./Binder":130,"./Collection":131,"./Element":132,"./EventBind":133,"./EventEmitter":134,"./Invalidated/ActivablePropertyWatcher":135,"./Invalidated/CollectionPropertyWatcher":136,"./Invalidated/Invalidated":137,"./Invalidated/PropertyWatcher":138,"./Invalidator":139,"./Loader":140,"./Mixable":141,"./Overrider":142,"./Property":143,"./PropertyOwner":144,"./PropertyTypes/BasicProperty":145,"./PropertyTypes/CalculatedProperty":146,"./PropertyTypes/CollectionProperty":147,"./PropertyTypes/ComposedProperty":148,"./PropertyTypes/DynamicProperty":149,"./PropertyTypes/InvalidatedProperty":150,"./Referred":151,"./Updater":152}]},{},[31,129])(129)});