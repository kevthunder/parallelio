(function(){var t,e,i,n,l,s,o=[].slice,r=[].indexOf||function(t){for(var e=0,i=this.length;e<i;e++)if(e in this&&this[e]===t)return e;return-1},h=function(t,e){function i(){this.constructor=t}for(var n in e)u.call(e,n)&&(t[n]=e[n]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},u={}.hasOwnProperty;void 0!==e&&null!==e||(e={}),void 0!==n&&null!==n||(n={}),t=function(){function t(){}return t.elementKeywords=["extended","included"],t.prototype.tap=function(t){var e;return e=Array.prototype.slice.call(arguments),"function"==typeof t?t.apply(this,e.slice(1)):this[t].apply(this,e.slice(1)),this},t.prototype.callback=function(t){return null==this._callbacks&&(this._callbacks={}),null!=this._callbacks[t]?this._callbacks[t]:this._callbacks[t]=function(e){return function(){var i;return i=1<=arguments.length?o.call(arguments,0):[],e[t].call(e,i)}}(this)},t.extend=function(e){var i,n,l;for(i in e)l=e[i],r.call(t.elementKeywords,i)<0&&(this[i]=l);return null!=(n=e.extended)&&n.apply(this),this},t.include=function(e){var i,n,l;for(i in e)l=e[i],r.call(t.elementKeywords,i)<0&&(this.prototype[i]=l);return null!=(n=e.included)&&n.apply(this),this},t.property=function(t,e){var i;return i=t.charAt(0).toUpperCase()+t.slice(1),null!=e.default?this.prototype["_"+t]=e.default:this.prototype["_"+t]=null,null!=e.get&&!1===e.get||(null!=e.get?this.prototype["get"+i]=e.get:(null!=e.init&&(this.prototype["init"+i]=e.init),this.prototype["get"+i]=function(){return"function"==typeof this["init"+i]&&null==this["_"+t]&&(this["_"+t]=this["init"+i]()),this["_"+t]}),e.get=function(){return this["get"+i]()}),null!=e.set&&!1===e.set||(null!=e.set?this.prototype["set"+i]=e.set:(null!=e.change&&(this.prototype["change"+i]=e.change),null!=e.ingest&&(this.prototype["ingest"+i]=e.ingest),this.prototype["set"+i]=function(e){var n;return"function"==typeof this["ingest"+i]&&(e=this["ingest"+i](e)),this["_"+t]!==e&&(n=this["_"+t],this["_"+t]=e,"function"==typeof this["change"+i]&&this["change"+i](n),"function"==typeof this.emitEvent&&this.emitEvent("changed"+i,[n])),this}),e.set=function(t){return this["set"+i](t)}),Object.defineProperty(this.prototype,t,e)},t.properties=function(t){var e,i,n;n=[];for(i in t)e=t[i],n.push(this.property(i,e));return n},t}(),null!=n&&(n.Element=t),i=function(t){function e(t,e,i,n){this.tilesContainer=t,this.from=e,this.to=i,null==n&&(n={}),this.reset(),null!=n.validTile&&(this.validTileCallback=n.validTile)}return h(e,t),e.properties({validTileCallback:{}}),e.prototype.reset=function(){return this.queue=[],this.paths={},this.solution=null,this.started=!1},e.prototype.calcul=function(){for(;!this.solution&&(!this.started||this.queue.length);)this.step();return this.getPath()},e.prototype.step=function(){var t;return this.queue.length?(t=this.queue.pop(),this.addNextSteps(t),!0):this.started?void 0:(this.started=!0,this.addNextSteps(),!0)},e.prototype.getPath=function(){var t,e;if(this.solution){for(t=[this.solution],e=this.solution;null!=e.prev;)t.unshift(e.prev),e=e.prev;return t}},e.prototype.getPosAtTime=function(t){var e,i;if(this.solution){if(t>=this.solution.getTotalLength())return this.solution.posToTileOffset(this.solution.getExit().x,this.solution.getExit().y);for(i=this.solution;i.getStartLength()>t&&null!=i.prev;)i=i.prev;return e=(t-i.getStartLength())/i.getLength(),i.posToTileOffset(i.getEntry().x+(i.getExit().x-i.getEntry().x)*e,i.getEntry().y+(i.getExit().y-i.getEntry().y)*e)}},e.prototype.tileIsValid=function(t){return null!=this.validTileCallback?this.validTileCallback(t):!t.emulated||0!==t.tile&&!1!==t.tile},e.prototype.getTile=function(t,e){var i;return null!=this.tilesContainer.getTile?this.tilesContainer.getTile(t,e):null!=(null!=(i=this.tilesContainer[e])?i[t]:void 0)?{x:t,y:e,tile:this.tilesContainer[e][t],emulated:!0}:void 0},e.prototype.getConnectedToTile=function(t){var e,i;return null!=t.getConnected?t.getConnected():(e=[],(i=this.getTile(t.x+1,t.y))&&e.push(i),(i=this.getTile(t.x-1,t.y))&&e.push(i),(i=this.getTile(t.x,t.y+1))&&e.push(i),(i=this.getTile(t.x,t.y-1))&&e.push(i),e)},e.prototype.addNextSteps=function(t){var i,n,l,s,o,r;for(null==t&&(t=null),r=null!=t?t.nextTile:this.from,s=this.getConnectedToTile(r),o=[],i=0,n=s.length;i<n;i++)l=s[i],this.tileIsValid(l)?o.push(this.addStep(new e.Step(this,null!=t?t:null,r,l))):o.push(void 0);return o},e.prototype.tileEqual=function(t,e){return t===e||(t.emulated||e.emulated)&&t.x===e.x&&t.y===e.y},e.prototype.addStep=function(t){if(null==this.paths[t.getExit().x]&&(this.paths[t.getExit().x]={}),!(null!=this.paths[t.getExit().x][t.getExit().y]&&this.paths[t.getExit().x][t.getExit().y].getTotalLength()<=t.getTotalLength())&&(null!=this.paths[t.getExit().x][t.getExit().y]&&this.removeStep(this.paths[t.getExit().x][t.getExit().y]),this.paths[t.getExit().x][t.getExit().y]=t,this.queue.splice(this.getStepRank(t),0,t),this.tileEqual(t.nextTile,this.to)&&!(null!=this.solution&&this.solution.prev.getTotalLength()<=t.getTotalLength())))return this.solution=new e.Step(this,t,t.nextTile,null)},e.prototype.removeStep=function(t){var e;if((e=this.queue.indexOf(t))>-1)return this.queue.splice(e,1)},e.prototype.best=function(){return this.queue[this.queue.length-1]},e.prototype.getStepRank=function(t){return 0===this.queue.length?0:this._getStepRank(t.getEfficiency(),0,this.queue.length-1)},e.prototype._getStepRank=function(t,e,i){var n,l;return l=Math.floor((i-e)/2)+e,n=this.queue[l].getEfficiency(),n===t?l:n>t?l===e?e:this._getStepRank(t,e,l-1):l===i?i+1:this._getStepRank(t,l+1,i)},e}(t),i.Step=function(){function t(t,e,i,n){this.pathFinder=t,this.prev=e,this.tile=i,this.nextTile=n}return t.prototype.posToTileOffset=function(t,e){var i;return i=Math.floor(t)===this.tile.x&&Math.floor(e)===this.tile.y?this.tile:Math.floor(t)===this.nextTile.x&&Math.floor(e)===this.nextTile.y?this.nextTile:null!=this.prev&&Math.floor(t)===this.prev.tile.x&&Math.floor(e)===this.prev.tile.y?this.prev.tile:console.log("Math.floor("+t+") == "+this.tile.x,"Math.floor("+e+") == "+this.tile.y,this),{x:t,y:e,tile:i,offsetX:t-i.x,offsetY:e-i.y}},t.prototype.getExit=function(){return null==this.exit&&(null!=this.nextTile?this.exit={x:(this.tile.x+this.nextTile.x+1)/2,y:(this.tile.y+this.nextTile.y+1)/2}:this.exit={x:this.tile.x+.5,y:this.tile.y+.5}),this.exit},t.prototype.getEntry=function(){return null==this.entry&&(null!=this.prev?this.entry={x:(this.tile.x+this.prev.tile.x+1)/2,y:(this.tile.y+this.prev.tile.y+1)/2}:this.entry={x:this.tile.x+.5,y:this.tile.y+.5}),this.entry},t.prototype.getLength=function(){return null==this.length&&(this.length=null==this.nextTile||null==this.prev?.5:this.prev.tile.x===this.nextTile.x||this.prev.tile.y===this.nextTile.y?1:Math.sqrt(.5)),this.length},t.prototype.getStartLength=function(){return null==this.startLength&&(this.startLength=null!=this.prev?this.prev.getTotalLength():0),this.startLength},t.prototype.getTotalLength=function(){return null==this.totalLength&&(this.totalLength=this.getStartLength()+this.getLength()),this.totalLength},t.prototype.getEfficiency=function(){return null==this.efficiency&&(this.efficiency=1.1*-this.getRemaining()-this.getTotalLength()),this.efficiency},t.prototype.getRemaining=function(){var t,e,i,n;return null==this.remaining&&(t=this.getExit(),e={x:this.pathFinder.to.x+.5,y:this.pathFinder.to.y+.5},i=e.x-t.x,n=e.y-t.y,this.remaining=Math.sqrt(i*i+n*n)),this.remaining},t}(),null!=e&&(e.PathFinder=i),l=function(t){function e(t,e){this.x=t,this.y=e,this.init()}return h(e,t),e.prototype.init=function(){return this.children=[]},e.prototype.getRelativeTile=function(t,e){return this.container.getTile(this.x+t,this.y+e)},e.prototype.addChild=function(t){var e;return e=this.children.indexOf(t),-1===e&&this.children.push(t),t.tile=this,t},e.prototype.removeChild=function(t){var e;if(e=this.children.indexOf(t),e>-1&&this.children.splice(e,1),t.tile===this)return t.tile=null},e}(t),null!=e&&(e.Tile=l),s=function(t){function e(){this.init()}return h(e,t),e.prototype.init=function(){return this.coords={},this.tiles=[]},e.prototype.addTile=function(t){return this.tiles.push(t),null==this.coords[t.x]&&(this.coords[t.x]={}),this.coords[t.x][t.y]=t,t.container=this},e.prototype.getTile=function(t,e){var i;if(null!=(null!=(i=this.coords[t])?i[e]:void 0))return this.coords[t][e]},e.prototype.loadMatrix=function(t){var e,i,n,l,s,o;i=[];for(o in t)n=t[o],i.push(function(){var t;t=[];for(s in n)l=n[s],e={x:parseInt(s),y:parseInt(o)},"function"==typeof l?t.push(this.addTile(l(e))):(l.x=e.x,l.y=e.y,t.push(this.addTile(l)));return t}.call(this));return i},e.prototype.allTiles=function(){return this.tiles.slice()},e.prototype.clearAll=function(){var t,e,i,n;for(i=this.tiles,t=0,e=i.length;t<e;t++)n=i[t],n.container=null;return this.coords={},this.tiles=[]},e}(t),null!=e&&(e.TileContainer=s),e.Element=n.Element,"undefined"!=typeof module&&null!==module?module.exports=e:this.Parallelio=e}).call(this);